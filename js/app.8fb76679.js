(function(e){function t(t){for(var a,r,o=t[0],l=t[1],c=t[2],h=0,d=[];h<o.length;h++)r=o[h],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&d.push(n[r][0]),n[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);u&&u(t);while(d.length)d.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],a=!0,o=1;o<i.length;o++){var l=i[o];0!==n[l]&&(a=!1)}a&&(s.splice(t--,1),e=r(r.s=i[0]))}return e}var a={},n={app:0},s=[];function r(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=a,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/pave/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;s.push([1,"chunk-vendors"]),i()})({0:function(e,t){},"0386":function(e,t,i){e.exports=i.p+"img/darkmode.a447d0e4.jpg"},"0554":function(e,t,i){"use strict";i.r(t),t["default"]="#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nuniform float currentTime;\nvarying float vPercentComplete;\n\nvoid main(void) {\n\n  if (vPercentComplete == -1.0) discard;\n\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  // Take the global opacity and the alpha from vColor into account for the alpha component\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  // gl_FragColor = picking_filterPickingColor(gl_FragColor)\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"},"08b1":function(e,t,i){},"0a22":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"show-hide":"Show/Hide:","Vehicles":"Vehicles","Routes":"Routes","Requests":"DRT Requests"},"de":{"show-hide":"Ein-/Ausblenden","Vehicles":"Fahrzeuge","Routes":"Routen","Requests":"DRT Anfragen"}}'),delete e.options._Ctor}},"0b51":function(e,t,i){},"0c3c":function(e,t,i){"use strict";var a=i("3600"),n=i.n(a);n.a},"0f40":function(e,t,i){},1:function(e,t,i){e.exports=i("cd49")},1133:function(e,t,i){},"11f4":function(e,t,i){},"125f":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"light":"light","dark":"dark"},"de":{"light":"hell","dark":"dark"}}'),delete e.options._Ctor}},"18ab":function(e,t,i){},"1a8b":function(e,t,i){"use strict";var a=i("125f"),n=i.n(a);t["default"]=n.a},"1bf3":function(e,t,i){},"1ce1":function(e,t,i){e.exports=i.p+"img/thumb-v6.4c765466.png"},2:function(e,t){},"20c0":function(e,t,i){},"21d2":function(e,t,i){"use strict";var a=i("905f"),n=i.n(a);n.a},"23ef":function(e,t,i){},2795:function(e,t,i){},2876:function(e,t,i){"use strict";var a=i("c54f"),n=i.n(a);t["default"]=n.a},"2b2e":function(e,t,i){e.exports=i.p+"img/2-univ-magdeburg.ac74ea07.png"},"2baf":function(e,t,i){},3:function(e,t){},"301c":function(e,t,i){e.exports=i.p+"img/banner.7663a105.jpg"},3102:function(e,t,i){"use strict";var a=i("d43b"),n=i.n(a);n.a},"31ec":function(e,t,i){"use strict";var a=i("1133"),n=i.n(a);n.a},3352:function(e,t,i){"use strict";var a=i("23ef"),n=i.n(a);n.a},3432:function(e,t,i){"use strict";var a=i("cf49"),n=i.n(a);n.a},"34c5":function(e,t,i){},3600:function(e,t,i){},"36a2":function(e,t,i){"use strict";var a=i("2baf"),n=i.n(a);n.a},4:function(e,t){},4219:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"selectColumn":"Select data column","loading":"Loading...","bandwidths":"Widths: 1 pixel =","timeOfDay":"Time of day","colors":"Colors"},"de":{"selectColumn":"Datenspalte wählen","loading":"Laden...","bandwidths":"Linienbreiten: 1 pixel =","timeOfDay":"Uhrzeit","colors":"Farben"}}'),delete e.options._Ctor}},"42e0":function(e,t,i){"use strict";var a=i("08b1"),n=i.n(a);n.a},"432b":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"all":"All","colors":"Colors","loading":"Loading","selectColumn":"Select data column","timeOfDay":"Time of Day"},"de":{"all":"Alle","colors":"Farben","loading":"Wird geladen","selectColumn":"Datenspalte wählen","timeOfDay":"Uhrzeit"}}'),delete e.options._Ctor}},"44aa":function(e,t,i){},"44fb":function(e,t,i){"use strict";var a=i("8a53"),n=i.n(a);n.a},"469e":function(e,t,i){},"48e2":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"loading":"Loading data...","sorting":"Sorting into bins..."},"de":{"loading":"Dateien laden...","sorting":"Sortieren..."}}'),delete e.options._Ctor}},"4ac0":function(e,t,i){},5:function(e,t){},5176:function(e,t,i){"use strict";var a=i("44aa"),n=i.n(a);n.a},"55ea":function(e,t,i){},5782:function(e,t,i){"use strict";var a=i("bac6"),n=i.n(a);n.a},5853:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"pave-project":"PAVE","head1":"PAVE: Potential of automated vehicle systems","desc1":"Automated and connected driving is expected to have considerable potential for road traffic, especially with regard to increasing traffic safety, reducing consumption and emissions, improving traffic efficiency in the medium term, and sustainably strengthening Germany as a location for business and innovation.","head2":"The concept of Mobility-on-Demand","desc2":"The short video and interactive animation below illustrate what PAVE is all about.","head3":"Explore model results","desc3":"Click on one of the service scenarios below to explore the technical outputs:","more-info":"For more information:","video":"Video: What is PAVE?","model":"Interactive model simulation","projMainPage":"Project main page","matsim":"All simulations conducted using the MATSim simulation framework:"},"de":{"pave-project":"PAVE","head1":"PAVE: Potentiale automatisierter Verkehrssysteme","desc1":"Durch „Automatisiertes und vernetztes Fahren“ wird ein erhebliches Potential für den Straßenverkehr erwartet, insbesondere hinsichtlich „der Steigerung der Verkehrssicherheit, der Verbrauchs- und Emissionsreduzierung, einer mittelfristigen Verbesserung der Verkehrseffizienz und der nachhaltigen Stärkung des Wirtschafts- und Innovationsstandorts Deutschland“.","head2":"Das Konzept hinter Mobility-on-Demand","desc2":"Hier finden Sie ein Video und eine interaktive Animation zu der Funktionsweise von automatisierten Mobilitätsdiensten","head3":"Simulationsergebnisse","desc3":"Klicken Sie auf eine der Schaltflächen um Ergebnisse des jeweiligen Szenarios zu entdecken:","video":"Video: Was steckt hinter PAVE?","model":"Interaktive Simulation","more-info":"Weitere Informationen:","projMainPage":"Projekt Webseite","matsim":"Alle Simulationen wurden mit dem MATSim Framework durchgeführt"}}'),delete e.options._Ctor}},"5ad6":function(e,t,i){"use strict";var a=i("48e2"),n=i.n(a);t["default"]=n.a},"5c0b":function(e,t,i){"use strict";var a=i("9c0c"),n=i.n(a);n.a},"600a":function(e,t,i){"use strict";var a=i("b423"),n=i.n(a);n.a},6033:function(e,t,i){"use strict";var a=i("a98e"),n=i.n(a);n.a},"64d0":function(e,t,i){"use strict";var a=i("e91c"),n=i.n(a);n.a},"677a":function(e,t,i){"use strict";var a=i("469e"),n=i.n(a);n.a},"6a1a":function(e,t,i){"use strict";var a=i("aed0"),n=i.n(a);n.a},"6b0c":function(e,t,i){e.exports=function(){return new Worker(i.p+"f07ae41d94b174a083e1.worker.js")}},"6c98":function(e,t,i){},"73e1":function(e,t,i){},7442:function(e,t,i){e.exports=i.p+"img/4-bosch.2b425ffc.png"},"74c1":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"pave-project":"PAVE","head1":"Legal Disclosure"},"de":{"pave-project":"PAVE","head1":"Impressum"}}'),delete e.options._Ctor}},7587:function(e,t,i){},"780e":function(e,t,i){"use strict";var a=i("8594"),n=i.n(a);n.a},"783f":function(e,t,i){"use strict";var a=i("7587"),n=i.n(a);n.a},"78bf":function(e,t,i){},7942:function(e,t,i){"use strict";var a=i("a5bc"),n=i.n(a);n.a},"7a14":function(e,t,i){"use strict";var a=i("87e0"),n=i.n(a);n.a},"7b21":function(e,t,i){"use strict";var a=i("dee5"),n=i.n(a);n.a},"7c4c":function(e,t,i){"use strict";var a=i("bc7b"),n=i.n(a);t["default"]=n.a},"7d8e":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"paveproject":"PAVE Project Team","contact":"Contact","partners":"Project Partners","gdpr":"No personal data stored or collected","imprint":"Legal notice"},"de":{"gdpr":"Keine Speicherung oder Sammlung von persönlichen Daten","imprint":"Impressum"}}'),delete e.options._Ctor}},"818f":function(e,t,i){var a=i("4719"),n=i("301c"),s=i("a7f5"),r=i("b944"),o=a(n),l=a(s),c=a(r),u='<img src="'+o+'"> <h3 id="episim-covid-19-virus-spreading-dynamics">Episim: COVID-19 virus spreading dynamics</h3> <p>This animation illustrates the <a href="https://covid-sim.info">MATSIM-Episim model</a> as it simulates the spread of COVID-19 disease through <strong>Berlin, Germany</strong> and the surrounding area.</p> <p>Each dot depicts a person, going about their day. The colors represent their disease status:</p> <div style="display:flex;flex-direction:column;margin-bottom:1rem"> <p style="margin-bottom:.4rem"><span style="background-color:#c8c800">&nbsp;&nbsp;&nbsp;&nbsp;</span> Susceptible and healthy</p> <p style="margin-bottom:.4rem"><span style="background-color:#30ffff">&nbsp;&nbsp;&nbsp;&nbsp;</span> Latently Infected</p> <p style="margin-bottom:.4rem"><span style="background-color:#c80032">&nbsp;&nbsp;&nbsp;&nbsp;</span> Contagious</p> <p style="margin-bottom:.4rem"><span style="background-color:#ff5532">&nbsp;&nbsp;&nbsp;&nbsp;</span> Showing Symptoms</p> <p style="margin-bottom:.4rem"><span style="background-color:#6e2878">&nbsp;&nbsp;&nbsp;&nbsp;</span> Seriously Sick</p> <p style="margin-bottom:.4rem"><span style="background-color:#141414">&nbsp;&nbsp;&nbsp;&nbsp;</span> Critical</p> <p style="margin-bottom:.4rem"><span style="background-color:#1a7a2c">&nbsp;&nbsp;&nbsp;&nbsp;</span> Recovered</p> </div> <p>You can select different days to see how the population&#39;s health shifts over time.</p> <p>This is a &quot;Base Case&quot; simulation for illustrative purposes. It shows what would have happened in Berlin if there had been no social distancing measures, no closing of schools and workplaces, etc.</p> <p>This illustration shows only a small sample of the total tripmaking in Berlin; while MATSim-Episim can model each agent individually, it is too much data to show on one screen in disaggregate form.</p> <h3 id="interesting-things-to-explore">Interesting things to explore</h3> <ul> <li><p>By day 14, new infections <span style="background-color:#30e6f0">&nbsp;&nbsp;&nbsp;&nbsp;</span> are quite noticeable throughout Berlin, and by day 18 they are everywhere in the city</p> </li> <li><p>By day 33, many recovered people <span style="background-color:#1e7846">&nbsp;&nbsp;&nbsp;&nbsp;</span> are apparent</p> </li> <li><p>By day 40, most of the new infections occur far outside the central urban area of Berlin.</p> </li> </ul> <h3 id="how-does-the-simulation-work">How does the simulation work?</h3> <p>The method used by MATSIM-Episim is available on the front page at <a href="https://matsim-vsp.github.io">https://matsim-vsp.github.io</a>. It is based on advanced human mobility models and virus infection dynamics taken from recent literature and publications.</p> <h3 id="for-more-information">For more information</h3> <p>Please email us at <a href="mailto:covid19@vsp.tu-berlin.de">covid19@vsp.tu-berlin.de</a> for more information.</p> <p>The main website is at <a href="https://covid-sim.info">matsim-vsp.github.io</a> is under heavy development as we build new versions of the Episim model.</p> <p>MATSim-Episim is freely available and open source, and can be downloaded at <a href="https://github.com/matsim-org/matsim-episim">https://github.com/matsim-org/matsim-episim</a>.</p> <h3 id="acknowledgements">Acknowledgements</h3> <p>This site and the MATSim-Episim model are developed at Technische Universität Berlin, by the Transport Systems Planning and Transport Telematics group, Institute for Land and Sea Transport (ILS) at TU Berlin. Professor Kai Nagel leads the team.</p> <p>This research supported by the <a href="https://bmbf.de">Bundesministerium für Bildung und Forschung</a> at the German Federal Goverment.</p> <p>Website and visulations built using <a href="https://vuejs.org">Vue</a> and <a href="https://threejs.org">Three.js</a>.</p> <hr> <img src="'+l+'" width="40%"> <br/> <br/> <img src="'+c+'" width="40%"> <br/> <br/> <br/> <br/> ';e.exports=u},"83c7":function(e,t,i){"use strict";var a=i("d429"),n=i.n(a);n.a},8594:function(e,t,i){},"859c":function(e,t,i){e.exports=i.p+"img/8-pave.060011d2.png"},"85b4":function(e,t,i){"use strict";var a=i("2795"),n=i.n(a);n.a},"85e2":function(e,t,i){e.exports=i.p+"img/v3-thumb.507b4f45.png"},"87e0":function(e,t,i){},8838:function(e,t,i){"use strict";var a=i("0f40"),n=i.n(a);n.a},"8a53":function(e,t,i){},"8c14":function(e,t,i){"use strict";var a=i("9a46"),n=i.n(a);t["default"]=n.a},"905f":function(e,t,i){},"90da":function(e,t,i){"use strict";var a=i("9bba"),n=i.n(a);n.a},"91a9":function(e,t,i){e.exports=i.p+"img/6-ina-logo.20fe5513.png"},"920e":function(e,t,i){"use strict";var a=i("18ab"),n=i.n(a);n.a},9668:function(e,t,i){"use strict";var a=i("34c5"),n=i.n(a);n.a},"9a46":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"all":"All","colors":"Colors","loading":"Loading","selectColumn":"Select data column","timeOfDay":"Time of day","bandwidths":"Widths: 1 pixel =","showDiffs":"Show Differences"},"de":{"all":"Alle","colors":"Farben","loading":"Wird geladen","selectColumn":"Datenspalte wählen","timeOfDay":"Uhrzeit","bandwidths":"Linienbreiten: 1 pixel =","showDiffs":"Differenzen"}}'),delete e.options._Ctor}},"9bba":function(e,t,i){},"9c0c":function(e,t,i){},a14d:function(e,t,i){e.exports=i.p+"img/5-carl-benz.d24b27cc.png"},a278:function(e,t,i){"use strict";i.r(t),t["default"]="// fragment shader: pixel colors\nuniform float simulationTime;\n\n// passed in from vertex shader:\nvarying float skip;\nvarying float atRest;\n\nvec4 getColor() {\n\n    if (atRest == 1.0) {\n        return vec4(0.0, 0.5, 0.2, 1.0);\n    }\n\n    return vec4(1.0, 1.0, 0.5, 1.0);\n}\n\n\nvoid main() {\n    // don't do anything if this trip is currently out of time bounds\n    if (skip == 1.0) {\n\n        gl_FragColor = vec4(0,0,0,0);\n\n    } else {\n\n        gl_FragColor = getColor();\n\n    }\n}\n"},a2d2:function(e,t,i){"use strict";var a=i("432b"),n=i.n(a);t["default"]=n.a},a5bc:function(e,t,i){},a696:function(e,t,i){"use strict";var a=i("dba0"),n=i.n(a);n.a},a6e2:function(e,t,i){e.exports=i.p+"img/vsp-logo-300dpi.b8a4e879.png"},a722:function(e,t,i){"use strict";var a=i("11f4"),n=i.n(a);n.a},a7f5:function(e,t,i){e.exports=i.p+"img/matsim-logo-blue.33e6b1c3.png"},a98e:function(e,t,i){},ab71:function(e,t,i){"use strict";var a=i("d352"),n=i.n(a);t["default"]=n.a},acace:function(e,t,i){"use strict";var a=i("ef1a"),n=i.n(a);n.a},aeb6:function(e,t,i){e.exports=i.p+"img/logo-bmvi.28230675.png"},aed0:function(e,t,i){},b423:function(e,t,i){},b8ce:function(e,t,i){"use strict";var a=i("73e1"),n=i.n(a);n.a},b944:function(e,t,i){e.exports=i.p+"img/tu-logo.e3c4ff96.png"},b950:function(e,t,i){"use strict";var a=i("78bf"),n=i.n(a);n.a},b9f1:function(e,t,i){"use strict";var a=i("74c1"),n=i.n(a);t["default"]=n.a},bac6:function(e,t,i){},bc7b:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"requests":"DRT Requests:","search":"Search:","passengers":"Passengers:","speed":"Speed:"},"de":{"requests":"DRT Anfragen","search":"Suche","passengers":"Passagiere","speed":"Geschwindigkeit"}}'),delete e.options._Ctor}},bd2b:function(e,t,i){"use strict";var a=i("cc1d"),n=i.n(a);t["default"]=n.a},beb0:function(e,t,i){"use strict";var a=i("0b51"),n=i.n(a);n.a},c162:function(e,t,i){e.exports=function(){return new Worker(i.p+"abf0d2b115cf02551a03.worker.js")}},c450:function(e,t,i){"use strict";var a=i("4219"),n=i.n(a);t["default"]=n.a},c454:function(e,t,i){},c54f:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"prev":"Prev","next":"Next"},"de":{"prev":"Letzte","next":"Nächste"}}'),delete e.options._Ctor}},cc1d:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"annualRevenue":"Annual profit","annualSubsidy":"Annual loss","demand":"Demand","expensePerDay":"Expenses/day","fleetSize":"Fleet size","fleetKm":"Fleet mileage","incomePerDay":"Income/day","kpi":"DRT Operator: Key Performance Indicators","perDay":"Per day","perKm":"Per km","tollIncome":"Toll income/day","totalKm":"Total mileage","revDistance":"Revenue distance","rides":"rides","selectRun":"Select run:","vehCosts":"Vehicle Costs","vehKm":"v•km","vehicles":"vehicles","waitTime":"95% waiting times"},"de":{"annualRevenue":"Gewinn/Jahr","annualSubsidy":"Verlust/Jahr","demand":"Nachfrage","expensePerDay":"Ausgaben/Tag","fleetSize":"Flottengröße","fleetKm":"Flottenfahrleistung","incomePerDay":"Einnahmen/Tag","kpi":"DRT-Anbieter Kennzahlen","perDay":"Pro Tag","perKm":"Pro Km","revDistance":"Umsatzkilometer","rides":"Fahrten","selectRun":"Parameterauswahl","tollIncome":"Mauteinnahmen/Tag","totalKm":"Gesamtfahrleistung","vehCosts":"Fahrzeugkosten","vehKm":"F•Km","vehicles":"Fahrzeuge","waitTime":"95% Wartezeiten"}}'),delete e.options._Ctor}},cd49:function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a,n,s,r=i("2b0e"),o=i("a925"),l=(i("99af"),i("a434"),i("4ec9"),i("d3b7"),i("3ca3"),i("2ca0"),i("ddb0"),i("2f62"));(function(e){e[e["INFO"]=0]="INFO",e[e["WARNING"]=1]="WARNING"})(a||(a={})),function(e){e["LightMode"]="light",e["DarkMode"]="dark"}(n||(n={})),function(e){e["Susceptible"]="susceptible",e["InfectedButNotContagious"]="infectedButNotContagious",e["Contagious"]="contagious"}(s||(s={}));var c,u={text:"#000",background:"#ccccc4",links:"#ffffff",susceptible:"#999900",infectedButNotContagious:"#0077ff",contagious:"#bb0044",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#000",recovered:"#116622"},h={text:"#fff",background:"#181518",links:"#445577",susceptible:"#bbbb44",infectedButNotContagious:"#00dddd",contagious:"#ff2299",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#fff",recovered:"#116622"},d={light:"mapbox://styles/mapbox/light-v10",dark:"mapbox://styles/vsp-tu-berlin/ckek59op0011219pbwfar1rex"};(function(e){e[e["line"]=0]="line",e[e["box"]=1]="box"})(c||(c={}));var p={projects:[{name:"1. Robotaxi",name_de:"1. Robotaxi",url:"1-robotaxi",description:"Automated taxi service",description_de:"Fahrerloser Taxi-Service",svn:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/1-robotaxi",need_password:!1,thumbnail:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/images/vehicles/Robotaxi_Taxi.jpg"},{name:"2. Pooling",name_de:"2. Pooling",url:"2-pooling",description:"Automated, pooled shuttle service",description_de:"Fahrerloser Shuttle-Service",svn:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/2-pooling",need_password:!1,thumbnail:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/images/vehicles/RoboShuttle.jpg"},{name:"3. Combined",name_de:"3. Kombiniert",url:"3-combined",description:"Both service forms available",description_de:"Beide Bedienformen verfügbar",svn:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/3-combined",need_password:!1,thumbnail:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/images/vehicles/Taxi_Und_Shuttle.jpg"},{name:"4. Ban Cars",name_de:"4. PKW-Verbot",url:"4-ban-cars",description:"No private cars inside the service area",description_de:"Keine privaten Autos im Bediengebiet",svn:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/4-ban-cars",need_password:!1,thumbnail:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website/images/vehicles/ban-cars.jpg"}]},m=p;r["default"].use(l["a"]);var f=localStorage.getItem("locale")?""+localStorage.getItem("locale"):(navigator.language||navigator.userLanguage).startsWith("de")?"de":"en",v=new l["a"].Store({state:{debug:!0,authAttempts:0,breadcrumbs:[],credentials:{fake:"fake"},isFullScreen:!1,needLoginForUrl:"",statusErrors:[],statusMessage:"Loading",svnProjects:m.projects,visualizationTypes:new Map,colorScheme:n.DarkMode,locale:f},getters:{},mutations:{requestLogin:function(e,t){e.needLoginForUrl=t},registerPlugin:function(e,t){console.log("PLUGIN:",t.kebabName),e.visualizationTypes.set(t.kebabName,t)},setBreadCrumbs:function(e,t){e.breadcrumbs=t},setCredentials:function(e,t){var i=btoa("".concat(t.username,":").concat(t.pw));e.credentials[t.url]=i,e.authAttempts++},setFullScreen:function(e,t){e.isFullScreen=t},setStatus:function(e,t){t.type===a.INFO?e.statusMessage=t.msg:e.statusErrors.length&&e.statusErrors[e.statusErrors.length-1]===t.msg||e.statusErrors.push(t.msg)},clearError:function(e,t){e.statusErrors.length>=t&&e.statusErrors.splice(t,1)},clearAllErrors:function(e){e.statusErrors=[]},rotateColors:function(e){e.colorScheme=e.colorScheme===n.DarkMode?n.LightMode:n.DarkMode,console.log("NEW COLORS:",e.colorScheme),localStorage.setItem("colorscheme",e.colorScheme),document.body.style.backgroundColor=e.colorScheme===n.LightMode?"#edebe4":"#2d3133"},setLocale:function(e,t){e.locale=t.toLocaleLowerCase(),localStorage.setItem("locale",e.locale),console.log("NEW LOCALE:",e.locale)}},actions:{},modules:{}}),b=i("b85c"),g=i("8c4f"),y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"home"}},[i("div",{staticClass:"banner"},[i("h2",[e._v(e._s(e.$t("pave-project")))]),i("h3",[e._v("VSP / Technische Universität Berlin")])]),i("div",{staticClass:"page-area"},[i("div",{staticClass:"zcontent"},[i("div",{staticClass:"main"},[i("div",{staticClass:"right"}),i("h2",[e._v(e._s(e.$t("head1")))]),i("p",[e._v(e._s(e.$t("desc1")))]),i("h2",[e._v(e._s(e.$t("head2")))]),i("p",[e._v(e._s(e.$t("desc2")))]),i("div",{staticClass:"big-thumbs"},[i("div",{staticClass:"project"},[i("iframe",{staticClass:"yt-size",attrs:{width:"100%",src:"https://www.youtube-nocookie.com/embed/lE9us7EoaLc",frameborder:"2",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}}),i("div",{staticClass:"desc"},[i("p",[e._v(e._s(e.$t("video")))])])]),i("div",{staticClass:"project"},[i("router-link",{attrs:{to:"/v/vehicle-animation/1-robotaxi/viz-vehicles-1.yaml"}},[i("img",{staticClass:"clip-it",attrs:{src:"/pave/thumb-drt.jpg"}})]),i("div",{staticClass:"desc"},[i("p",[e._v(e._s(e.$t("model")))])])],1)]),i("h2",[e._v(e._s(e.$t("head3")))]),i("p",[e._v(e._s(e.$t("desc3")))]),i("svn-projects",{staticClass:"gap"}),i("h2",[e._v(e._s(e.$t("more-info")))]),i("p",{staticClass:"with-space"},[e._v(e._s(e.$t("projMainPage")))]),i("a",{attrs:{href:"https://pave-your-way.de",target:"_blank"}},[e._v("https://pave-your-way.de")]),i("p",{staticClass:"with-space"},[e._v(e._s(e.$t("matsim")))]),i("a",{attrs:{href:"https://matsim.org",target:"_blank"}},[e._v("https://matsim.org")])],1)])]),i("div",{staticClass:"colophon"},[i("div",{staticClass:"zcontent"},[i("div",{staticClass:"main"},[i("colophon")],1)])])])},k=[],S=(i("96cf"),i("1da1")),C=i("d4ec"),w=i("bee2"),O=i("262e"),x=i("2caf"),j=i("9ab4"),_=i("60a3"),T=i("d4cd"),R=i.n(T),D=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"colophon-content"}},[e._m(0),i("h4",[e._v("Consortium")]),e._m(1),e._m(2),i("h4",[e._v("Contact")]),e._m(3),i("p",{staticClass:"gdpr"},[e._v("GDPR: "+e._s(e.$t("gdpr")))]),i("p",{staticClass:"gdpr"},[i("router-link",{attrs:{to:"/imprint"}},[e._v(e._s(e.$t("imprint"))+" ")])],1)])},E=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logo",staticStyle:{width:"25%","margin-left":"-1rem"}},[a("img",{attrs:{src:i("859c")}})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logos"},[a("div",{staticClass:"logo"},[a("img",{attrs:{src:i("2b2e")}})]),a("div",{staticClass:"logo"},[a("img",{attrs:{src:i("de3b")}})]),a("div",{staticClass:"logo"},[a("img",{attrs:{src:i("91a9")}})]),a("div",{staticClass:"logo"},[a("img",{attrs:{src:i("7442")}})])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logos"},[a("div",{staticClass:"logo"},[a("a",{attrs:{href:"https://www.tu.berlin",target:"_blank"}},[a("img",{attrs:{src:i("b944")}})])]),a("div",{staticClass:"logo"},[a("a",{attrs:{href:"https://www.vsp.tu-berlin.de",target:"_blank"}},[a("img",{attrs:{src:i("a6e2")}})])]),a("div",{staticClass:"logo",staticStyle:{width:"75%"}},[a("img",{attrs:{src:i("a14d")}})]),a("div",{staticClass:"bmvi"},[a("a",{attrs:{href:"https://www.bmvi.de",target:"_blank"}},[a("img",{attrs:{width:"90%",src:i("aeb6")}})])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",{staticClass:"gdpr"},[i("a",{attrs:{href:"mailto:sekretariat@vsp.tu-berlin.de"}},[e._v("Email VSP TU Berlin")])])}],A={name:"Colophon",components:{}},F=A,L=(i("600a"),i("2877")),M=i("d3b3"),P=Object(L["a"])(F,D,E,!1,null,"c2e2850e",null);"function"===typeof M["default"]&&Object(M["default"])(P);var z=P.exports,N=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"card"},[i("div",{staticClass:"card-image",style:{"background-image":"url("+e.thumbnail+")"}}),i("div",{staticClass:"card-title"},[e._v(e._s(e.viz.title))]),i("div",{staticClass:"card-id"},[i("div",{staticClass:"card-endnotes"},[e._v(e._s(e.vizNumber))])]),i("div",{staticClass:"card-subtitle"},[e._v(e._s(e.viz.subtitle))]),i("div",{staticClass:"card-date"},[e._v(e._s(e.viz.date))])])},I=[],B=(i("c975"),i("fb6a"),function(e){Object(O["a"])(a,e);var t=Object(x["a"])(a);function a(){return Object(C["a"])(this,a),t.apply(this,arguments)}return Object(w["a"])(a,[{key:"vizNumber",get:function(){return this.viz.url.slice(1)}},{key:"thumbnail",get:function(){if(this.viz.url.indexOf("v3")>-1){var e=i("85e2");return e}if(this.viz.url.indexOf("timelapse")>-1){var t=i("85e2");return t}var a=i("1ce1");return a}}]),a}(_["c"]));Object(j["a"])([Object(_["b"])({required:!0})],B.prototype,"viz",void 0),B=Object(j["a"])([Object(_["a"])({props:{viz:{}}})],B);var V=B,$=V,H=(i("d469"),Object(L["a"])($,N,I,!1,null,"7b286f98",null)),q=H.exports,U=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"svn-projects"},e._l(e.sources,(function(t){return i("div",{key:t.url,staticClass:"project",on:{click:[function(i){return e.openProjectPage(t)},function(i){return i.metaKey?e.openProjectTab(t):null},function(i){return i.ctrlKey?e.openProjectTab(t):null}],mouseup:function(i){return"button"in i&&1!==i.button?null:e.openProjectTab(t)}}},[i("img",{attrs:{src:t.thumbnail}}),i("div",{staticClass:"desc"},[i("h3",[e._v(e._s(e.getName(t)))]),i("p",[e._v(e._s(e.getDesc(t)))])])])})),0)},W=[],G=(i("a4d3"),i("e01a"),i("b0c0"),function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.sources=[],e}return Object(w["a"])(i,[{key:"mounted",value:function(){this.sources=v.state.svnProjects}},{key:"openProjectPage",value:function(e){this.$router.push({name:e.url})}},{key:"openProjectTab",value:function(e){window.open(e,"_blank")}},{key:"getName",value:function(e){return"de"===v.state.locale?e.name_de:e.name}},{key:"getDesc",value:function(e){return"de"===v.state.locale?e.description_de:e.description}}]),i}(_["c"]));G=Object(j["a"])([Object(_["a"])({components:{},props:{}})],G);var X=G,Y=X,K=(i("21d2"),Object(L["a"])(Y,U,W,!1,null,"13be09cc",null)),J=K.exports,Z="https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website",Q=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.state=v.state,e.readme="",e.markdownParser=new R.a,e}return Object(w["a"])(i,[{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=[],v.commit("setBreadCrumbs",t),e.prev=2,i="".concat(Z,"/readme.md"),e.next=6,fetch(i).then((function(e){return e.text()}));case 6:a=e.sent,this.readme=this.markdownParser.render(a),e.next=12;break;case 10:e.prev=10,e.t0=e["catch"](2);case 12:case"end":return e.stop()}}),e,this,[[2,10]])})));function t(){return e.apply(this,arguments)}return t}()}]),i}(_["c"]);Q=Object(j["a"])([Object(_["a"])({components:{Colophon:z,SvnProjects:J,VizCard:q}})],Q);var ee=Q,te=ee,ie=(i("dbca"),i("d1ef")),ae=Object(L["a"])(te,y,k,!1,null,"2397dbeb",null);"function"===typeof ie["default"]&&Object(ie["default"])(ae);var ne=ae.exports,se=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"home"}},[i("div",{staticClass:"banner"},[i("h2",[e._v(e._s(e.$t("pave-project")))]),i("h3",[e._v("VSP / Technische Universität Berlin")])]),i("div",{staticClass:"page-area"},[i("div",{staticClass:"zcontent"},[i("div",{staticClass:"main"},[i("h2",[e._v(e._s(e.$t("head1")))]),i("p",{staticClass:"imprint-style",domProps:{innerHTML:e._s(e.imprint)}})])])]),i("div",{staticClass:"colophon"},[i("div",{staticClass:"zcontent"},[i("div",{staticClass:"main"},[i("colophon")],1)])])])},re=[],oe="https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/pave/website",le=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.state=v.state,e.imprint="",e.markdownParser=new R.a,e}return Object(w["a"])(i,[{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=[],v.commit("setBreadCrumbs",t),e.next=4,this.showImprint();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"languageChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.showImprint();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showImprint",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(oe,"/imprint.").concat(this.state.locale,".md"),e.next=4,fetch(t).then((function(e){return e.text()}));case 4:i=e.sent,this.imprint=this.markdownParser.render(i),e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()}]),i}(_["c"]);Object(j["a"])([Object(_["d"])("state.locale")],le.prototype,"languageChanged",null),le=Object(j["a"])([Object(_["a"])({components:{Colophon:z,SvnProjects:J,VizCard:q}})],le);var ce=le,ue=ce,he=(i("44fb"),i("5782"),i("b9f1")),de=Object(L["a"])(ue,se,re,!1,null,"ec428bc2",null);"function"===typeof he["default"]&&Object(he["default"])(de);var pe=de.exports,me=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"folder-browser"},[i("div",{staticClass:"left-strip"},[e.myState.runFinder.dimensions.length?i("div",{staticClass:"dimensions"},[i("h3",[e._v(e._s(e.$t("selectRun")))]),e._l(e.myState.runFinder.dimensions,(function(t,a){return i("div",{key:t.heading,staticClass:"dimension"},[t.options[0].image?i("div",{staticClass:"all-areas"},[i("h4",[e._v(e._s(t.heading))]),i("p",[e._v(e._s(t.subheading))]),e._l(t.options,(function(t){return i("div",{key:t.title+"/"+t.value,staticClass:"xarea"},[i("img",{class:{"is-selected":e.myState.activeButtons[a]===t.value},attrs:{src:e.getUrlForServiceAreaImage(t)},on:{click:function(i){return e.clickedOptionButton(a,t.value)}}}),i("p",[e._v(e._s(t.value))])])}))],2):i("div",{staticClass:"all-buttons"},[i("h4",[e._v(e._s(t.heading))]),i("p",[e._v(e._s(t.subheading))]),e._l(t.options,(function(t){return i("button",{key:t.title+"/"+t.value,staticClass:"button",class:{"is-link":e.myState.activeButtons[a]===t.value},on:{click:function(i){return e.clickedOptionButton(a,t.value)}}},[e._v(e._s(t.title))])}))],2)])}))],2):e._e()]),i("div",{staticClass:"right-strip cream"},[e.myState.svnProject?i("div",{staticClass:"stripe"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"project-bar"},[i("div",{staticClass:"details"},[i("h2",[e._v(e._s(e.projectName))]),i("p",[e._v(e._s(e.projectDescription))])])])])]):e._e(),e.myState.errorStatus?i("div",{staticClass:"stripe"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"badnews",domProps:{innerHTML:e._s(e.myState.errorStatus)}})])]):e._e(),i("div",{staticClass:"stripe"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"readme-header"},[e.myState.readme?i("div",{staticClass:"curate-content markdown",domProps:{innerHTML:e._s(e.myState.readme)}}):e._e()])])]),i("div",{staticClass:"stripe"},[i("div",{staticClass:"vessel",style:{borderRadius:"10px",marginBottom:"2rem"}},[i("div",{staticClass:"call-out-box"},[i("h3",{staticClass:"curate-heading"},[e._v(e._s(e.$t("kpi"))),i("div",{staticClass:"icon is-small info-icon",on:{click:function(t){e.infoHover=!0}}},[i("i",{staticClass:"fas fa-info-circle"})])]),e.myState.isLoading||e.myState.vizes.length?e._e():i("p",[e._v("...")]),e.numberOfOperators>1?i("p",[i("b",[e._v(e._s(e.operatorName)+":"),i("button",{staticClass:"button is-small",staticStyle:{"margin-left":"0.5rem"},on:{click:function(t){return e.updateOperator(-1)}}},[e._v("<")]),i("button",{staticClass:"button is-small",on:{click:function(t){return e.updateOperator(1)}}},[e._v(">")])])]):e._e(),e.myState.selectedRun&&e.myState.vizes.length?i("div",{staticClass:"summary-table"},[i("div",{staticClass:"col1"},[i("b",{staticClass:"tlabel"},[e._v("*"+e._s(e.$t("vehCosts")))]),i("div",{staticClass:"tlabel"},[i("b",[e._v(e._s(e.$t("perDay")))])]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.runCosts.fixedCosts,expression:"runCosts.fixedCosts"}],staticClass:"input",domProps:{value:e.runCosts.fixedCosts},on:{input:function(t){t.target.composing||e.$set(e.runCosts,"fixedCosts",t.target.value)}}}),i("div",{staticClass:"tlabel"},[e._v(e._s(e.$t("waitTime"))+" <")]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.$t("demand")))]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.$t("fleetSize")))]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.$t("fleetKm")))]),i("div",{staticClass:"tlabel vspace"},[e._v(e._s(e.$t("revDistance")))]),i("div",{staticClass:"tlabel blue"},[e._v(e._s(e.$t("incomePerDay")))]),i("div",{staticClass:"tlabel red"},[e._v(e._s(e.$t("expensePerDay"))+"*")]),i("div",{staticClass:"tlabel vspace aboveline",class:{blue:e.annualIncome()>0,red:e.annualIncome()<0}},[e._v(e._s(e.annualIncome()<0?e.$t("annualSubsidy"):e.$t("annualRevenue")))]),i("div",{staticClass:"tlabel blue"},[e._v(e._s(e.$t("tollIncome")))]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.$t("totalKm")))])]),i("div",{staticClass:"col2"},[i("div",{staticClass:"tlabel"},[e._v(":")]),i("div",{staticClass:"tlabel"},[e._v("Pro km")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.runCosts.variableCosts,expression:"runCosts.variableCosts"}],staticClass:"input",domProps:{value:e.runCosts.variableCosts},on:{input:function(t){t.target.composing||e.$set(e.runCosts,"variableCosts",t.target.value)}}}),i("div",{staticClass:"tlabel"},[e._v(e._s((e.runHeader.serviceQuality/60).toFixed(1))+" min")]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.runHeader.demand.toLocaleString())+" "+e._s(e.$t("rides")))]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.runHeader.fleetSize.toLocaleString())+" "+e._s(e.$t("vehicles")))]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.runHeader.mileage.toLocaleString())+" "+e._s(e.$t("vehKm")))]),i("div",{staticClass:"tlabel vspace"},[e._v(e._s(e.runHeader.revenueDistance.toLocaleString())+" P•km")]),i("div",{staticClass:"tlabel blue"},[e._v(e._s(e.runHeader.incomePerDay.toLocaleString())+" €")]),i("div",{staticClass:"tlabel red"},[e._v(e._s(e.expensesPerDay().toLocaleString())+" €")]),i("div",{staticClass:"tlabel vspace aboveline",class:{blue:e.annualIncome()>0,red:e.annualIncome()<0}},[e._v(e._s(e.annualIncome().toLocaleString())+" €")]),i("div",{staticClass:"tlabel blue"},[e._v(e._s(e.runHeader.tollIncome.toLocaleString())+" €")]),i("div",{staticClass:"tlabel"},[e._v(e._s(e.totalMileage.toLocaleString())+" "+e._s(e.$t("vehKm")))])]),e.modeSharePie.description?i("div",{staticClass:"col3"},[i("sankey-flipper",{attrs:{myState:e.myState,modeSharePie:e.modeSharePie}})],1):e._e()]):e._e()])])]),e.myState.vizes.length?i("div",{staticClass:"stripe"},[i("div",{staticClass:"vessel"},[i("h3",{staticClass:"curate-heading"},[e._v(e._s(e.$t("Analysis")))]),i("div",{staticClass:"curate-content"},[i("div",{staticClass:"viz-table"},e._l(e.myState.vizes,(function(t,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:"sankey-diagram"!==t.component,expression:"viz.component !== 'sankey-diagram'"}],key:t.config,staticClass:"viz-grid-item",on:{click:function(t){return e.clickedVisualization(a)}}},[i("div",{staticClass:"viz-frame"},[i(t.component,{tag:"component",staticClass:"viz-frame-component",style:{"pointer-events":"image-view"===t.component?"auto":"none"},attrs:{yamlConfig:t.config,fileApi:e.myState.svnRoot,subfolder:""+e.myState.selectedRun,thumbnail:!0},on:{title:function(t){return e.updateTitle(a,t)}}}),i("p",[e._v(e._s(t.title))])],1)])})),0)])])]):e._e(),i("div",{staticClass:"colophon"},[i("div",{staticClass:"zcontent"},[i("div",{staticClass:"main"},[i("colophon")],1)])])]),i("div",{staticClass:"modal info-modal",class:{"is-active":e.infoHover}},[i("div",{staticClass:"modal-background",on:{click:function(t){e.infoHover=!1}}}),i("div",{staticClass:"modal-content"},[i("article",{staticClass:"message is-link"},[i("div",{staticClass:"message-body"},[i("p",{domProps:{innerHTML:e._s(e.myState.information)}})])])]),i("button",{staticClass:"modal-close is-large",attrs:{"aria-label":"close"},on:{click:function(t){e.infoHover=!1}}})])])},fe=[],ve=(i("4de4"),i("4160"),i("a15b"),i("d81d"),i("b64b"),i("07ac"),i("ac1f"),i("8a79"),i("5319"),i("159b"),i("d15e")),be=i("db05"),ge=i.n(be),ye=i("369b"),ke=i.n(ye),Se=i("8f3c"),Ce=i.n(Se),we=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"carrier-viewer",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[e.thumbnail?e._e():i("div",{staticClass:"nav"},[e.myState.statusMessage?i("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):e._e()]),e.thumbnail?e._e():i("tour-viz",{staticClass:"anim",attrs:{shipments:e.shownShipments,shownRoutes:e.shownRoutes,stopMidpoints:e.stopMidpoints,paths:[],drtRequests:[],traces:[],colors:e.COLOR_OCCUPANCY,settingsShowLayers:e.SETTINGS,center:e.vizDetails.center,searchEnabled:e.searchEnabled,vehicleLookup:e.vehicleLookup,onClick:e.handleClick}}),e.detailContent?i("collapsible-panel",{staticClass:"left-side",attrs:{darkMode:!0,direction:"left",width:"300"}},[i("h3",[e._v("Raw Details")]),i("div",{staticClass:"panel-items"},[i("div",{staticClass:"detail-list"},[i("pre",{staticStyle:{color:"#ccc","padding-right":"2rem"}},[e._v(e._s(e.detailContent))])])])]):e._e(),e.isLoaded&&!e.thumbnail?i("collapsible-panel",{staticClass:"right-side",attrs:{darkMode:!0,width:"250",direction:"right"}},[i("div",{staticClass:"panel-items"},[e.carriers.length?i("h3",[e._v(e._s(e.$t("carriers")))]):e._e(),i("div",{staticClass:"carrier-list"},e._l(e.carriers,(function(t){return i("div",{key:t.$.id,staticClass:"carrier",class:{selected:t.$.id==e.selectedCarrier}},[i("div",{staticClass:"carrier-title",on:{click:function(i){return e.handleSelectCarrier(t)}}},[i("i",{staticClass:"far",class:t.$.id==e.selectedCarrier?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(t.$.id))])]),t.$.id==e.selectedCarrier?i("div",{staticClass:"carrier-details"},[e.tours.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleTours=!e.toggleTours}}},[i("i",{staticClass:"far",class:e.toggleTours?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(e.$t("tours"))+": "+e._s(e.tours.length))])]),e._l(e.toggleTours?e.tours:[],(function(t,a){return i("div",{key:a,staticClass:"leaf tour",class:{selected:t==e.selectedTour},on:{click:function(i){return e.handleSelectTour(t)}}},[e._v(e._s(""+t.vehicleId))])}))],2):e._e(),e.vehicles.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleVehicles=!e.toggleVehicles}}},[i("i",{staticClass:"far",class:e.toggleVehicles?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("vehicles"))+": "+e._s(e.vehicles.length))])]),e._l(e.toggleVehicles?e.vehicles:[],(function(t){return i("div",{key:t,staticClass:"leaf tour"},[e._v(e._s(t))])}))],2):e._e(),e.shipments.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleShipments=!e.toggleShipments}}},[i("i",{staticClass:"far",class:e.toggleShipments?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("shipments"))+": "+e._s(e.shipments.length))])]),e._l(e.toggleShipments?e.shipments:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour",class:{selected:t==e.selectedShipment,"shipment-in-tour":e.shipmentIdsInTour.includes(t.id)},on:{click:function(i){return e.handleSelectShipment(t)}}},[e._v(e._s(t.id+": "+t.from+"-"+t.to))])}))],2):e._e(),e.services.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleServices=!e.toggleServices}}},[i("i",{staticClass:"far",class:e.toggleServices?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("services"))+": "+e._s(e.services.length))])]),e._l(e.toggleServices?e.services:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour"},[e._v(e._s(""+t.id))])}))],2):e._e()]):e._e()])})),0)])]):e._e()],1)},Oe=[],xe=(i("7db0"),i("baa5"),i("ace4"),i("1276"),i("9911"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("4971")),je=i.n(xe),_e=i("f206"),Te=i("89ab"),Re=i.n(Te),De=i("e975"),Ee=i.n(De),Ae=i("595c"),Fe=i.n(Ae),Le=i("083c"),Me=i.n(Le),Pe=i("faeb"),ze=i.n(Pe),Ne=i("b562"),Ie=i("f908"),Be=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isLoaded&&!e.thumbnail?i("collapsible-panel",{staticClass:"right-side",attrs:{darkMode:!0,width:"250",direction:"right"}},[i("div",{staticClass:"panel-items"},[e.carriers.length?i("h3",[e._v(e._s(e.$t("carriers")))]):e._e(),i("div",{staticClass:"carrier-list"},e._l(e.carriers,(function(t){return i("div",{key:t.$.id,staticClass:"carrier",class:{selected:t.$.id==e.selectedCarrier}},[i("div",{staticClass:"carrier-title",on:{click:function(i){return e.handleSelectCarrier(t)}}},[i("i",{staticClass:"far",class:t.$.id==e.selectedCarrier?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(t.$.id))])]),t.$.id==e.selectedCarrier?i("div",{staticClass:"carrier-details"},[e.tours.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleTours=!e.toggleTours}}},[i("i",{staticClass:"far",class:e.toggleTours?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(e.$t("tours"))+": "+e._s(e.tours.length))])]),e._l(e.toggleTours?e.tours:[],(function(t,a){return i("div",{key:a,staticClass:"leaf tour",class:{selected:t==e.selectedTour},on:{click:function(i){return e.handleSelectTour(t)}}},[e._v(e._s(""+t.id))])}))],2):e._e(),e.vehicles.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleVehicles=!e.toggleVehicles}}},[i("i",{staticClass:"far",class:e.toggleVehicles?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("vehicles"))+": "+e._s(e.vehicles.length))])]),e._l(e.toggleVehicles?e.vehicles:[],(function(t){return i("div",{key:t,staticClass:"leaf tour"},[e._v(e._s(t))])}))],2):e._e(),e.shipments.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleShipments=!e.toggleShipments}}},[i("i",{staticClass:"far",class:e.toggleShipments?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("shipments"))+": "+e._s(e.shipments.length))])]),e._l(e.toggleShipments?e.shipments:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour",class:{selected:t==e.selectedShipment,"shipment-in-tour":e.shipmentIdsInTour.includes(t.id)},on:{click:function(i){return e.handleSelectShipment(t)}}},[e._v(e._s(t.id+": "+t.from+"-"+t.to))])}))],2):e._e(),e.services.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleServices=!e.toggleServices}}},[i("i",{staticClass:"far",class:e.toggleServices?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("services"))+": "+e._s(e.services.length))])]),e._l(e.toggleServices?e.services:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour"},[e._v(e._s(""+t.id))])}))],2):e._e()]):e._e()])})),0)])]):e._e()},Ve=[],$e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",class:{collapsed:e.collapsed}},["left"===e.direction?i("div",{staticClass:"body",style:{order:2,transform:e.collapsed?"translateX(-"+e.width+"px":"none"}},[e._t("default")],2):i("div",{staticClass:"body",style:{order:1,transform:e.collapsed?"translateX("+e.width+"px":"none"}},[e._t("default")],2),i("div",{staticClass:"xbutton",class:{collapsed:e.collapsed},style:{order:"left"===e.direction?1:2},on:{click:e.handleClick}},[i("div",{staticClass:"rotate",style:{transform:"rotate("+(e.collapsed?180:360)+"deg)"}},[e._v(e._s("left"===e.direction?"<":">"))])])])},He=[],qe=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.collapsed=void 0!==e.initialCollapsed&&e.initialCollapsed,e}return Object(w["a"])(i,[{key:"handleClick",value:function(){this.collapsed=!this.collapsed}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!0})],qe.prototype,"width",void 0),Object(j["a"])([Object(_["b"])({required:!1})],qe.prototype,"initialCollapsed",void 0),Object(j["a"])([Object(_["b"])({required:!0})],qe.prototype,"direction",void 0),Object(j["a"])([Object(_["b"])({required:!0})],qe.prototype,"darkMode",void 0),qe=Object(j["a"])([_["a"]],qe);var Ue=qe,We=Ue,Ge=(i("783f"),Object(L["a"])(We,$e,He,!1,null,"6d450e9a",null)),Xe=Ge.exports,Ye=i("ab5b"),Ke=i.n(Ye);function Je(e){var t=e.items.map((function(e){return Ke.a.createElement("li",{key:e.value+e.value[0]},Ke.a.createElement("div",{style:{width:"100%",height:"".concat(Math.max(1,3*(1*e.value-1)+3),"px"),backgroundColor:"rgb(".concat(e.color,")")}}),e.label&&Ke.a.createElement("div",{style:{marginBottom:"0.5rem"}},e.label))}));return Ke.a.createElement("div",null,Ke.a.createElement("h4",{style:{textAlign:"left",fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.8rem"}},e.title),Ke.a.createElement("p",null,e.description),Ke.a.createElement("ul",{style:{listStyle:"none",padding:0,margin:0}},t))}var Ze=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"vue-component"}},[i("vue-slider",e._b({staticClass:"slider",on:{dragging:e.dragging,"drag-start":e.dragStart,"drag-end":e.dragEnd},model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.sliderOptions,!1)),i("div",{staticClass:"buttons"},[i("div",{staticClass:"playpause",on:{click:e.toggleSimulation}},[e.isRunning?i("i",{staticClass:"button-icon fa fa-1x fa-pause"}):i("i",{staticClass:"button-icon fa fa-1x fa-play"})])])],1)},Qe=[],et=i("3c87"),tt=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=0,e.sliderOptions={min:0,max:1e6,clickable:!1,dotSize:30,duration:0,lazy:!0,tooltip:"active","tooltip-placement":"top","tooltip-formatter":function(t){return e.convertSecondsToClockTimeMinutes(t)}},e.pauseWhileDragging=!1,e}return Object(w["a"])(i,[{key:"toggleSimulation",value:function(){this.$emit("click")}},{key:"convertSecondsToClockTimeMinutes",value:function(e){var t=this.getSecondsFromSlider(e);try{var i=et(t),a=("00"+i.minutes).slice(-2);return"".concat(i.hours,":").concat(a)}catch(n){return"00:00"}}},{key:"dragStart",value:function(){this.isRunning&&(this.pauseWhileDragging=!0,this.$emit("click"))}},{key:"dragEnd",value:function(){this.pauseWhileDragging&&this.$emit("click"),this.pauseWhileDragging=!1}},{key:"dragging",value:function(e){this.$emit("time",this.getSecondsFromSlider(e))}},{key:"onKeyPressed",value:function(e){"Space"===e.code&&this.toggleSimulation()}},{key:"getSecondsFromSlider",value:function(e){var t=(this.timeEnd-this.timeStart)*e/1e6;return t===this.timeEnd&&(t=this.timeEnd-1),t}},{key:"handleTimeChanged",value:function(){this.sliderValue=1e6*(this.currentTime-this.timeStart)/(this.timeEnd-this.timeStart)}},{key:"mounted",value:function(){window.addEventListener("keyup",this.onKeyPressed)}},{key:"beforeDestroy",value:function(){window.removeEventListener("keyup",this.onKeyPressed)}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!0})],tt.prototype,"isRunning",void 0),Object(j["a"])([Object(_["b"])({required:!0})],tt.prototype,"timeStart",void 0),Object(j["a"])([Object(_["b"])({required:!0})],tt.prototype,"timeEnd",void 0),Object(j["a"])([Object(_["b"])({required:!0})],tt.prototype,"currentTime",void 0),Object(j["a"])([Object(_["d"])("currentTime")],tt.prototype,"handleTimeChanged",null),tt=Object(j["a"])([Object(_["a"])({components:{VueSlider:je.a},props:{}})],tt);var it=tt,at=it,nt=(i("6033"),Object(L["a"])(at,Ze,Qe,!1,null,"0661f5b0",null)),st=nt.exports,rt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"settings-panel-content"},[i("h4",[e._v(e._s(e.$t("show-hide")))]),e._l(Object.keys(e.items),(function(t,a){return i("div",{key:t,staticClass:"row"},[i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.items[t],labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){return e.$emit("click",a)}}}),i("label",[e._v(e._s(e.$t(t)))])],1)}))],2)},ot=[],lt=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!0})],lt.prototype,"items",void 0),lt=Object(j["a"])([Object(_["a"])({components:{ToggleButton:_e["ToggleButton"]}})],lt);var ct=lt,ut=ct,ht=(i("42e0"),i("f2cf")),dt=Object(L["a"])(ut,rt,ot,!1,null,"f7ceed80",null);"function"===typeof ht["default"]&&Object(ht["default"])(dt);var pt=dt.exports;Ee.a.insensitive=!0;var mt=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.vizDetails={network:"",carriers:"",projection:"",title:"",description:"",thumbnail:"",center:[13.4,52.5]},e.colorScheme=n.DarkMode,e.searchTerm="",e.searchEnabled=!1,e.globalState=v.state,e.isDarkMode=e.colorScheme===n.DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.links={},e.toggleTours=!0,e.toggleVehicles=!0,e.toggleShipments=!0,e.toggleServices=!0,e.carriers=[],e.vehicles=[],e.shipments=[],e.services=[],e.stopMidpoints=[],e.tours=[],e.shownRoutes=[],e.shownShipments=[],e.shipmentIdsInTour=[],e.selectedCarrier="",e.selectedTour=null,e.selectedShipment=null,e.currentlyAnimating={},e.vehicleLookup=[],e.vehicleLookupString={},e}return Object(w["a"])(i,[{key:"handleSelectShipment",value:function(e){if(console.log({shipment:e}),this.selectedShipment===e)return this.selectedShipment=null,void(this.shownShipments=[]);this.shownShipments=this.shipments.filter((function(t){return t.id===e.id})),this.selectedShipment=e}},{key:"handleSelectTour",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o,l,c,u,h,d,p,m,f,v,g,y,k=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log({tour:t}),this.currentlyAnimating=t,this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedTour!==t){e.next=10;break}return this.selectedTour=null,e.abrupt("return");case 10:this.selectedTour=t,i=[],a=[],n=0,s=Object(b["a"])(t.plan),e.prev=15,o=function(){var e=r.value;if(e.shipmentId){i.push(e.shipmentId);var t=k.shipments.find((function(t){return t.id===e.shipmentId})),s="pickup"===e.type?t.from:t.to;if(a.length&&a[a.length-1].link===s)return"continue";var o=[k.links[s][0],k.links[s][1]],l=[k.links[s][2],k.links[s][3]],c=[.5*(k.links[s][0]+k.links[s][2]),.5*(k.links[s][1]+k.links[s][3])],u=Object.assign({},t);delete u.from,delete u.fromX,delete u.fromY,delete u.to,delete u.toX,delete u.toY,delete u.id,a.push({id:t.id,count:n++,link:s,midpoint:c,label:"",details:u,ptFrom:o,ptTo:l})}},s.s();case 18:if((r=s.n()).done){e.next=24;break}if(l=o(),"continue"!==l){e.next=22;break}return e.abrupt("continue",22);case 22:e.next=18;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e["catch"](15),s.e(e.t0);case 29:return e.prev=29,s.f(),e.finish(29);case 32:for(c=0;c<a.length;c++){for(u="",h=0;h<c;h++)a[c].midpoint[0]===a[h].midpoint[0]&&a[c].midpoint[1]===a[h].midpoint[1]&&(u+=",".concat(h),",0"===u&&(u=",*"),a[c].label="");u+=",".concat(c),u=u.slice(1),"0"===u&&(u="*"),a[c].label=u}this.shipmentIdsInTour=i,d=Fe()({colormap:"summer",nshades:Math.max(9,t.routes.length),format:"rba"}).map((function(e){return e.slice(0,3)})),p=0,m=function(e){return new Promise((function(t){return setTimeout(t,e)}))},f=t.routes.length>20?25:50,v=Object(b["a"])(t.routes),e.prev=39,v.s();case 41:if((g=v.n()).done){e.next=49;break}return y=g.value,this.addRouteToMap(t,y,a,d,p),p++,e.next=47,m(f);case 47:e.next=41;break;case 49:e.next=54;break;case 51:e.prev=51,e.t1=e["catch"](39),v.e(e.t1);case 54:return e.prev=54,v.f(),e.finish(54);case 57:this.stopMidpoints=a;case 58:case"end":return e.stop()}}),e,this,[[15,26,29,32],[39,51,54,57]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRouteToMap",value:function(e,t,i,a,n){if(this.currentlyAnimating===e){var s,r=[[this.links[t[0]][0],this.links[t[0]][1]]],o=Object(b["a"])(t);try{for(o.s();!(s=o.n()).done;){var l=s.value,c=[this.links[l][0],this.links[l][1]];c[0]===r[r.length-1][0]&&c[1]===r[r.length-1][1]||r.push(c),r.push([this.links[l][2],this.links[l][3]])}}catch(u){o.e(u)}finally{o.f()}this.shownRoutes=this.shownRoutes.concat([{count:n,points:r,color:a[n]}]),this.stopMidpoints=i.slice(0,n)}}},{key:"handleSelectCarrier",value:function(e){var t,i,a;console.log("carrier",e),this.currentlyAnimating=null;e.$.id;this.vehicles=[],this.shipments=[],this.services=[],this.tours=[],this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedCarrier!==e.$.id?(this.selectedCarrier=e.$.id,(null===(t=e.capabilities[0])||void 0===t||null===(i=t.vehicles[0])||void 0===i?void 0:i.vehicle)&&(this.vehicles=e.capabilities[0].vehicles[0].vehicle.map((function(e){return e.$.id})).sort((function(e,t){return Ee()(e,t)}))),this.shipments=this.processShipments(e),(null===(a=e.services[0])||void 0===a?void 0:a.service)&&(this.services=e.services[0].service.map((function(e){return e.$})).sort((function(e,t){return Ee()(e.$.id,t.$.id)}))),this.tours=this.processTours(e)):this.selectedCarrier=""}},{key:"processTours",value:function(e){var t;if(!(null===(t=e.plan[0])||void 0===t?void 0:t.tour))return[];var i=e.plan[0].tour.map((function(e){var t=e.$$.map((function(e){return Object.assign(e.$,{$:e["#name"],route:e.route})})),i=t.filter((function(e){return"leg"===e.$&&e.route[0].length})).map((function(e){return e.route[0].split(" ")}));return{id:e.$.vehicleId,plan:t,routes:i}}));return i.sort((function(e,t){return Ee()(e.id,t.id)})),i}},{key:"processShipments",value:function(e){var t;if(!e.shipments)return[];var i=[];(null===(t=e.shipments[0])||void 0===t?void 0:t.shipment)&&(i=e.shipments[0].shipment.map((function(e){return e.$})).sort((function(e,t){return Ee()(e.id,t.id)})));try{var a,n=Object(b["a"])(i);try{for(n.s();!(a=n.n()).done;){var s=a.value;s.fromX=.5*(this.links[s.from][0]+this.links[s.from][2]),s.fromY=.5*(this.links[s.from][1]+this.links[s.from][3]),s.toX=.5*(this.links[s.to][0]+this.links[s.to][2]),s.toY=.5*(this.links[s.to][1]+this.links[s.to][3])}}catch(r){n.e(r)}finally{n.f()}}catch(o){}return i}},{key:"swapTheme",value:function(){this.isDarkMode=this.colorScheme===n.DarkMode}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.colorScheme===n.DarkMode?t:e}}]),i}(_["c"]);Object(j["a"])([Object(_["d"])("globalState.colorScheme")],mt.prototype,"swapTheme",null),mt=Object(j["a"])([Object(_["a"])({components:{CollapsiblePanel:Xe,LegendColors:Je,PlaybackControls:st,SettingsPanel:pt,ToggleButton:_e["ToggleButton"],VueSlider:je.a}})],mt);var ft=mt,vt=ft,bt=(i("f30e"),i("ab71")),gt=Object(L["a"])(vt,Be,Ve,!1,null,"25a40e2e",null);"function"===typeof bt["default"]&&Object(bt["default"])(gt);var yt,kt=gt.exports,St=(i("13d5"),i("25f0"),i("fb2c"),"initialize"),Ct="error",wt="result",Ot=(self,function(){function e(t){var i=this;Object(C["a"])(this,e),this.promises=new Map,this.worker=t,this.handleMessageDelegate=function(e){return i.handleWorkerMessage(e)},this.worker.addEventListener("message",this.handleMessageDelegate)}return Object(w["a"])(e,[{key:"destroy",value:function(){this.worker&&(this.worker.removeEventListener("message",this.handleMessageDelegate),this.worker.terminate())}},{key:"postAsyncWorkerMessage",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t,i,a){var n,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={call:{method:t,parameters:i},id:this.generatePromiseId()},a?this.worker.postMessage(n,a):this.worker.postMessage(n,[]),e.abrupt("return",new Promise((function(e,t){s.promises.set(n.id,{resolve:e,reject:t})})));case 3:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}()},{key:"handleWorkerMessage",value:function(e){Date.now();var t=e.data;switch(t.type){case Ct:this.handleError(t);break;case wt:this.handleEvent(t);break;default:console.error("unknown message type: "+t.type)}}},{key:"handleError",value:function(e){console.error("Error in Worker: "+e.error),this.promises.has(e.id)&&(this.promises.get(e.id).reject(e.error),this.promises.delete(e.id))}},{key:"handleEvent",value:function(e){this.promises.has(e.id)&&(this.promises.get(e.id).resolve(e.result),this.promises.delete(e.id))}},{key:"generatePromiseId",value:function(){var e=new Uint32Array(8);return crypto.getRandomValues(e),e.reduce((function(e,t){return e+("0"+t.toString(16)).slice(-2)}),"")}}]),e}()),xt=i("d977"),jt=i.n(xt);(function(e){e["CreateNodesAndLinks"]="CreateNodesAndLinks",e["ConvertCoordinates"]="ConvertCoordinates",e["ProcessTransit"]="ProcessTransit"})(yt||(yt={}));var _t=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.call(this,new jt.a)}return Object(w["a"])(i,[{key:"createNodesAndLinks",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(yt.CreateNodesAndLinks,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertCoordinates",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(yt.ConvertCoordinates,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processTransit",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(yt.ProcessTransit,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(St,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(Ot),Tt=i("3835"),Rt=i("50fd"),Dt=i("ee06"),Et=i("2a18"),At=i("f2b6"),Ft=i("c98a"),Lt=i("72db"),Mt=i("9043"),Pt=i("3cd3"),zt=i("60a4"),Nt=i("5530"),It=i("45eb"),Bt=i("7e84"),Vt=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return Object(w["a"])(i,[{key:"initializeState",value:function(e){Object(It["a"])(Object(Bt["a"])(i.prototype),"initializeState",this).call(this,e),this.getAttributeManager().addInstanced({instanceOffset:{size:1,accessor:"getOffset"}})}},{key:"getShaders",value:function(){return Object(Nt["a"])(Object(Nt["a"])({},Object(It["a"])(Object(Bt["a"])(i.prototype),"getShaders",this).call(this)),{},{inject:{"vs:#decl":"\n            attribute float instanceOffset;\n            varying float offset;\n            ","vs:#main-start":"\n            offset = instanceOffset;\n            ","fs:#decl":"\n            varying float offset;\n            ","fs:#main-start":"\n            if (offset == 1.0 && vPathPosition.x < 0.0) {\n                discard;\n            }\n            if (offset == 2.0 && vPathPosition.x > 0.0) {\n                discard;\n            }\n            if (offset == 0.0 && abs(vPathPosition.x) > 0.5) {\n                discard;\n            }\n        "}})}}]),i}(Lt["a"]);Vt.layerName="PathOffsetLayer",Vt.defaultProps={getOffset:{type:"accessor",value:0}};var $t=i("8307"),Ht={circle:{x:0,y:0,width:128,height:128,mask:!0},infoPin:{x:128,y:0,width:128,height:128,mask:!0},box:{x:128,y:128,width:128,height:128,mask:!1},vehicle:{x:0,y:128,width:128,height:128,mask:!1}},qt="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",Ut=new Dt["a"]({color:[255,255,255],intensity:1}),Wt=new Et["a"]({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),Gt=new At["a"]({ambientLight:Ut,pointLight:Wt}),Xt={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[Gt]},Yt={latitude:52.5,longitude:13.4,zoom:9,pitch:15,minZoom:1,maxZoom:23};function Kt(e){var t="mapbox://styles/vsp-tu-berlin/ckek59op0011219pbwfar1rex",i=e.shipments,a=e.shownRoutes,n=e.stopMidpoints,s=(e.settingsShowLayers,e.center),r=(e.searchEnabled,e.onClick),o=Xt,l=Object.assign({},Yt);l.latitude=s[1],l.longitude=s[0];var c=Object(Ye["useState"])({}),u=Object(Tt["a"])(c,2),h=u[0],d=u[1],p=[];function m(){console.log(h),h.object?r(h.object.v):r(null)}function f(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(!i)return null;if(i.color)return Ke.a.createElement("div",{className:"tooltip",style:{fontSize:"0.7rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:a+20,top:n-30}},"Leg ",i.count+1);var s=20*Object.keys(i).length+32,r=n-30;return r+s>window.innerHeight&&(r=n-s),Ke.a.createElement("div",{className:"tooltip",style:{fontSize:"0.7rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:a+20,top:r}},Ke.a.createElement("table",{style:{fontSize:"0.8rem"}},Ke.a.createElement("tbody",null,Ke.a.createElement("tr",null,Ke.a.createElement("td",{style:{fontSize:"1rem",fontWeight:"bold",textAlign:"right",paddingRight:"0.5rem"}},i.type," ",i.count,":"),Ke.a.createElement("td",{style:{fontSize:"1rem",fontWeight:"bold"}}," ",i.id)),Object.keys(i.details).map((function(e){return Ke.a.createElement("tr",{key:e},Ke.a.createElement("td",{style:{textAlign:"right",paddingRight:"0.5rem",paddingTop:"0.2rem"}},e,":"),Ke.a.createElement("td",{style:{paddingTop:"0.2rem"}},i.details[e]))})))))}return p.push(new Lt["a"]({id:"shipmentLocationDashedLine",data:n,getPath:function(e){return[e.ptFrom,e.ptTo]},getColor:[192,192,192],getOffset:2,opacity:1,widthMinPixels:4,rounded:!0,shadowEnabled:!1,pickable:!1,autoHighlight:!1,highlightColor:[255,255,255],parameters:{depthTest:!1},getDashArray:[3,2],dashJustified:!0,extensions:[new $t["a"]({dash:!0})]})),p.push(new Vt({id:"deliveryroutes",data:a,getPath:function(e){return e.points},getColor:function(e){return e.color},getOffset:2,opacity:1,widthMinPixels:12,rounded:!0,shadowEnabled:!1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:d,parameters:{depthTest:!1}})),p.push(new Mt["a"]({id:"dest-circles",data:n,getIcon:function(e){return"circle"},getColor:function(e){return e.count?[255,255,255]:[255,255,0]},getPosition:function(e){return e.midpoint},getSize:function(e){return e.count?38:64},opacity:1,shadowEnabled:!0,noAlloc:!1,iconAtlas:"/icon-atlas-3.png",iconMapping:Ht,sizeScale:1,billboard:!0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:d})),p.push(new Pt["a"]({id:"dest-labels",data:n,backgroundColor:[255,255,255],getColor:[0,0,0],getPosition:function(e){return e.midpoint},getText:function(e){return"".concat(e.label)},getTextAnchor:"middle",getSize:18,opacity:1,noAlloc:!1,sizeScale:1,pickable:!1,autoHighlight:!1})),p.push(new zt["a"]({id:"shipments",data:i,getSourcePosition:function(e){return[e.fromX,e.fromY]},getTargetPosition:function(e){return[e.toX,e.toY]},getSourceColor:[255,0,255],getTargetColor:[200,255,255],getWidth:2,opacity:.75,parameters:{depthTest:!1}})),Ke.a.createElement(Ft["a"],{layers:p,effects:o.effects,pickingRadius:5,initialViewState:l,controller:!0,getCursor:function(){return"pointer"},onClick:m},Ke.a.createElement(Rt["b"],{reuseMaps:!0,mapStyle:t,preventStyleDiffing:!0,mapboxApiAccessToken:qt}),f({hoverInfo:h}))}i("466d");var Jt=function(){function e(t){Object(C["a"])(this,e),this.urlId=t.url,this.needsAuth=t.need_password,this.baseUrl=t.svn,t.svn.endsWith("/")||(this.baseUrl+="/")}return Object(w["a"])(e,[{key:"cleanURL",value:function(e){var t=this.baseUrl+e.replace(/^0-9a-zA-Z_\-\/:+/i,"");return t=t.replaceAll("//","/"),t=t.replace("https:/","https://"),t=t.replace("http:/","http://"),t}},{key:"_getFileResponse",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=this.cleanURL(t),a={},n=v.state.credentials[this.urlId],this.needsAuth&&(a["Authorization"]="Basic ".concat(n)),s=new Request(i,{headers:a}),e.next=7,fetch(s).then((function(e){if(200!=e.status)throw console.log("Status:",e.status),e;return e}));case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileText",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.text());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileJson",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.json());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileBlob",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.blob());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDirectory",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,i.endsWith("/")||(i+="/"),e.next=4,this._getFileResponse(i).then();case 4:return a=e.sent,e.next=7,a.text();case 7:return n=e.sent,e.abrupt("return",this.buildListFromHtml(n));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildListFromHtml",value:function(e){return e.indexOf("SimpleWebServer")>-1?this.buildListFromSimpleWebServer(e):e.indexOf("<ul>")>-1?this.buildListFromSVN(e):e.indexOf("<table>")>-1?this.buildListFromApache24(e):{dirs:[],files:[]}}},{key:"buildListFromSimpleWebServer",value:function(e){var t,i=/">(.*?)<\/a/,a=[],n=[],s=e.split("\n"),r=Object(b["a"])(s);try{for(r.s();!(t=r.n()).done;){var o=t.value;console.log(o);var l=o.indexOf('<li><a href="');if(!(l<0)){var c=o.match(i);if(c){var u=c[1];u.endsWith("/")?a.push(u.substring(0,u.length-1)):n.push(u)}}}}catch(h){r.e(h)}finally{r.f()}return{dirs:a,files:n}}},{key:"buildListFromSVN",value:function(e){var t,i=/"(.*?)"/,a=[],n=[],s=e.split("\n"),r=Object(b["a"])(s);try{for(r.s();!(t=r.n()).done;){var o=t.value,l=o.indexOf('<li><a href="');if(!(l<0)){var c=o.match(i);if(c){var u=c[1];"../"!==u&&(u.endsWith("/")?a.push(u.substring(0,u.length-1)):n.push(u))}}}}catch(h){r.e(h)}finally{r.f()}return{dirs:a,files:n}}},{key:"buildListFromApache24",value:function(e){var t,i=/"(.*?)"/,a=[],n=[],s=e.split("\n"),r=Object(b["a"])(s);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(!(o.indexOf('<th "')>-1)&&!(o.indexOf("[PARENTDIR]")>-1)){var l=o.indexOf('<td><a href="');if(!(l<0)){var c=o.substring(l).match(i);if(c){var u=c[1];"../"!==u&&(u.endsWith("/")?a.push(u.substring(0,u.length-1)):n.push(u))}}}}}catch(h){r.e(h)}finally{r.f()}return{dirs:a,files:n}}}]),e}(),Zt=Jt,Qt=i("b8ae");_["c"].use(Qt["VuePlugin"]),Ee.a.insensitive=!0;var ei=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.COLOR_OCCUPANCY={0:[255,255,85],1:[32,96,255],2:[85,255,85],3:[255,85,85],4:[200,0,0]},e.COLOR_OCCUPANCY_MATSIM_UNUSED={0:[255,85,255],1:[255,255,85],2:[85,255,85],3:[85,85,255],4:[255,85,85],5:[255,85,0]},e.SETTINGS={Fahrzeuge:!1,Routen:!1,"DRT Anfragen":!1},e.legendItems=Object.keys(e.COLOR_OCCUPANCY).map((function(t){return{type:c.line,color:e.COLOR_OCCUPANCY[t],value:t,label:t}})),e.legendRequests=[{type:c.line,color:[255,0,255],value:0,label:""}],e.vizDetails={network:"",carriers:"",projection:"",title:"",description:"",thumbnail:"",center:[13.4,52.5]},e.myState={statusMessage:"",clock:"00:00",colorScheme:n.DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,data:[]},e.searchTerm="",e.searchEnabled=!1,e.globalState=v.state,e.isDarkMode=e.myState.colorScheme===n.DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.links={},e.toggleTours=!0,e.toggleVehicles=!0,e.toggleShipments=!0,e.toggleServices=!0,e.detailContent="",e.carriers=[],e.vehicles=[],e.shipments=[],e.services=[],e.stopMidpoints=[],e.tours=[],e.shownRoutes=[],e.shownShipments=[],e.shipmentIdsInTour=[],e.selectedCarrier="",e.selectedTour=null,e.selectedShipment=null,e.currentlyAnimating={},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.vehicleLookup=[],e.vehicleLookupString={},e}return Object(w["a"])(i,[{key:"handleSelectShipment",value:function(e){if(console.log({shipment:e}),this.selectedShipment===e)return this.selectedShipment=null,void(this.shownShipments=[]);this.shownShipments=this.shipments.filter((function(t){return t.id===e.id})),this.selectedShipment=e}},{key:"handleSelectTour",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o,l,c,u,h,d,p,m,f,v,g,y,k=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log({tour:t}),this.currentlyAnimating=t,this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedTour!==t){e.next=11;break}return this.selectedTour=null,this.detailContent="",e.abrupt("return");case 11:this.selectedTour=t,this.detailContent=JSON.stringify(t,null,4),i=[],a=[],n=0,s=Object(b["a"])(t.plan),e.prev=17,o=function(){var e=r.value;if(e.shipmentId){i.push(e.shipmentId);var t=k.shipments.find((function(t){return t.id===e.shipmentId})),s="pickup"===e.type?t.from:t.to;if(a.length&&a[a.length-1].link===s)return"continue";var o=[k.links[s][0],k.links[s][1]],l=[k.links[s][2],k.links[s][3]],c=[.5*(k.links[s][0]+k.links[s][2]),.5*(k.links[s][1]+k.links[s][3])],u=Object.assign({},t);delete u.from,delete u.fromX,delete u.fromY,delete u.to,delete u.toX,delete u.toY,delete u.id,a.push({id:t.id,type:"pickup"===e.type?k.$t("pickup"):k.$t("delivery"),count:n++,link:s,midpoint:c,label:"",details:u,ptFrom:o,ptTo:l})}},s.s();case 20:if((r=s.n()).done){e.next=26;break}if(l=o(),"continue"!==l){e.next=24;break}return e.abrupt("continue",24);case 24:e.next=20;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e["catch"](17),s.e(e.t0);case 31:return e.prev=31,s.f(),e.finish(31);case 34:for(c=0;c<a.length;c++){for(u="",h=0;h<c;h++)a[c].midpoint[0]===a[h].midpoint[0]&&a[c].midpoint[1]===a[h].midpoint[1]&&(u+=",".concat(h),",0"===u&&(u=",*"),a[c].label="");u+=",".concat(c),u=u.slice(1),"0"===u&&(u="*"),a[c].label=u}this.shipmentIdsInTour=i,d=Fe()({colormap:"summer",nshades:Math.max(9,t.routes.length),format:"rba"}).map((function(e){return e.slice(0,3)})),p=0,m=function(e){return new Promise((function(t){return setTimeout(t,e)}))},f=t.routes.length>20?25:50,v=Object(b["a"])(t.routes),e.prev=41,v.s();case 43:if((g=v.n()).done){e.next=51;break}return y=g.value,this.addRouteToMap(t,y,a,d,p),p++,e.next=49,m(f);case 49:e.next=43;break;case 51:e.next=56;break;case 53:e.prev=53,e.t1=e["catch"](41),v.e(e.t1);case 56:return e.prev=56,v.f(),e.finish(56);case 59:this.stopMidpoints=a;case 60:case"end":return e.stop()}}),e,this,[[17,28,31,34],[41,53,56,59]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRouteToMap",value:function(e,t,i,a,n){if(this.currentlyAnimating===e){var s,r=[[this.links[t[0]][0],this.links[t[0]][1]]],o=Object(b["a"])(t);try{for(o.s();!(s=o.n()).done;){var l=s.value,c=[this.links[l][0],this.links[l][1]];c[0]===r[r.length-1][0]&&c[1]===r[r.length-1][1]||r.push(c),r.push([this.links[l][2],this.links[l][3]])}}catch(u){o.e(u)}finally{o.f()}this.shownRoutes=this.shownRoutes.concat([{count:n,points:r,color:a[n]}]),this.stopMidpoints=i.slice(0,n)}}},{key:"handleSelectCarrier",value:function(e){var t,i,a;console.log("carrier",e),this.currentlyAnimating=null;e.$.id;this.vehicles=[],this.shipments=[],this.services=[],this.tours=[],this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedCarrier!==e.$.id?(this.selectedCarrier=e.$.id,(null===(t=e.capabilities[0])||void 0===t||null===(i=t.vehicles[0])||void 0===i?void 0:i.vehicle)&&(this.vehicles=e.capabilities[0].vehicles[0].vehicle.map((function(e){return e.$.id})).sort((function(e,t){return Ee()(e,t)}))),this.shipments=this.processShipments(e),(null===(a=e.services[0])||void 0===a?void 0:a.service)&&(this.services=e.services[0].service.map((function(e){return e.$})).sort((function(e,t){return Ee()(e.$.id,t.$.id)}))),this.tours=this.processTours(e)):this.selectedCarrier=""}},{key:"processTours",value:function(e){var t;if(!(null===(t=e.plan[0])||void 0===t?void 0:t.tour))return[];var i=e.plan[0].tour.map((function(e){var t=e.$$.map((function(e){return Object.assign(e.$,{$:e["#name"],route:e.route})})),i=t.filter((function(e){return"leg"===e.$&&e.route[0].length})).map((function(e){return e.route[0].split(" ")}));return{vehicleId:e.$.vehicleId,plan:t,routes:i}}));return i.sort((function(e,t){return Ee()(e.vehicleId,t.vehicleId)})),i}},{key:"processShipments",value:function(e){var t;if(!e.shipments)return[];var i=[];(null===(t=e.shipments[0])||void 0===t?void 0:t.shipment)&&(i=e.shipments[0].shipment.map((function(e){return e.$})).sort((function(e,t){return Ee()(e.id,t.id)})));try{var a,n=Object(b["a"])(i);try{for(n.s();!(a=n.n()).done;){var s=a.value;s.fromX=.5*(this.links[s.from][0]+this.links[s.from][2]),s.fromY=.5*(this.links[s.from][1]+this.links[s.from][3]),s.toX=.5*(this.links[s.to][0]+this.links[s.to][2]),s.toY=.5*(this.links[s.to][1]+this.links[s.to][3])}}catch(r){n.e(r)}finally{n.f()}}catch(o){}return i}},{key:"handleSettingChange",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),this.SETTINGS[t]=!this.SETTINGS[t];case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),this.vizDetails.center||(this.vizDetails.center=[13.4,52.5]),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 12:i=this.vizDetails.title?this.vizDetails.title:"Carrier Explorer",this.$emit("title",i),this.buildThumbnail();case 15:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Re.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===n.DarkMode,this.updateLegendColors()}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.showHelp=!1,this.generateBreadcrumbs(),this.updateLegendColors(),this.myState.statusMessage="Loading carriers...",console.log("loading files"),e.next=13,this.loadCarriers();case 13:return this.carriers=e.sent,e.next=16,this.loadNetwork();case 16:this.links=e.sent,console.log("GO!"),this.myState.statusMessage="";case 19:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadCarriers",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFileOrGzippedFile(this.vizDetails.carriers);case 2:return t=e.sent,e.next=5,this.parseXML(t);case 5:return i=e.sent,a=i.carriers.carrier.sort((function(e,t){return Ee()(e.$.id,t.$.id)})),e.next=9,this.$nextTick();case 9:return console.log({carrierList:a}),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadNetwork",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.statusMessage="Loading network",!(this.vizDetails.network.indexOf(".xml.")>-1)){e.next=14;break}return e.next=4,this.loadFileOrGzippedFile(this.vizDetails.network);case 4:return t=e.sent,e.next=7,this.parseXML(t);case 7:return i=e.sent,e.next=10,this.convertRoadNetwork(i);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.next=16,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.network);case 16:if(n=e.sent,!n){e.next=23;break}return e.next=20,Object(Ne["a"])(n);case 20:e.t0=e.sent,e.next=24;break;case 23:e.t0=null;case 24:return s=e.t0,e.next=27,Ie["run"](ze.a.inflateAsync(s,{to:"string"}));case 27:return r=e.sent,o=JSON.parse(r),e.abrupt("return",o);case 30:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertRoadNetwork",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.statusMessage="Projecting network...",this.vizDetails.projection="EPSG:31464",e.next=4,_t.create({xml:t,projection:this.vizDetails.projection});case 4:return this._networkHelper=e.sent,this.myState.statusMessage="Crunching road network...",e.next=8,this._networkHelper.createNodesAndLinks();case 8:return this.myState.statusMessage="Converting coordinates...",e.next=11,this._networkHelper.convertCoordinates();case 11:for(i=e.sent,this._networkHelper.destroy(),this.myState.statusMessage="Merging links and nodes",a=i.network.nodes,n={},s=0,r=Object.keys(i.network.links);s<r.length;s++)o=r[s],l=i.network.links[o],n[o]=[a[l.from].x,a[l.from].y,a[l.to].x,a[l.to].y];return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){this.myState.isRunning=!1,this._networkHelper&&this._networkHelper.destroy(),v.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"parseXML",value:function(e){var t=new Me.a.Parser({strict:!0,trim:!0,preserveChildrenOrder:!0,explicitChildren:!0,explicitArray:!0});return new Promise((function(i,a){t.parseString(e,(function(e,t){e?a(e):i(t)}))}))}},{key:"loadFileOrGzippedFile",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("loading",t),i="",e.prev=2,!t.endsWith("xml")){e.next=9;break}return e.next=6,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+t);case 6:i=e.sent,e.next=24;break;case 9:if(!t.endsWith("gz")){e.next=24;break}return e.next=12,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+t);case 12:if(a=e.sent,!a){e.next=19;break}return e.next=16,Object(Ne["a"])(a);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=null;case 20:return n=e.t0,e.next=23,Ie["run"](ze.a.inflateAsync(n,{to:"string"}));case 23:i=e.sent;case 24:e.next=31;break;case 26:e.prev=26,e.t1=e["catch"](2),s=t+": "+e.t1,console.error(e.t1),this.myState.statusMessage=s;case 31:return e.abrupt("return",i);case 32:case"end":return e.stop()}}),e,this,[[2,26]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===n.DarkMode?n.LightMode:n.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===n.DarkMode?t:e}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],ei.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ei.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ei.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ei.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],ei.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("globalState.colorScheme")],ei.prototype,"swapTheme",null),ei=Object(j["a"])([Object(_["a"])({components:{CollapsiblePanel:Xe,DetailsPanel:kt,LegendColors:Je,PlaybackControls:st,SettingsPanel:pt,ToggleButton:_e["ToggleButton"],TourViz:Kt,VueSlider:je.a}})],ei),v.commit("registerPlugin",{kebabName:"carrier-viewer",prettyName:"Carrier Viewer",description:"For freight etc!",filePatterns:["viz-carrier*.y?(a)ml"],component:ei});var ti=ei,ii=ti,ai=(i("5176"),i("d388")),ni=Object(L["a"])(ii,we,Oe,!1,null,"501bbd00",null);"function"===typeof ai["default"]&&Object(ai["default"])(ni);var si=ni.exports,ri=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{id:"v3-app",oncontextmenu:"return false"}},[e.thumbnail?e._e():i("div",{staticClass:"nav"},[i("p",{staticClass:"big xtitle"},[e._v(e._s(e.vizDetails.title))]),e.myState.statusMessage?i("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):e._e()]),e.thumbnail?e._e():i("trip-viz",{staticClass:"anim",attrs:{simulationTime:e.simulationTime,paths:e.$options.paths,drtRequests:e.$options.drtRequests,traces:e.$options.traces,colors:e.COLOR_OCCUPANCY,settingsShowLayers:e.SETTINGS,center:e.vizDetails.center,searchEnabled:e.searchEnabled,vehicleLookup:e.vehicleLookup,dark:e.isDarkMode,onClick:e.handleClick}}),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{darkMode:!0,width:"200",direction:"right"}},[i("div",{staticClass:"big clock"},[i("p",[e._v(e._s(e.myState.clock))])]),i("div",{staticClass:"panel-items"},[i("legend-colors",{staticClass:"legend-block",attrs:{title:e.$t("requests"),items:e.legendRequests}}),e.legendItems.length?i("legend-colors",{staticClass:"legend-block",attrs:{title:e.$t("passengers"),items:e.legendItems}}):e._e(),i("div",{staticClass:"search-panel"},[i("p",{staticClass:"speed-label",style:{margin:"1rem 0 0 0"}},[e._v(e._s(e.$t("search")))]),i("form",{attrs:{autocomplete:"off"}}),i("div",{staticClass:"field"},[i("p",{staticClass:"control has-icons-left"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"}],staticClass:"input is-small search-box",attrs:{type:"email",placeholder:"Search..."},domProps:{value:e.searchTerm},on:{input:function(t){t.target.composing||(e.searchTerm=t.target.value)}}}),i("span",{staticClass:"icon is-small is-left"},[i("i",{staticClass:"fas fa-search"})])])])]),i("settings-panel",{staticClass:"settings-area",attrs:{items:e.SETTINGS},on:{click:e.handleSettingChange}}),i("div",{staticClass:"speed-block"},[i("p",{staticClass:"speed-label"},[e._v(e._s(e.$t("speed"))),i("br"),e._v(e._s(e.speed)+"x")]),i("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}})],1)],1)])],1):e._e(),i("div",{staticClass:"bottom-area"},[!e.thumbnail&&e.isLoaded?i("playback-controls",{staticClass:"playback-stuff",attrs:{timeStart:e.timeStart,timeEnd:e.timeEnd,isRunning:e.myState.isRunning,currentTime:e.simulationTime},on:{click:e.toggleSimulation,time:e.setTime}}):e._e()],1)],1)},oi=[],li=i("2909"),ci=i("7783"),ui={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},hi=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return Object(w["a"])(i,[{key:"getShaders",value:function(){var e=Object(It["a"])(Object(Bt["a"])(i.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if (timeEnd == -1.0 || timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","fs:#main-start":"      if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(It["a"])(Object(Bt["a"])(i.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props.currentTime;e.uniforms=Object.assign({},e.uniforms,{currentTime:t}),Object(It["a"])(Object(Bt["a"])(i.prototype),"draw",this).call(this,e)}}]),i}(zt["a"]);hi.layerName="DrtRequestArcLayer",hi.defaultProps=ui;i("a9e3"),i("aff5"),i("cfc3");var di,pi=i("2b88"),mi=i("050f"),fi=i("2bb8"),vi=i("01a6"),bi=i("ca47"),gi=i("d22f"),yi=(i("90d7"),i("ade3")),ki=i("31d5"),Si=i("a7bc"),Ci=i("7f94"),wi=i("9c99"),Oi=i("2418"),xi=i("ae9c"),ji=i("261f"),_i=1024,Ti=4,Ri=function(){},Di=(di={},Object(yi["a"])(di,vi["a"].TEXTURE_MIN_FILTER,vi["a"].LINEAR_MIPMAP_LINEAR),Object(yi["a"])(di,vi["a"].TEXTURE_MAG_FILTER,vi["a"].LINEAR),Object(yi["a"])(di,vi["a"].TEXTURE_WRAP_S,vi["a"].CLAMP_TO_EDGE),Object(yi["a"])(di,vi["a"].TEXTURE_WRAP_T,vi["a"].CLAMP_TO_EDGE),di);function Ei(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Ai(e,t,i,a){return i===t.width&&a===t.height?t:(e.canvas.height=a,e.canvas.width=i,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,i,a),e.canvas)}function Fi(e){return e&&(e.id||e.url)}function Li(e,t,i,a){var n=t.width,s=t.height,r=Object(ki["a"])(t,{width:i,height:a});return Object(Si["b"])(t,r,{targetX:0,targetY:0,targetZ:0,width:n,height:s}),t.delete(),r}function Mi(e,t,i){for(var a=0;a<t.length;a++){var n=t[a],s=n.icon,r=n.xOffset,o=Fi(s);e[o]=Object.assign({},s,{x:r,y:i})}}function Pi(e){for(var t=e.icons,i=e.buffer,a=e.mapping,n=void 0===a?{}:a,s=e.xOffset,r=void 0===s?0:s,o=e.yOffset,l=void 0===o?0:o,c=e.rowHeight,u=void 0===c?0:c,h=e.canvasWidth,d=[],p=0;p<t.length;p++){var m=t[p],f=Fi(m);if(!n[f]){var v=m.height,b=m.width;r+b+i>h&&(Mi(n,d,l),r=0,l=u+l+i,u=0,d=[]),d.push({icon:m,xOffset:r}),r=r+b+i,u=Math.max(u,v)}}return d.length>0&&Mi(n,d,l),{mapping:n,rowHeight:u,xOffset:r,yOffset:l,canvasWidth:h,canvasHeight:Ei(u+l+i)}}function zi(e,t,i){if(!e||!t)return null;i=i||{};var a,n={},s=Object(xi["a"])(e),r=s.iterable,o=s.objectInfo,l=Object(b["a"])(r);try{for(l.s();!(a=l.n()).done;){var c=a.value;o.index++;var u=t(c,o),h=Fi(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");n[h]||i[h]&&u.url===i[h].url||(n[h]=u)}}catch(d){l.e(d)}finally{l.f()}return n}var Ni=function(){function e(t,i){var a=i.onUpdate,n=void 0===a?Ri:a;Object(C["a"])(this,e),this.gl=t,this.onUpdate=n,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Ti,this._canvasWidth=_i,this._canvasHeight=0,this._canvas=null}return Object(w["a"])(e,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var t=this._autoPacking?Fi(e):e;return this._mapping[t]||{}}},{key:"setProps",value:function(e){var t=e.loadOptions,i=e.autoPacking,a=e.iconAtlas,n=e.iconMapping,s=e.data,r=e.getIcon;t&&(this._loadOptions=t),void 0!==i&&(this._autoPacking=i),r&&(this._getIcon=r),n&&(this._mapping=n),a&&this._updateIconAtlas(a),this._autoPacking&&(s||r)&&"undefined"!==typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(s))}},{key:"_updateIconAtlas",value:function(e){this._texture&&(this._texture.delete(),this._texture=null),e instanceof Ci["a"]?(e.setParameters(Di),this._externalTexture=e,this.onUpdate()):e&&(this._texture=new Ci["a"](this.gl,{data:e,parameters:Di}),this.onUpdate())}},{key:"_updateAutoPacking",value:function(e){var t=Object.values(zi(e,this._getIcon,this._mapping)||{});if(t.length>0){var i=Pi({icons:t,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),a=i.mapping,n=i.xOffset,s=i.yOffset,r=i.rowHeight,o=i.canvasHeight;this._rowHeight=r,this._mapping=a,this._xOffset=n,this._yOffset=s,this._canvasHeight=o,this._texture||(this._texture=new Ci["a"](this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:Di})),this._texture.height!==this._canvasHeight&&(this._texture=Li(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(t)}}},{key:"_loadIcons",value:function(e){var t,i=this,a=this._canvas.getContext("2d"),n=Object(b["a"])(e);try{var s=function(){var e=t.value;i._pendingCount++,Object(Oi["a"])(e.url,wi["a"],i._loadOptions).then((function(t){var n=Fi(e),s=i._mapping[n],r=s.x,o=s.y,l=s.width,c=s.height,u=Ai(a,t,l,c);i._texture.setSubImageData({data:u,x:r,y:o,width:l,height:c}),i._texture.generateMipmap(),i.onUpdate()})).catch((function(e){ji["a"].error(e)()})).finally((function(){i._pendingCount--}))};for(n.s();!(t=n.n()).done;)s()}catch(r){n.e(r)}finally{n.f()}}},{key:"isLoaded",get:function(){return 0===this._pendingCount}}]),e}(),Ii=i("f863").default,Bi=i("0554").default,Vi=[0,0,0,255],$i={iconAtlas:{type:"object",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},noAlloc:!0,iconStill:{type:"object",value:null},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:Vi},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getPathStart:{type:"accessor",value:null},getPathEnd:{type:"accessor",value:null},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},currentTime:{type:"number",value:0},pickable:{type:"boolean",value:!0}},Hi=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return Object(w["a"])(i,[{key:"getShaders",value:function(){return Object(It["a"])(Object(Bt["a"])(i.prototype),"getShaders",this).call(this,{vs:Ii,fs:Bi,modules:[pi["a"],mi["a"]]})}},{key:"initializeState",value:function(){var e=this;this.state={iconManager:new Ni(this.context.gl,{onUpdate:function(){return e._onUpdate()}})};var t=this.getAttributeManager();t.addInstanced({instanceTimestamps:{size:1,accessor:"getTimeStart"},instanceTimestampsNext:{size:1,accessor:"getTimeEnd"},instanceStartPositions:{size:2,accessor:"getPathStart"},instanceEndPositions:{size:2,accessor:"getPathEnd"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColors:{size:this.props.colorFormat.length,type:vi["a"].UNSIGNED_BYTE,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Vi},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(e){var t=e.oldProps,a=e.props,n=e.changeFlags;Object(It["a"])(Object(Bt["a"])(i.prototype),"updateState",this).call(this,{props:a,oldProps:t,changeFlags:n});var s=this.getAttributeManager(),r=a.iconAtlas,o=a.iconMapping,l=a.data,c=a.getIcon,u=this.state.iconManager;u.setProps({loadOptions:a.loadOptions});var h=!1,d=r||this.internalState.isAsyncPropLoading("iconAtlas");if(d?(t.iconAtlas!==a.iconAtlas&&u.setProps({iconAtlas:r,autoPacking:!1}),t.iconMapping!==a.iconMapping&&(u.setProps({iconMapping:o}),h=!0)):u.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&(u.setProps({data:l,getIcon:c}),h=!0),h&&(s.invalidate("instanceOffsets"),s.invalidate("instanceIconFrames")),n.extensionsChanged){var p=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(p)}),s.invalidateAll()}}},{key:"finalizeState",value:function(){Object(It["a"])(Object(Bt["a"])(i.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,i=this.props,a=i.sizeScale,n=i.sizeMinPixels,s=i.sizeMaxPixels,r=i.sizeUnits,o=i.billboard,l=i.alphaCutoff,c=i.currentTime,u=i.iconStill,h=i.pickable,d=this.state.iconManager,p=this.context.viewport,m=d.getTexture();m&&m.loaded&&this.state.model.setUniforms(Object.assign({},t,{iconsTexture:m,iconsTextureDim:[m.width,m.height],sizeScale:a*("pixels"===r?p.metersPerPixel:1),sizeMinPixels:n,sizeMaxPixels:s,billboard:o,alphaCutoff:l,currentTime:c,pickable:h,iconStillOffsets:this.getInstanceOffset(u),iconStillFrames:this.getInstanceIconFrame(u)})).draw()}},{key:"_getModel",value:function(e){var t=[-1,-1,-1,1,1,1,1,-1];return new bi["a"](e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new gi["a"]({drawMode:vi["a"].TRIANGLE_FAN,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"getInstanceOffset",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}},{key:"getInstanceIconFrame",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}},{key:"isLoaded",get:function(){return Object(It["a"])(Object(Bt["a"])(i.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}}]),i}(fi["a"]);Hi.layerName="MovingIconLayer",Hi.defaultProps=$i;var qi=i("125d"),Ui={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},Wi=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return Object(w["a"])(i,[{key:"getShaders",value:function(){var e=Object(It["a"])(Object(Bt["a"])(i.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if(timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        varying float vTime;\n        uniform float searchFlag;\n      ","fs:#main-start":"        if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (searchFlag == 0.0 && vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(It["a"])(Object(Bt["a"])(i.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props,a=t.currentTime,n=t.searchFlag;e.uniforms=Object.assign({},e.uniforms,{currentTime:a,searchFlag:n}),Object(It["a"])(Object(Bt["a"])(i.prototype),"draw",this).call(this,e)}}]),i}(qi["a"]);Wi.layerName="PathTraceLayer",Wi.defaultProps=Ui;var Gi={marker:{x:0,y:0,width:128,height:128,mask:!0},info:{x:128,y:0,width:128,height:128,mask:!0},vehicle:{x:128,y:128,width:128,height:128,mask:!1},diamond:{x:0,y:128,width:128,height:128,mask:!1}},Xi="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",Yi=new Dt["a"]({color:[255,255,255],intensity:1}),Ki=new Et["a"]({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),Ji=new At["a"]({ambientLight:Yi,pointLight:Ki}),Zi={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[Ji]},Qi={latitude:52.1,longitude:14,zoom:10,pitch:0,minZoom:2,maxZoom:22},ea={time:0,fromX:1,fromY:2,toX:3,toY:4,arrival:5};function ta(e){var t=e.simulationTime,i=e.paths,a=e.dark,n=e.traces,s=e.drtRequests,r=e.settingsShowLayers,o=e.center,l=e.vehicleLookup,c=e.searchEnabled,u=e.onClick,h=Zi,p=Object.assign({},Qi);p.latitude=o[1],p.longitude=o[0];var m=2,f=Object(Ye["useState"])({}),v=Object(Tt["a"])(f,2),b=v[0],g=v[1],y=[];function k(){console.log(b),b.object?u(b.object.v):u(null)}function S(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(!i)return null;var s=l[i.v];return Ke.a.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#ddddeedd",borderLeft:"6px solid green",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#223",padding:"1rem 1rem",position:"absolute",left:a+40,top:n-30}},Ke.a.createElement("big",null,Ke.a.createElement("b",null,"Taxi: ",s)),Ke.a.createElement("div",null,"Passagiere: ",i.occ," "))}return r["Routes"]&&y.push(new Wi({id:"Routen",data:n,currentTime:t,getSourcePosition:function(e){return e.p0},getTargetPosition:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getColor:function(t){return e.colors[t.occ]},getWidth:function(e){return 3*(e.occ+1)-1},opacity:.9,widthMinPixels:2,rounded:!1,shadowEnabled:!1,searchFlag:c?1:0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:g})),r["Vehicles"]&&y.push(new Hi({id:"Vehicles",data:i,getPathStart:function(e){return e.p0},getPathEnd:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getIcon:function(e){return"vehicle"},getColor:function(t){return e.colors[t.occ]},iconMoving:"vehicle",iconStill:"diamond",getSize:c?56:44,opacity:1,currentTime:t,shadowEnabled:!1,noAlloc:!0,iconAtlas:"/pave/icon-atlas.png",iconMapping:Gi,sizeScale:1,billboard:!0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:g})),r["Requests"]&&y.push(new hi({id:"DRT Requests",data:s,currentTime:t,getSourcePosition:function(e){return[e[ea.fromX],e[ea.fromY]]},getTargetPosition:function(e){return[e[ea.toX],e[ea.toY]]},getTimeStart:function(e){return e[ea.time]},getTimeEnd:function(e){return e[ea.arrival]},getSourceColor:[255,0,255],getTargetColor:[200,255,255],getWidth:m,opacity:.7,searchFlag:c?1:0})),Ke.a.createElement(Ft["a"],{layers:y,effects:h.effects,pickingRadius:5,initialViewState:p,controller:!0,getCursor:function(){return"pointer"},onClick:k},Ke.a.createElement(Rt["b"],{reuseMaps:!0,mapStyle:a?d.dark:d.light,preventStyleDiffing:!0,mapboxApiAccessToken:Xi}),S({hoverInfo:b}))}_["c"].use(Qt["VuePlugin"]);var ia=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.COLOR_OCCUPANCY={0:[255,255,85],1:[32,96,255],2:[85,255,85],3:[255,85,85],4:[200,0,0]},e.COLOR_OCCUPANCY_MATSIM_UNUSED={0:[255,85,255],1:[255,255,85],2:[85,255,85],3:[85,85,255],4:[255,85,85],5:[255,85,0]},e.SETTINGS={Vehicles:!0,Routes:!0,Requests:!0},e.legendItems=Object.keys(e.COLOR_OCCUPANCY).map((function(t){return{type:c.line,color:e.COLOR_OCCUPANCY[t],value:t,label:t}})),e.legendRequests=[{type:c.line,color:[255,0,255],value:0,label:""}],e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:"",center:[6.5,51]},e.myState={statusMessage:"",clock:"00:00",isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,data:[]},e.timeStart=0,e.timeEnd=86400,e.traces=Object(ci["a"])([]),e.paths=Object(ci["a"])([]),e.requests=Object(ci["a"])([]),e.simulationTime=18e3,e.timeElapsedSinceLastFrame=0,e.searchTerm="",e.searchEnabled=!1,e.globalState=v.state,e.isDarkMode=e.globalState.colorScheme===n.DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.vehicleLookup=[],e.vehicleLookupString={},e.isPausedDueToHiding=!1,e}return Object(w["a"])(i,[{key:"handleSettingChange",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i="",e.t0=t,e.next=0===e.t0?4:1===e.t0?6:2===e.t0?8:10;break;case 4:return i="Vehicles",e.abrupt("break",10);case 6:return i="Routes",e.abrupt("break",10);case 8:return i="Requests",e.abrupt("break",10);case 10:this.SETTINGS[i]=!this.SETTINGS[i],this.updateDatasetFilters(),this.simulationTime+=1;case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),this.vizDetails.center||(this.vizDetails.center=[14,52.1]),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 12:i=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",i),this.buildThumbnail();case 15:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Re.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===n.DarkMode,this.updateLegendColors()}},{key:"handleSearch",value:function(){var e,t,i,a,n,s,r=this.vehicleLookupString[this.searchTerm];r>-1?(console.log("vehicle",r),null===(e=this.pathVehicle)||void 0===e||e.filterExact(r),null===(t=this.traceVehicle)||void 0===t||t.filterExact(r),null===(i=this.requestVehicle)||void 0===i||i.filterExact(r),this.requestStart.filterAll(),this.requestEnd.filterAll(),this.searchEnabled=!0):(console.log("nope"),null===(a=this.pathVehicle)||void 0===a||a.filterAll(),null===(n=this.traceVehicle)||void 0===n||n.filterAll(),null===(s=this.requestVehicle)||void 0===s||s.filterAll(),this.searchEnabled=!1);this.updateDatasetFilters()}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"setWallClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock="".concat(e<10?"0":"").concat(e).concat(t<10?":0":":").concat(t)}},{key:"setTime",value:function(e){this.simulationTime=e,this.setWallClock(),this.traceStart&&this.pathStart&&this.requestStart&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.searchEnabled||(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0]),this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0]))),this.$options.paths=this.paths.allFiltered(),this.$options.traces=this.traces.allFiltered(),this.$options.drtRequests=this.requests.allFiltered()}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.timeElapsedSinceLastFrame=Date.now(),this.myState.isRunning&&0===this.speed&&(this.speed=1),this.myState.isRunning&&this.animate()}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.showHelp=!1,this.generateBreadcrumbs(),this.updateLegendColors(),this.setWallClock(),console.log("loading files"),this.$store.commit("setStatus",{type:a.INFO,msg:"Dateien laden..."}),e.next=14,this.loadFiles();case 14:return t=e.sent,i=t.trips,n=t.drtRequests,console.log("parsing vehicle motion"),this.myState.statusMessage="/ Standorte berechnen...",this.$store.commit("setStatus",{type:a.INFO,msg:"Standorte berechnen..."}),e.next=22,this.parseVehicles(i);case 22:return this.paths=e.sent,this.pathStart=this.paths.dimension((function(e){return e.t0})),this.pathEnd=this.paths.dimension((function(e){return e.t1})),this.pathVehicle=this.paths.dimension((function(e){return e.v})),console.log("Routen verarbeiten..."),this.myState.statusMessage="/ Routen verarbeiten...",this.$store.commit("setStatus",{type:a.INFO,msg:"Routen verarbeiten..."}),e.next=31,this.parseRouteTraces(i);case 31:return this.traces=e.sent,this.traceStart=this.traces.dimension((function(e){return e.t0})),this.traceEnd=this.traces.dimension((function(e){return e.t1})),this.traceVehicle=this.traces.dimension((function(e){return e.v})),console.log("Anfragen sortieren..."),this.myState.statusMessage="/ Anfragen...",this.$store.commit("setStatus",{type:a.INFO,msg:"Anfragen sortieren"}),e.next=40,this.parseDrtRequests(n);case 40:this.requests=e.sent,this.requestStart=this.requests.dimension((function(e){return e[0]})),this.requestEnd=this.requests.dimension((function(e){return e[5]})),this.requestVehicle=this.requests.dimension((function(e){return e[5]})),console.log("GO!"),this.myState.statusMessage="",this.$store.commit("setStatus",{type:a.INFO,msg:""}),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),this.myState.isRunning=!0,this.timeElapsedSinceLastFrame=Date.now(),this.animate();case 51:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"parseDrtRequests",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.vehicleLookup.length){i=Object(b["a"])(t);try{for(i.s();!(a=i.n()).done;){n=a.value;try{n[6]=""}catch(s){}}}catch(r){i.e(r)}finally{i.f()}}return e.abrupt("return",Object(ci["a"])(t));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"parseVehicles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=[],a=-1,e.next=4,Ie["forEachAsync"](t,(function(e){var t=e.path,s=e.timestamps,r=e.passengers;a++,n.vehicleLookup[a]=e.id,n.vehicleLookupString[e.id]=a;for(var o=0;o<e.path.length-1;o++)i.push({t0:s[o],t1:s[o+1],p0:t[o],p1:t[o+1],v:a,occ:r[o]})}));case 4:return e.abrupt("return",Object(ci["a"])(i));case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateDatasetFilters",value:function(){this.traceStart&&this.pathStart&&this.requestStart&&(this.SETTINGS.Routes&&(this.searchEnabled?(this.traceStart.filterAll(),this.traceEnd.filterAll()):(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0])),this.$options.traces=this.traces.allFiltered()),this.SETTINGS.Vehicles&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.$options.paths=this.paths.allFiltered()),this.SETTINGS.Requests&&(this.searchEnabled?(this.requestStart.filterAll(),this.requestEnd.filterAll()):(this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0])),this.$options.drtRequests=this.requests.allFiltered()))}},{key:"animate",value:function(){if(this.myState.isRunning){var e=Date.now()-this.timeElapsedSinceLastFrame;this.timeElapsedSinceLastFrame+=e,this.simulationTime+=e*this.speed*.06,this.updateDatasetFilters(),this.setWallClock(),window.requestAnimationFrame(this.animate)}}},{key:"handleVisibilityChange",value:function(){this.isPausedDueToHiding&&!document.hidden?(console.log("unpausing"),this.isPausedDueToHiding=!1,this.toggleSimulation()):this.myState.isRunning&&document.hidden&&(console.log("pausing"),this.isPausedDueToHiding=!0,this.toggleSimulation())}},{key:"parseRouteTraces",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return 0,i=-1,a=[],e.next=5,Ie["forEachAsync"](t,(function(e){i++;for(var t=e.timestamps[0],n=e.timestamps[0],s=[],r=function(r){n=e.timestamps[r],e.path[r][0]===e.path[r-1][0]&&e.path[r][1]===e.path[r-1][1]?(s.forEach((function(t){t.t1=e.timestamps[r-1]})),a.push.apply(a,Object(li["a"])(s)),s=[],t=n):s.push({t0:t,p0:e.path[r-1],p1:e.path[r],v:i,occ:e.passengers[r-1]})},o=1;o<e.path.length;o++)r(o);s.forEach((function(e){e.t1=n})),a.push.apply(a,Object(li["a"])(s))}));case 5:return e.abrupt("return",Object(ci["a"])(a));case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){document.removeEventListener("visibilityChange",this.handleVisibilityChange),v.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"loadFiles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],i=[],e.prev=2,!this.vizDetails.drtTrips.endsWith("json")){e.next=11;break}return e.next=6,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 6:a=e.sent,t=a.trips,i=a.drtRequests,e.next=29;break;case 11:if(!this.vizDetails.drtTrips.endsWith("gz")){e.next=29;break}return e.next=14,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.drtTrips);case 14:if(n=e.sent,!n){e.next=21;break}return e.next=18,Object(Ne["a"])(n);case 18:e.t0=e.sent,e.next=22;break;case 21:e.t0=null;case 22:return s=e.t0,e.next=25,Ie["run"](ze.a.inflateAsync(s,{to:"string"}));case 25:r=e.sent,o=JSON.parse(r),t=o.trips,i=o.drtRequests;case 29:e.next=35;break;case 31:e.prev=31,e.t1=e["catch"](2),console.error(e.t1),this.myState.statusMessage=""+e.t1;case 35:return console.log({drtRequests:i}),e.abrupt("return",{trips:t,drtRequests:i});case 37:case"end":return e.stop()}}),e,this,[[2,31]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.globalState.colorScheme===n.DarkMode?t:e}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],ia.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ia.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ia.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ia.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],ia.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("globalState.colorScheme")],ia.prototype,"swapTheme",null),Object(j["a"])([Object(_["d"])("searchTerm")],ia.prototype,"handleSearch",null),ia=Object(j["a"])([Object(_["a"])({components:{CollapsiblePanel:Xe,SettingsPanel:pt,LegendColors:Je,TripViz:ta,VueSlider:je.a,PlaybackControls:st,ToggleButton:_e["ToggleButton"]}})],ia),v.commit("registerPlugin",{kebabName:"vehicle-animation",prettyName:"Trip Viewer",description:"Deck.gl based trip viewer",filePatterns:["viz-vehicles*.y?(a)ml"],component:ia});var aa=ia,na=aa,sa=(i("7a14"),i("7c4c")),ra=Object(L["a"])(na,ri,oi,!1,null,"9ad50e04",null);"function"===typeof sa["default"]&&Object(sa["default"])(ra);var oa=ra.exports,la=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"xy-hexagons",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded?i("xy-hex-layer",{staticClass:"anim",attrs:{center:e.center,data:e.requests,dark:e.isDarkMode,extrude:e.extrudeTowers,radius:e.radius,maxHeight:e.maxHeight}}):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"left-side"},[i("collapsible-panel",{attrs:{darkMode:!0,width:"300",direction:"left"}},[i("div",{staticClass:"panel-items"},[i("p",{staticClass:"big xtitle"},[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])])])],1):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{darkMode:!0,width:"150",direction:"right"}},[i("div",{staticClass:"panel-items"},[i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Aggregate")]),i("div",{staticClass:"buttons has-addons"},e._l(Object.keys(e.aggregations),(function(t){return i("button",{key:t,staticClass:"button is-small is-dark",class:{"is-danger":e.activeAggregation===t},on:{click:function(i){return e.handleOrigDest(t)}}},[e._v(e._s(t))])})),0)]),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Show in 3D")]),i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.extrudeTowers,labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){e.extrudeTowers=!e.extrudeTowers}}})],1),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Max Height: "+e._s(e.maxHeight))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:100,max:1e3,interval:50,duration:0,dotSize:16,tooltip:"none"},model:{value:e.maxHeight,callback:function(t){e.maxHeight=t},expression:"maxHeight"}})],1),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Radius: "+e._s(e.radius))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:50,max:1e3,interval:5,duration:0,dotSize:16,tooltip:"none"},model:{value:e.radius,callback:function(t){e.radius=t},expression:"radius"}})],1)])])],1):e._e(),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"nav"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},ca=[],ua=(i("f00c"),i("b680"),i("4ce1")),ha="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",da={ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},pa={zoom:10,minZoom:5,maxZoom:15,pitch:30,bearing:0},ma={light:[[250,245,120],[255,210,90],[180,240,150],[70,220,150],[40,110,250],[140,0,40]],dark:[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]]};function fa(e){var t=e.object;if(!t||!t.position||!t.position.length)return null;var i=t.position[1],a=t.position[0],n=t.points.length;return{text:"    ".concat(n," Pickups\n    latitude: ").concat(Number.isFinite(i)?i.toFixed(6):"","\n    longitude: ").concat(Number.isFinite(a)?a.toFixed(6):"","\n    ")}}function va(e){var t=e.data,i=void 0===t?[]:t,a=e.dark,n=void 0!==a&&a,s=(e.mapStyle,e.radius),r=void 0===s?100:s,o=e.upperPercentile,l=void 0===o?100:o,c=e.coverage,u=void 0===c?.8:c,h=e.extrude,p=void 0===h||h,m=e.maxHeight,f=void 0===m?200:m,v=e.center,b=void 0===v?[14.34,52.3]:v,g=Object(Tt["a"])(b,2),y=g[0],k=g[1],S=Object.assign(pa,{longitude:y,latitude:k}),C=[new ua["a"]({id:"hexlayer",colorRange:n?ma["dark"]:ma["light"],coverage:u,data:i,autoHighlight:!0,elevationRange:[0,f],elevationScale:i&&i.length?50:0,extruded:p,getPosition:function(e){return e},pickable:!0,opacity:.7,radius:r,upperPercentile:l,material:da,transitions:{elevationScale:{type:"interpolation",duration:1e3}}})];return Ke.a.createElement(Ft["a"],{layers:C,initialViewState:S,controller:!0,getTooltip:fa},Ke.a.createElement(Rt["a"],{reuseMaps:!0,mapStyle:n?d.dark:d.light,preventStyleDiffing:!0,mapboxApiAccessToken:ha}))}var ba=i("a79f");function ga(e,t){return Object(ba["default"])(e,"WGS84",t)}ba["default"].defs([["EPSG:2048","+proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:31468","+proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=4500000 +y_0=0 +ellps=bessel +datum=potsdam +units=m +no_defs"],["EPSG:25833","+proj=utm +zone=33 +ellps=GRS80 +units=m +no_defs"],["EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs"]]),ba["default"].defs("DK4",ba["default"].defs("EPSG:31468")),ba["default"].defs("GK4",ba["default"].defs("EPSG:31468")),ba["default"].defs("Cottbus",ba["default"].defs("EPSG:25833")),ba["default"].defs("Berlin",ba["default"].defs("EPSG:31468")),ba["default"].defs("South Africa",ba["default"].defs("EPSG:2048"));var ya={toLngLat:ga};_["c"].use(Qt["VuePlugin"]);var ka=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.radius=250,e.maxHeight=200,e.extrudeTowers=!1,e.vizDetails={title:"",description:"",file:"",projection:"",thumbnail:"",data:{}},e.myState={statusMessage:"",fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.requests=[],e.searchTerm="",e.searchEnabled=!1,e.globalState=v.state,e.isDarkMode=e.globalState.colorScheme===n.DarkMode,e.isLoaded=!1,e.activeAggregation="",e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.center=[0,0],e.rawRequests=[],e.aggregations={},e}return Object(w["a"])(i,[{key:"handleOrigDest",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.activeAggregation=t,i=this.aggregations[t],this.requests=this.rawRequests.map((function(e){return[e[i[0]],e[i[1]]]}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.fileSystem)return[];var e,t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i);try{for(n.s();!(e=n.n()).done;){var s=e.value;s&&(a+=s,t.push({label:s,url:"/"+this.myState.fileSystem.url+a}))}}catch(r){n.e(r)}finally{n.f()}return t.push({label:this.vizDetails.title,url:"#"}),v.commit("setBreadCrumbs",t),t}},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status?v.commit("requestLogin",this.myState.fileSystem.url):this.$store.commit("setStatus",{type:a.WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(this.myState.yamlConfig)});case 11:i=this.vizDetails.title?this.vizDetails.title:"Hex Aggregation",this.$emit("title",i);case 13:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Re.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===n.DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"findCenter",value:function(e){var t="";for(t in this.aggregations)break;for(var i=this.aggregations[t][0],a=this.aggregations[t][1],n=0,s=0,r=0,o=0;o<e.length;o+=64)r++,n+=e[o][i],s+=e[o][a];return n/=r,s/=r,[n,s]}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.generateBreadcrumbs(),this.myState.statusMessage="".concat(this.$i18n.t("loading")),console.log("loading files"),e.next=11,this.loadFiles();case 11:return t=e.sent,i=t.dataArray,this.rawRequests=i,this.aggregations=this.parseAggregations(),e.next=17,this.reproject();case 17:this.center=this.findCenter(this.rawRequests),this.isLoaded=!0,this.buildThumbnail(),this.myState.statusMessage="".concat(this.$i18n.t("sorting")),this.handleOrigDest(Object.keys(this.aggregations)[0]),this.myState.statusMessage="";case 23:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"parseAggregations",value:function(){var e,t={},i=Object(b["a"])(this.vizDetails.data.aggregations);try{for(i.s();!(e=i.n()).done;){var a=e.value;t[a.title]=[a.x,a.y]}}catch(n){i.e(n)}finally{i.f()}return t}},{key:"reproject",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.vizDetails.projection){e.next=2;break}return e.abrupt("return");case 2:this.myState.statusMessage="Reprojecting...",t=regeneratorRuntime.mark((function e(){var t,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a[i],s=n.aggregations[t][0],r=n.aggregations[t][1],e.next=5,Ie["forEachAsync"](n.rawRequests,(function(e){var t=ya.toLngLat(n.vizDetails.projection,{x:e[s],y:e[r]});e[s]=t.x,e[r]=t.y}));case 5:case"end":return e.stop()}}),e)})),i=0,a=Object.keys(this.aggregations);case 5:if(!(i<a.length)){e.next=10;break}return e.delegateYield(t(),"t0",7);case 7:i++,e.next=5;break;case 10:this.myState.statusMessage="";case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){v.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"loadFiles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,n,s,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,i="",n="".concat(this.myState.subfolder,"/").concat(this.vizDetails.file),!this.vizDetails.file.endsWith("gz")){e.next=21;break}return e.next=7,this.myState.fileApi.getFileBlob(n);case 7:if(s=e.sent,!s){e.next=14;break}return e.next=11,Object(Ne["a"])(s);case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=null;case 15:return r=e.t0,e.next=18,Ie["run"](ze.a.inflateAsync(r,{to:"string"}));case 18:i=e.sent,e.next=24;break;case 21:return e.next=23,this.myState.fileApi.getFileText(n);case 23:i=e.sent;case 24:if(!(this.vizDetails.file.indexOf(".json")>-1)){e.next=31;break}return e.next=27,Ie["parseAsync"](i);case 27:o=e.sent,t=o[this.vizDetails.data.elements],e.next=33;break;case 31:l=ke.a.parse(i,{header:!0,skipEmptyLines:!0,dynamicTyping:!0}),t=l.data;case 33:e.next=40;break;case 35:e.prev=35,e.t1=e["catch"](1),console.error(e.t1),this.myState.statusMessage=""+e.t1,this.$store.commit("setStatus",{type:a.WARNING,msg:"Error loading/parsing: ".concat(this.myState.subfolder,"/").concat(this.vizDetails.file)});case 40:return console.log({dataArray:t}),e.abrupt("return",{dataArray:t});case 42:case"end":return e.stop()}}),e,this,[[1,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.globalState.colorScheme===n.DarkMode?t:e}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],ka.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ka.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ka.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ka.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],ka.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("globalState.colorScheme")],ka.prototype,"swapTheme",null),ka=Object(j["a"])([Object(_["a"])({components:{CollapsiblePanel:Xe,XyHexLayer:va,VueSlider:je.a,ToggleButton:_e["ToggleButton"]}})],ka),v.commit("registerPlugin",{kebabName:"xy-hexagons",prettyName:"XY Aggregator",description:"Collects XY data into geographic hexagons",filePatterns:["viz-xy*.y?(a)ml"],component:ka});var Sa=ka,Ca=Sa,wa=(i("fe7c"),i("5ad6")),Oa=Object(L["a"])(Ca,la,ca,!1,null,"14fe79de",null);"function"===typeof wa["default"]&&Object(wa["default"])(Oa);var xa=Oa.exports,ja=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{id:"v3-app"}},[!e.thumbnail&&e.vizDetails.network?a("animation-view",{staticClass:"anim",attrs:{vizState:e.myState,speed:e.speed,fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,vizDetails:e.vizDetails},on:{loaded:e.toggleLoaded}}):e._e(),e.thumbnail?e._e():a("modal-markdown-dialog",{class:{"is-active":e.showHelp},attrs:{id:"help-dialog",title:"DRT Vehicles",md:"@/assets/animation-helptext.md",buttons:["OK"]},on:{click:function(t){return e.clickedCloseHelp()}}}),e.thumbnail?e._e():a("div",{staticClass:"nav"},[a("p",{staticClass:"big day"},[e._v(e._s(e.vizDetails.title))]),e.myState.statusMessage?a("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):a("p",{staticClass:"big time"},[e._v(e._s(e.myState.clock))])]),a("div",{staticClass:"right-side"},[e.isLoaded?a("div",{staticClass:"morestuff"},[a("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}}),a("p",{staticClass:"speed-label",style:{color:e.textColor.text}},[e._v(e._s(e.speed)+"x speed")])],1):e._e()]),e.isLoaded?a("playback-controls",{staticClass:"playback-stuff",on:{click:e.toggleSimulation}}):e._e(),e.isLoaded?a("div",{staticClass:"extra-buttons"},[a("div",{staticClass:"help-button",attrs:{title:"info"},on:{click:e.clickedHelp}},[a("i",{staticClass:"help-button-text fa fa-1x fa-question"})]),a("img",{staticClass:"theme-button",attrs:{src:i("0386"),title:"dark/light theme"},on:{click:e.rotateColors}})]):e._e()],1)},_a=[],Ta=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"anim-container"}})},Ra=[],Da=i("9037"),Ea=i("5a89"),Aa=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(e,a,n){var s;Object(C["a"])(this,i),s=t.call(this),s.tripsPerAgent={},s.midX=a,s.midY=n;for(var r=[],o=[],l=0,c=Object.keys(e);l<c.length;l++){var u=c[l],h=e[u];s.buildWaypoints(h,r,o)}return s.setAttribute("position",new Ea["f"](r,3)),s.setAttribute("position2",new Ea["f"](o,3)),s}return Object(w["a"])(i,[{key:"buildWaypoints",value:function(e,t,i){var a=e.time.length;if(!(a<2)){var n=0;if(0!==e.time[0]){var s=e.path[0][0]-this.midX,r=e.path[0][1]-this.midY,o=e.time[0];t.push(s,r,0),i.push(s,r,o),n++}for(var l=0;l<a-1;l++){var c=e.path[l][0]-this.midX,u=e.path[l][1]-this.midY,h=e.time[l];t.push(c,u,h);var d=e.path[l+1][0]-this.midX,p=e.path[l+1][1]-this.midY,m=e.time[l+1];i.push(d,p,m),n++}this.tripsPerAgent[e.id]=n}}}]),i}(Ea["b"]),Fa=Aa,La=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.call(this),e.SIMULATION_PERCENT="sim-percent",e.DRAG="sim-drag",e}return i}(_["c"]);La=Object(j["a"])([_["a"]],La);var Ma,Pa,za,Na=new La,Ia=Na,Ba=Object(L["a"])(Ia,Ma,Pa,!1,null,null,null),Va=Ba.exports,$a=i("c162"),Ha=i.n($a);(function(e){e["FetchXML"]="FetchXML"})(za||(za={}));var qa=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.call(this,new Ha.a)}return Object(w["a"])(i,[{key:"fetchXML",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(za.FetchXML,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(St,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(Ot),Ua=function(e){Object(O["a"])(a,e);var t=Object(x["a"])(a);function a(){var e;return Object(C["a"])(this,a),e=t.apply(this,arguments),e.timeFactor=600,e.myState=e.vizState,e.timeDirection=1,e.vertexShader=i("e9b2").default,e.fragmentShader=i("a278").default,e.globalState=v.state,e.colors=e.myState.colorScheme==n.DarkMode?h:u,e.simulationTime=0,e.animationTimeSinceUnpaused=0,e.clock=new Ea["c"](!1),e.nextClockUpdateTime=0,e.scene=new Ea["p"],e.renderer=new Ea["y"]({antialias:!0}),e.network={nodes:{},links:{}},e.OrbitControl=i("d1f5"),e.linkMaterial=new Ea["i"]({color:e.colors.links}),e.xRange=[1e25,-1e25],e.yRange=[1e25,-1e25],e.midpointX=36e4,e.midpointY=5715e3,e.tripList={},e.wasSimulationRunning=!0,e.networkLayers=[],e.tempStreamBuffer="",e}return Object(w["a"])(a,[{key:"speedChanged",value:function(){this.myState.isRunning=!0;var e=this.speed<0?-1:1;e!==this.timeDirection&&(this.clock.stop(),this.clock=new Ea["c"](!1),this.timeDirection=e,this.clock.start(),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused),console.log("done flip"))}},{key:"playPauseSim",value:function(){this.myState.isRunning?(this.clock.start(),requestAnimationFrame(this.animate)):(this.clock.stop(),this.clock=new Ea["c"](!1),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused))}},{key:"switchColorScheme",value:function(e){this.colors=e==n.LightMode?u:h,this.scene.background=new Ea["d"](this.colors.background);var t=this.scene.getObjectByName("network");t&&this.scene.remove(t),this.linkMaterial.dispose(),this.linkMaterial=new Ea["i"]({color:this.colors.links});var i,a=Object(b["a"])(this.networkLayers);try{for(a.s();!(i=a.n()).done;){var s=i.value,r=s.name,o=this.scene.getObjectByName(r);o&&this.scene.remove(o);var l=new Ea["j"](s.geometry,this.linkMaterial);l.name=r,this.scene.add(l)}}catch(c){a.e(c)}finally{a.f()}}},{key:"mounted",value:function(){this.setInitialClockTime(),this.setupSimulation(),this.setupDragListener(),window.addEventListener("resize",this.onWindowResize,!1),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)}},{key:"setInitialClockTime",value:function(){var e=""+this.$route.query.start;if(e&&NaN!=parseInt(e)){var t=parseInt(e);t>=0&&(this.simulationTime=t,this.setVisibleClock(),this.$nextTick())}}},{key:"handleVisibilityChange",value:function(){console.log("window visibility changed!! hidden:",document.hidden)}},{key:"setupDragListener",value:function(){var e=this;Va.$on(Va.DRAG,(function(t){-1===t?(e.wasSimulationRunning=e.myState.isRunning,e.myState.isRunning=!1):-2===t?e.myState.isRunning=e.wasSimulationRunning:(e.simulationTime=e.nextClockUpdateTime=t,e.animate())}))}},{key:"exitSimulation",value:function(){this.clock=new Ea["c"](!1),this.simulationTime=0,this.nextClockUpdateTime=0,this.timeDirection=1;while(this.scene.children.length)this.scene.remove(this.scene.children[0])}},{key:"beforeDestroy",value:function(){this.exitSimulation(),window.removeEventListener("resize",this.onWindowResize),document.removeEventListener("visibilityChange",this.handleVisibilityChange),Va.$off(Va.DRAG),this.agentMaterial&&this.agentMaterial.dispose(),this.agentGeometry&&this.agentGeometry.dispose();var e,t=Object(b["a"])(this.networkLayers);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.geometry.dispose()}}catch(a){t.e(a)}finally{t.f()}this.linkMaterial.dispose(),this.scene.dispose()}},{key:"onWindowResize",value:function(){if(this.container=document.getElementById("anim-container"),this.container&&this.camera){this.renderer.domElement;this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}}},{key:"setupSimulation",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.initScene(),this.myState.statusMessage="loading agents",e.next=4,this.loadTrips();case 4:return this.finishedLoadingTrips(),e.next=7,this.addNetworkToScene();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startSimulation",value:function(){this.$emit("loaded",!0),this.myState.isShowingHelp||(this.clock.start(),this.animate(),this.myState.isRunning=!0)}},{key:"networkLayerAdder",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t,i,a){var n,s,r,o,l,c,u,h,d,p,m,f,v,b,g,y=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=2e4,!(a>i.length)){e.next=5;break}return this.myState.statusMessage="",this.startSimulation(),e.abrupt("return");case 5:for(s=[],r=a,o=a+n>i.length?i.length:a+n,l=0,c=r;c<o;c++)u=i[c],h=t[u.from],d=t[u.to],h&&d?(p=new Ea["x"](h.x,h.y,0),m=new Ea["x"](d.x,d.y,0),f=(new Ea["b"]).setFromPoints([p,m]),s.push(f)):(l++,l<20&&console.log({badlink:u}));v=Da["a"].mergeBufferGeometries(s),b=new Ea["j"](v,this.linkMaterial),b.name="network"+a,this.scene.add(b),this.camera&&this.renderer.render(this.scene,this.camera),this.networkLayers.push(b),v.dispose(),g=a+n,setTimeout((function(){y.networkLayerAdder(t,i,g)}),1);case 19:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}()},{key:"createNodesAndLinksFromXML",value:function(e){var t,i=e,a=i.network.nodes[0].node,n=i.network.links[0].link,s=Object(b["a"])(a);try{for(s.s();!(t=s.n()).done;){var r=t.value,o=r.$;o.x=parseFloat(o.x),o.y=parseFloat(o.y),this.network.nodes[o.id]=o}}catch(d){s.e(d)}finally{s.f()}var l,c=Object(b["a"])(n);try{for(c.s();!(l=c.n()).done;){var u=l.value,h=u.$;this.network.links[h.id]=h}}catch(d){c.e(d)}finally{c.f()}}},{key:"addNetworkToScene",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.statusMessage="loading network",this.networkLayers=[],e.prev=2,this.myState.fileSystem){e.next=5;break}return e.abrupt("return");case 5:return console.log({vizDetails:this.vizDetails}),e.next=8,qa.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 8:return this._roadFetcher=e.sent,e.next=11,this._roadFetcher.fetchXML();case 11:for(a in t=e.sent,this._roadFetcher.destroy(),console.log({xml:t}),this.createNodesAndLinksFromXML(t),i={},this.network.nodes)n=this.network.nodes[a],i[a]={x:n.x-this.midpointX,y:n.y-this.midpointY};this.networkLayerAdder(i,Object.values(this.network.links),0),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](2),console.error({e:e.t0}),this.myState.statusMessage=""+e.t0;case 24:case"end":return e.stop()}}),e,this,[[2,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadTrips",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.tripList={},e.prev=1,e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 4:t=e.sent,i=Object(b["a"])(t.split("\n"));try{for(i.s();!(a=i.n()).done;)n=a.value,n&&(s=JSON.parse(n),this.tripList[s.id]=s)}catch(r){i.e(r)}finally{i.f()}e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"finishedLoadingTrips",value:function(){this.agentGeometry&&this.agentGeometry.dispose(),this.agentGeometry=new Fa(this.tripList,this.midpointX,this.midpointY),this.agentMaterial||(this.agentMaterial=new Ea["q"]({uniforms:{simulationTime:{value:0},colorLinks:{value:new Ea["d"](this.colors.links)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,blending:Ea["l"],depthTest:!0,transparent:!0}));var e=new Ea["n"](this.agentGeometry,this.agentMaterial);e.name="agents";var t=this.scene.getObjectByName("agents");t&&this.scene.remove(t),this.scene.add(e),this.camera&&this.renderer.render(this.scene,this.camera),this.myState.statusMessage="loading network"}},{key:"initScene",value:function(){if(this.container=document.getElementById("anim-container"),this.container){this.scene.background=new Ea["d"](this.colors.background),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.container.appendChild(this.renderer.domElement);var e=1,t=1e5;this.camera=new Ea["m"](170,this.container.clientWidth/this.container.clientHeight,e,t),this.cameraControls=new this.OrbitControl.MapControls(this.camera,this.renderer.domElement),this.cameraControls.enablePan=!0,this.cameraControls.screenSpacePanning=!0,this.cameraControls.enableZoom=!0,this.cameraControls.enableRotate=!1,this.camera.position.set(0,0,750),this.camera.lookAt(0,0,-1),this.cameraControls.update(),this.renderer.render(this.scene,this.camera)}}},{key:"moveCameraWhilePaused",value:function(){this.camera&&(this.myState.isRunning||(this.renderer.render(this.scene,this.camera),this.cameraControls.update(),requestAnimationFrame(this.moveCameraWhilePaused)))}},{key:"setVisibleClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock=(e<10?"0":"")+e+(t<10?":0":":")+t}},{key:"animate",value:function(){var e=this.clock.getElapsedTime(),t=this.timeFactor*this.speed*(e-this.animationTimeSinceUnpaused);this.animationTimeSinceUnpaused=e,this.simulationTime=this.simulationTime+t,this.simulationTime<0&&(this.myState.isRunning=!1,this.simulationTime=0),this.agentMaterial&&(this.agentMaterial.uniforms["simulationTime"].value=this.simulationTime),this.simulationTime*this.timeDirection>=this.nextClockUpdateTime*this.timeDirection&&(this.setVisibleClock(),this.nextClockUpdateTime+=60*this.timeDirection,Va.$emit(Va.SIMULATION_PERCENT,this.simulationTime/86400)),this.camera&&this.renderer.render(this.scene,this.camera),this.cameraControls.update(),this.myState.isRunning&&requestAnimationFrame(this.animate)}}]),a}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],Ua.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ua.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ua.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ua.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Ua.prototype,"speed",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Ua.prototype,"vizState",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Ua.prototype,"vizDetails",void 0),Object(j["a"])([Object(_["d"])("speed")],Ua.prototype,"speedChanged",null),Object(j["a"])([Object(_["d"])("myState.isRunning")],Ua.prototype,"playPauseSim",null),Object(j["a"])([Object(_["d"])("myState.colorScheme")],Ua.prototype,"switchColorScheme",null),Ua=Object(j["a"])([_["a"]],Ua);var Wa=Ua,Ga=Wa,Xa=(i("beb0"),Object(L["a"])(Ga,Ta,Ra,!1,null,"2faac81a",null)),Ya=Xa.exports,Ka=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"modal"},[i("div",{staticClass:"modal-background"}),i("div",{staticClass:"modal-card"},[i("header",{staticClass:"modal-card-head"},[i("p",{staticClass:"modal-card-title"},[e._v(e._s(e.title))]),i("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){return e.clicked("close")}}})]),i("section",{staticClass:"modal-card-body"},[i("div",{staticClass:"content"},[i("div",{staticClass:"my-html",domProps:{innerHTML:e._s(e.html)}})])]),i("footer",{staticClass:"modal-card-foot"},[1==e.buttons.length?i("button",{staticClass:"button is-link",on:{click:function(t){return e.clicked(e.buttons[0])}}},[e._v(e._s(e.buttons[0]))]):e._e(),e._l(e.buttons.slice(1),(function(t){return i("button",{key:t,staticClass:"button",on:{click:function(i){return e.clicked(t)}}},[e._v(e._s(t))])}))],2)])])},Ja=[],Za=function(e){Object(O["a"])(a,e);var t=Object(x["a"])(a);function a(){var e;return Object(C["a"])(this,a),e=t.apply(this,arguments),e.html="",e}return Object(w["a"])(a,[{key:"mounted",value:function(){this.html=i("818f")}},{key:"clicked",value:function(e){this.$emit("click",e)}}]),a}(_["c"]);Object(j["a"])([Object(_["b"])({required:!0})],Za.prototype,"title",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Za.prototype,"md",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Za.prototype,"buttons",void 0),Za=Object(j["a"])([Object(_["a"])({components:{},props:{}})],Za);var Qa=Za,en=Qa,tn=(i("a722"),Object(L["a"])(en,Ka,Ja,!1,null,"5b9cdc97",null)),an=tn.exports,nn=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:""},e.myState={statusMessage:"",clock:"00:00",colorScheme:n.DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.globalState=v.state,e.isDarkMode=e.myState.colorScheme===n.DarkMode,e.isLoaded=!1,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e}return Object(w["a"])(i,[{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 11:i=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",i),this.buildThumbnail();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Re.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===n.DarkMode,this.updateLegendColors()}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){var e=this.myState.colorScheme==n.LightMode?u:h;this.legendBits=[{label:"susceptible",color:e.susceptible},{label:"latently infected",color:e.infectedButNotContagious},{label:"contagious",color:e.contagious},{label:"symptomatic",color:e.symptomatic},{label:"seriously ill",color:e.seriouslyIll},{label:"critical",color:e.critical},{label:"recovered",color:e.recovered}]}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.myState.isRunning&&0===this.speed&&(this.speed=1)}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.showHelp=!1,this.updateLegendColors();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){v.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"clickedHelp",value:function(){console.log("HEEELP!"),this.myState.isRunning=!1,this.showHelp=!0,this.myState.isShowingHelp=this.showHelp}},{key:"clickedCloseHelp",value:function(){this.showHelp=!1,this.myState.isShowingHelp=this.showHelp,this.myState.isRunning=!0}},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===n.DarkMode?n.LightMode:n.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===n.DarkMode?t:e}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],nn.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],nn.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],nn.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],nn.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],nn.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("state.colorScheme")],nn.prototype,"swapTheme",null),nn=Object(j["a"])([Object(_["a"])({components:{AnimationView:Ya,ModalMarkdownDialog:an,PlaybackControls:st,VueSlider:je.a,ToggleButton:_e["ToggleButton"]}})],nn),v.commit("registerPlugin",{kebabName:"agent-animation",prettyName:"Agent Animation",description:"birds",filePatterns:["viz-agent-anim*.y?(a)ml"],component:nn});var sn=nn,rn=sn,on=(i("36a2"),Object(L["a"])(rn,ja,_a,!1,null,"73f031bc",null)),ln=on.exports,cn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"gl-viz",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded?i("link-gl-layer",{staticClass:"anim",attrs:{geojson:e.geojsonData,build:e.csvData,base:e.csvBase,buildData:e.buildData,baseData:e.baseData,showDiffs:e.showDiffs,colors:e.selectedColorRamp,scaleWidth:e.scaleWidth,dark:e.isDarkMode,center:e.center}}):e._e(),e.thumbnail?e._e():i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{darkMode:e.isDarkMode,width:"256",direction:"right"}},[i("div",{staticClass:"panel-items"},[i("div",{staticClass:"panel-item"},[i("h3",[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])]),i("div",{staticClass:"panel-item"},[i("config-panel",{attrs:{header:e.csvData.header,activeColumn:e.csvData.activeColumn,scaleWidth:e.scaleWidth,selectedColorRamp:e.selectedColorRamp,csvData:e.csvData,useSlider:e.vizDetails.useSlider},on:{colors:e.clickedColorRamp,column:e.handleNewDataColumn,slider:e.handleNewDataColumn,scale:e.handleScaleWidthChanged}})],1),e.csvBase.header.length?i("div",{staticClass:"panel-item diff-section"},[i("p",[i("b",[e._v(e._s(e.$t("showDiffs")))])]),i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.showDiffs,labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){e.showDiffs=!e.showDiffs}}})],1):e._e()])])],1),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"nav"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},un=[],hn=(i("cb29"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)}),dn=[],pn=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=e.stops[0]||"...",e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,adsorb:!0,marks:e.stops.filter((function(e,t){return t%6===0})),contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},"tooltip-placement":"bottom",data:e.stops},e}return Object(w["a"])(i,[{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])()],pn.prototype,"useRange",void 0),Object(j["a"])([Object(_["b"])({required:!0})],pn.prototype,"stops",void 0),Object(j["a"])([Object(_["d"])("useRange")],pn.prototype,"changeUseRange",null),Object(j["a"])([Object(_["d"])("sliderValue")],pn.prototype,"sliderChangedEvent",null),pn=Object(j["a"])([Object(_["a"])({components:{"vue-slider":je.a}})],pn);var mn=pn,fn=mn,vn=(i("3432"),Object(L["a"])(fn,hn,dn,!1,null,"0b2d8627",null)),bn=vn.exports,gn=function(){var e=this,t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"config-panel"},[t.useSlider?a("div",{staticClass:"panel-item"},[a("p",[a("b",[t._v(t._s(t.$t("timeOfDay")))])]),t.activeColumn<0?a("button",{staticClass:"button full-width is-warning is-loading",attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"}}):a("time-slider",{staticClass:"time-slider",attrs:{useRange:!1,stops:t.csvData.header},on:{change:t.debounceTimeSlider}})],1):t._e(),t.useSlider?t._e():a("div",{staticClass:"panel-item"},[a("p",[a("b",[t._v(t._s(t.$t("selectColumn")))])]),a("div",{staticClass:"dropdown full-width",class:{"is-active":t.isButtonActive}},[a("div",{staticClass:"dropdown-trigger"},[a("button",{staticClass:"full-width is-warning button",class:{"is-loading":t.activeColumn<0},attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"},on:{click:t.handleClickDropdown}},[a("b",[t._v(t._s(t.buttonTitle))]),t._m(0)])]),a("div",{staticClass:"dropdown-menu",style:{"max-height":"24rem","overflow-y":"auto",border:"1px solid #ccc"},attrs:{id:"dropdown-menu-column-selector",role:"menu"}},[a("div",{staticClass:"dropdown-content"},t._l(t.header,(function(e){return a("a",{staticClass:"dropdown-item",on:{click:function(i){return t.handleSelectColumn(e)}}},[t._v(t._s(e))])})),0)])])]),a("div",{staticClass:"panel-item",class:{"vert-space":!t.useSlider}},[a("p",[a("b",[t._v(t._s(t.$t("bandwidths")))])]),a("div",{staticClass:"options",staticStyle:{display:"flex","flex-direction":"column"}},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.scaleWidthValue,expression:"scaleWidthValue",modifiers:{number:!0}}],staticClass:"input",domProps:{value:t.scaleWidthValue},on:{input:function(e){e.target.composing||(t.scaleWidthValue=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])]),t.activeColumn>-1?a("div",{staticClass:"panel-item color-picker"},[a("p",[a("b",[t._v(t._s(t.$t("colors"))),a("div",{staticClass:"dropdown full-width",class:{"is-active":t.isColorButtonActive}},[a("div",{staticClass:"dropdown-trigger"},[a("img",{staticClass:"color-button",style:[t.isDarkMode?{transform:"scaleX(1)"}:{transform:"scaleX(-1)"}],attrs:{src:"/pave/colors/scale-"+t.selectedColorRamp+".png"},on:{click:function(){return e.isColorButtonActive=!e.isColorButtonActive}}})]),a("div",{staticClass:"dropdown-menu",attrs:{id:"dropdown-menu-color-selector",role:"menu"}},[a("div",{staticClass:"dropdown-content",style:{padding:"0 0"}},t._l(Object.keys(t.colorRamps),(function(e){return a("a",{staticClass:"dropdown-item",style:{padding:"0.25rem 0.25rem"},on:{click:function(i){return t.handleColorRamp(e)}}},[a("img",{staticClass:"swapColor",style:[t.isDarkMode?{transform:"scaleX(1)"}:{transform:"scaleX(-1)"}],attrs:{src:"/pave/colors/scale-"+e+".png"}}),a("p",{style:{lineHeight:"1rem",marginBottom:"0.25rem"}},[t._v(t._s(e))])])})),0)])])])])]):t._e()])},yn=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon is-small"},[i("i",{staticClass:"fas fa-angle-down",attrs:{"aria-hidden":"true"}})])}],kn=i("b012"),Sn=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.isButtonActive=!1,e.isColorButtonActive=!1,e.scaleWidthValue="250",e.colorRamps={viridis:{png:"scale-viridis.png"},inferno:{png:"scale-inferno.png"},bluered:{png:"scale-salinity.png",diff:!0},picnic:{png:"scale-picnic.png"}},e.globalState=v.state,e.isDarkMode=e.globalState.colorScheme===n.DarkMode,e.debounceScale=Object(kn["debounce"])(e.gotNewScale,500),e.debounceTimeSlider=Object(kn["debounce"])(e.changedTimeSlider,250),e}return Object(w["a"])(i,[{key:"mounted",value:function(){this.scaleWidthValue=""+this.scaleWidth}},{key:"handleScaleChanged",value:function(){isNaN(parseFloat(this.scaleWidthValue))||this.debounceScale()}},{key:"changeColorForDarkMode",value:function(){var e;if(this.isDarkMode?document.getElementsByClassName("color-button")[0].style.transform="scaleX(1)":document.getElementsByClassName("color-button")[0].style.transform="scaleX(-1)",this.isDarkMode)for(e=0;e<document.getElementsByClassName("swapColor").length;e++)document.getElementsByClassName("swapColor")[e].style.transform="scaleX(1)";else for(e=0;e<document.getElementsByClassName("swapColor").length;e++)document.getElementsByClassName("swapColor")[e].style.transform="scaleX(-1)"}},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===n.DarkMode,this.changeColorForDarkMode()}},{key:"gotNewScale",value:function(){this.$emit("scale",parseFloat(this.scaleWidthValue))}},{key:"changedTimeSlider",value:function(e){console.log("new slider!",e),e.length&&1===e.length&&(e=e[0]),this.$emit("slider",e)}},{key:"handleClickDropdown",value:function(){this.isButtonActive=!this.isButtonActive}},{key:"handleColorRamp",value:function(e){console.log(e),this.isColorButtonActive=!1,this.$emit("colors",e)}},{key:"clearDropdown",value:function(){console.log("boop"),this.isButtonActive=!1}},{key:"handleSelectColumn",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("panel: selected",t),this.isButtonActive=!1,this.$emit("column",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buttonTitle",get:function(){return-1===this.activeColumn?this.$i18n.t("loading"):this.header[this.activeColumn]}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!0})],Sn.prototype,"activeColumn",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Sn.prototype,"header",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Sn.prototype,"scaleWidth",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Sn.prototype,"csvData",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Sn.prototype,"useSlider",void 0),Object(j["a"])([Object(_["b"])({required:!0})],Sn.prototype,"selectedColorRamp",void 0),Object(j["a"])([Object(_["d"])("scaleWidthValue")],Sn.prototype,"handleScaleChanged",null),Object(j["a"])([Object(_["d"])("globalState.colorScheme")],Sn.prototype,"swapTheme",null),Sn=Object(j["a"])([Object(_["a"])({components:{TimeSlider:bn}})],Sn);var Cn=Sn,wn=Cn,On=(i("64d0"),i("c450")),xn=Object(L["a"])(wn,gn,yn,!1,null,"2c41fca2",null);"function"===typeof On["default"]&&Object(On["default"])(xn);var jn,_n=xn.exports,Tn=i("6b0f"),Rn=i("548a"),Dn="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA";(function(e){e[e["offset"]=0]="offset",e[e["coordFrom"]=1]="coordFrom",e[e["coordTo"]=2]="coordTo"})(jn||(jn={}));Object(Tn["a"])().domain([0,.1,.2,.3,.4,.5,.6,.7,.8,.9]).range([[26,152,80],[102,189,99],[166,217,106],[217,239,139],[255,255,191],[254,224,139],[253,174,97],[244,109,67],[215,48,39],[168,0,0]]),Object(Rn["a"])().clamp(!0).domain([0,200]).range([10,2e3]);var En={latitude:38,longitude:-100,zoom:10};function An(e){var t=e.geojson,i=void 0===t?[]:t,a=e.center,n=void 0===a?[]:a,s=e.colors,r=void 0===s?"viridis":s,o=e.dark,l=void 0!==o&&o,c=e.scaleWidth,u=void 0===c?250:c,h=e.build,p=void 0===h?{}:h,m=(e.base,e.buildData),f=void 0===m?new Float32Array:m,v=e.baseData,b=void 0===v?new Float32Array:v,g=e.showDiffs,y=void 0!==g&&g,k=p.header,S=p.headerMax,C=p.activeColumn,w=f,O=Object(Tt["a"])(n,2),x=O[0],j=O[1],_=Object.assign(En,{longitude:x,latitude:j}),T=Object(Ye["useState"])({}),R=Object(Tt["a"])(T,2),D=R[0],E=R[1],A=Fe()({colormap:r,nshades:20,format:"rba"}).map((function(e){return[e[0],e[1],e[2],255]})),F=Object(Tn["a"])().domain(new Array(20).fill(0).map((function(e,t){return.05*t}))).range(A).range(l?A:A.reverse()),L=l?[80,80,80,40]:[212,212,212,40],M=[0,0,0,0],P=F(0),z=F(1),N=function(e){var t=w[e[jn.offset]];if(!t)return M;if(y){var i=b[e[jn.offset]],a=t-i;return 0===a?0:i<t?z:P}var n=Math.log(t)/Math.log(S[C]);return n<1e-4?L:F(n)},I=function(e){var t=w[e[jn.offset]];if(y){var i=b[e[jn.offset]],a=Math.abs(t-i);return a/u}return t/u};function B(){console.log("click!")}function V(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(!i)return null;var s=w[i[jn.offset]],r=0,o=void 0;if(y)r=b[i[jn.offset]],o=s-r;else if(void 0===s)return null;var c=r?Ke.a.createElement("p",null,"+/- Base: ",o):null;return Ke.a.createElement("div",{className:"tooltip",style:{backgroundColor:l?"#445":"white",color:l?"white":"#222",padding:"1rem 1rem",position:"absolute",left:a+4,top:n-80,boxShadow:"0px 2px 10px #22222266"}},Ke.a.createElement("big",null,Ke.a.createElement("b",null,k[C])),Ke.a.createElement("p",null,s),c)}var $=[new qi["a"]({id:"linkLayer",data:i,widthUnits:"pixels",widthMinPixels:0,widthMaxPixels:200,pickable:!0,opacity:.8,autoHighlight:!0,parameters:{depthTest:!1},getSourcePosition:function(e){return e[jn.coordFrom]},getTargetPosition:function(e){return e[jn.coordTo]},getColor:N,getWidth:I,onHover:E,updateTriggers:{getColor:{showDiffs:y,dark:l,colors:r,activeColumn:C},getWidth:{showDiffs:y,scaleWidth:u,activeColumn:C}},transitions:{getColor:350,getWidth:350}})];return Ke.a.createElement(Ft["a"],{layers:$,initialViewState:_,controller:!0,pickingRadius:5,getCursor:function(){return"pointer"},onClick:B},Ke.a.createElement(Rt["b"],{reuseMaps:!0,mapStyle:l?d.dark:d.light,preventStyleDiffing:!0,mapboxApiAccessToken:Dn}),V({hoverInfo:D}))}_["c"].use(Qt["VuePlugin"]);var Fn=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.buildColumnValues=[],e.baseColumnValues=[],e.center=[13.45,52.53],e.isButtonActiveColumn=!1,e.scaleWidth=250,e.showDiffs=!1,e.showTimeRange=!1,e.geojsonData=[],e.selectedColorRamp="viridis",e.vizDetails={title:"",description:"",csvFile:"",csvBase:"",useSlider:!1,shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,thumbnail:"",sum:!1},e.myState={statusMessage:"",fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.csvData={header:[],headerMax:[],rows:new Float32Array,activeColumn:-1},e.csvBase={header:[],headerMax:[],rows:new Float32Array,activeColumn:-1},e.buildData=new Float32Array,e.baseData=new Float32Array,e.linkOffsetLookup={},e.numLinks=0,e.globalState=v.state,e.isDarkMode=e.globalState.colorScheme===n.DarkMode,e.isLoaded=!1,e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.csvFilesToLoad=[],e}return Object(w["a"])(i,[{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.fileSystem)return[];var e,t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i);try{for(n.s();!(e=n.n()).done;){var s=e.value;s&&(a+=s,t.push({label:s,url:"/"+this.myState.fileSystem.url+a}))}}catch(r){n.e(r)}finally{n.f()}return t.push({label:this.vizDetails.title,url:"#"}),v.commit("setBreadCrumbs",t),t}},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 11:i=this.vizDetails.title?this.vizDetails.title:"Network Links",this.$emit("title",i);case 13:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Re.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===n.DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"clickedColorRamp",value:function(e){this.selectedColorRamp=e,console.log(this.selectedColorRamp)}},{key:"handleScaleWidthChanged",value:function(e){console.log(e),this.scaleWidth=e}},{key:"handleNewDataColumn",value:function(e){console.log("handling it:",e);var t=this.csvData.header.indexOf(e);if(-1!==t){if(console.log("got it"),!this.csvData.headerMax[t]){var i=0;this.buildColumnValues[t].forEach((function(e){return i=Math.max(i,e)})),i&&(this.csvData.headerMax[t]=i)}console.log("setting it"),this.buildData=this.buildColumnValues[t],this.baseData=this.baseColumnValues[t],this.csvData.activeColumn=t,this.isButtonActiveColumn=!1,console.log("dit it")}}},{key:"findCenter",value:function(e){return[13.45,52.53]}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.generateBreadcrumbs(),this.myState.statusMessage="Dateien laden...",e.next=10,this.loadGeojsonFeatures();case 10:if(t=e.sent,t){e.next=13;break}return e.abrupt("return");case 13:console.log("5: ok"),this.geojsonData=t,this.isLoaded=!0,this.center=this.findCenter([]),this.buildThumbnail(),this.myState.statusMessage="",console.log("999: ok"),this.loadCSVFiles();case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadGeojsonFeatures",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,n,s,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.linkOffsetLookup={},this.numLinks=0,console.log("1: load network"),this.myState.statusMessage="Loading network...",t="/".concat(this.myState.subfolder,"/").concat(this.vizDetails.geojsonFile),e.next=8,this.myState.fileApi.getFileText(t);case 8:for(i=e.sent,console.log("2: json network"),n=JSON.parse(i),console.log({json:n}),console.log("3: build index"),this.numLinks=n.features.length,s=[],r=0;r<this.numLinks;r++)o=n.features[r],l=[r,o.geometry.coordinates[0],o.geometry.coordinates[1]],s.push(l),this.linkOffsetLookup[o.properties.id]=r;return console.log("4: done!"),console.log({linkElements:s}),e.abrupt("return",s);case 21:return e.prev=21,e.t0=e["catch"](0),this.myState.statusMessage=""+e.t0,this.$store.commit("setStatus",{type:a.WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(this.vizDetails.geojsonFile)}),e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){v.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"handleClickColumnSelector",value:function(){console.log("click!"),this.isButtonActiveColumn=!this.isButtonActiveColumn}},{key:"loadCSVFiles",value:function(){this.myState.statusMessage="Loading CSV data...",this.csvFilesToLoad=[this.vizDetails.csvFile],this.vizDetails.csvBase&&this.csvFilesToLoad.push(this.vizDetails.csvBase),this.loadCSVFile(this.csvFilesToLoad[0])}},{key:"finishedLoadingCSV",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o,l,c,u,h,d,p,m,f=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i=this.csvFilesToLoad.shift(),console.log("FINISHED PARSING: ",i),this.myState.statusMessage="Analyzing...",a=[],n=t.data[0].length-(this.vizDetails.useSlider?0:1),console.log("number of columns",n),s=0;s<n;s++)a.push(new Float32Array(this.numLinks));r=0,o=Object(b["a"])(t.data.splice(1)),e.prev=9,c=function(){var e=l.value,t=f.linkOffsetLookup[e[0].toString()];if(void 0===t)return"continue";if(f.vizDetails.useSlider){var i=e.slice(1),n=i.reduce((function(e,t){return e+t}),0);r=Math.max(r,n),a[0][t]=n,i.forEach((function(e,i){a[i+1][t]=e}))}else{var s=e.slice(1);s.forEach((function(e,i){a[i][t]=e}))}},o.s();case 12:if((l=o.n()).done){e.next=18;break}if(u=c(),"continue"!==u){e.next=16;break}return e.abrupt("continue",16);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](9),o.e(e.t0);case 23:return e.prev=23,o.f(),e.finish(23);case 26:h=t.data[0],d=h.slice(1),this.vizDetails.useSlider&&d.unshift("".concat(this.$t("all"))),p=d.map((function(e){return e.replace(":00:00","")})),m={header:p,headerMax:this.vizDetails.useSlider?new Array(this.csvData.header.length).fill(r):[],rows:new Float32Array,activeColumn:-1},this.csvFilesToLoad.length?(this.buildColumnValues=a,this.csvData=m,this.handleNewDataColumn(this.csvData.header[0])):this.vizDetails.csvBase?(this.baseColumnValues=a,this.csvBase=m):(this.buildColumnValues=a,this.csvData=m,this.handleNewDataColumn(this.csvData.header[0])),this.csvFilesToLoad.length?(this.myState.statusMessage="Loading CSV Baseline...",this.loadCSVFile(this.csvFilesToLoad[0])):(this.myState.statusMessage="",this.handleNewDataColumn(this.csvData.header[0]));case 33:case"end":return e.stop()}}),e,this,[[9,20,23,26]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadCSVFile",value:function(e){console.log("7a: loading CSV:",e);var t=this.myState.fileApi.cleanURL("".concat(this.myState.subfolder,"/").concat(e));try{ke.a.parse(t,{download:!0,header:!1,skipEmptyLines:!0,dynamicTyping:!0,worker:!0,complete:this.finishedLoadingCSV})}catch(i){return console.error(i),this.$store.commit("setStatus",{type:a.WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(e)}),{allColumns:[],header:[],headerMax:[]}}}},{key:"changedTimeSlider",value:function(e){console.log("new slider!",e),e.length&&1===e.length&&(e=e[0]),this.handleNewDataColumn(e)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"buttonTitle",get:function(){return-1===this.csvData.activeColumn?"Loading...":this.csvData.header[this.csvData.activeColumn]}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],Fn.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Fn.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Fn.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Fn.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],Fn.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("globalState.colorScheme")],Fn.prototype,"swapTheme",null),Fn=Object(j["a"])([Object(_["a"])({components:{CollapsiblePanel:Xe,ConfigPanel:_n,LinkGlLayer:An,TimeSlider:bn,ToggleButton:_e["ToggleButton"]}})],Fn),v.commit("registerPlugin",{kebabName:"links-gl",prettyName:"Links",description:"Network link attributes",filePatterns:["viz-gl-link*.y?(a)ml"],component:Fn});var Ln=Fn,Mn=Ln,Pn=(i("d8a1"),i("8c14")),zn=Object(L["a"])(Mn,cn,un,!1,null,"17876b3c",null);"function"===typeof Pn["default"]&&Object(Pn["default"])(zn);var Nn=zn.exports,In=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"link-container",style:{background:e.urlThumbnail}},[e.thumbnail?e._e():i("div",{staticClass:"map-container"},[i("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.myState.loadingText?e._e():i("left-data-panel",{staticClass:"left-panel"},[i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{"text-align":"center",padding:"0.5rem 1rem","font-weight":"normal",color:"white"}},[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?i("div",{staticClass:"info-description",staticStyle:{padding:"0px 0.5rem"}},[i("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),i("div",{staticClass:"widgets"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.headers.length>2,expression:"headers.length > 2"}],staticClass:"uhrzeit"},[i("h4",{staticClass:"heading"},[e._v("Uhrzeit")]),e.headers.length>0?i("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var i=e.showTimeRange,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showTimeRange=i.concat([s])):r>-1&&(e.showTimeRange=i.slice(0,r).concat(i.slice(r+1)))}else e.showTimeRange=n}}}),e._v(" Zeitraum")])],1),i("h4",{staticClass:"heading"},[e._v("Linienbreiten")]),e.headers.length>0?i("scale-slider",{staticClass:"time-slider",attrs:{stops:e.SCALE_STOPS},on:{change:e.bounceScale}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showAllRoads,expression:"showAllRoads"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showAllRoads)?e._i(e.showAllRoads,null)>-1:e.showAllRoads},on:{change:function(t){var i=e.showAllRoads,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showAllRoads=i.concat([s])):r>-1&&(e.showAllRoads=i.slice(0,r).concat(i.slice(r+1)))}else e.showAllRoads=n}}}),e._v(" Gesamtes Straßennetz anzeigen")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.loadingText,expression:"myState.loadingText"}],staticClass:"status-blob"},[i("h4",[e._v(e._s(e.myState.loadingText))])])],1)},Bn=[],Vn=(i("498a"),i("c26a")),$n=i("e192"),Hn=i.n($n),qn=i("323e"),Un=i.n(qn),Wn=i("595b"),Gn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"datapanel"}},[i("div",{staticClass:"content-area",class:{"is-hidden":e.isHidden,bye:e.isLeaving}},[e.title?i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{padding:"0.5rem 3rem","font-size":"1rem","font-weight":"normal",color:"white"}},[e._v(e._s(e.title))])]):e._e(),i("div",{staticClass:"top-area"},[e._t("default")],2)]),i("div",{staticClass:"restore-button",class:{"add-margin":!e.isHidden}},[i("button",{staticClass:"button is-small hide-button",on:{click:e.toggleHidePanel}},[e.isHidden?e._e():i("i",{staticClass:"fa fa-arrow-left"}),e.isHidden?i("i",{staticClass:"fa fa-arrow-right"}):e._e()])])])},Xn=[],Yn=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.isHidden=!1,e.isLeaving=!1,e}return Object(w["a"])(i,[{key:"toggleHidePanel",value:function(){var e=this;this.isHidden?this.isHidden=!this.isHidden:(this.isLeaving=!0,setTimeout((function(){e.isHidden=!0,e.isLeaving=!1}),300))}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({type:String})],Yn.prototype,"title",void 0),Yn=Object(j["a"])([_["a"]],Yn);var Kn=Yn,Jn=Kn,Zn=(i("90da"),Object(L["a"])(Jn,Gn,Xn,!1,null,"82194458",null)),Qn=Zn.exports,es=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},ts=[],is=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=1,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(w["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.scaleSlider.data=this.stops}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!0})],is.prototype,"stops",void 0),Object(j["a"])([Object(_["d"])("sliderValue")],is.prototype,"sliderChangedEvent",null),is=Object(j["a"])([Object(_["a"])({components:{"vue-slider":je.a}})],is);var as=is,ns=as,ss=(i("acace"),Object(L["a"])(ns,es,ts,!1,null,"2fde1874",null)),rs=ss.exports,os=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},ls=[],cs=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(w["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=et(e),i=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(i)}catch(a){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=et(e),i=("00"+t.minutes).slice(-2),a=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(i,":").concat(a)}},{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])()],cs.prototype,"initialTime",void 0),Object(j["a"])([Object(_["b"])()],cs.prototype,"useRange",void 0),Object(j["a"])([Object(_["b"])()],cs.prototype,"stops",void 0),Object(j["a"])([Object(_["d"])("initialTime")],cs.prototype,"initialTimeChanged",null),Object(j["a"])([Object(_["d"])("useRange")],cs.prototype,"changeUseRange",null),Object(j["a"])([Object(_["d"])("stops")],cs.prototype,"setStops",null),Object(j["a"])([Object(_["d"])("sliderValue")],cs.prototype,"sliderChangedEvent",null),cs=Object(j["a"])([Object(_["a"])({components:{"vue-slider":je.a}})],cs);var us=cs,hs=us,ds=(i("83c7"),Object(L["a"])(hs,os,ls,!1,null,"e2ace8c0",null)),ps=ds.exports,ms=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.SCALE_STOPS=[.01,.1,.2,.5,1,2,5,10,100],e.WIDTH_SCALE=.005,e.globalState=v.state,e.showAllRoads=!1,e.mapExtentXYXY=[180,90,-180,-90],e.mapId="m".concat(Math.floor(Math.random()*Math.floor(1e10))),e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,loadingText:"Dateien laden...",visualization:null,project:{}},e.vizDetails={csvFile:"",csvFile2:"",shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,title:"",description:"",thumbnail:"",sum:!1},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.sampleRate=1,e.geojson={},e.headers=[],e.showTimeRange=!1,e.bounceTimeSlider=Object(kn["debounce"])(e.changedTimeSlider,200),e.bounceScale=Object(kn["debounce"])(e.changedScale,200),e.currentTimeBin=e.TOTAL_MSG,e.currentScale=e.SCALE_STOPS[0],e.sumElements=[],e.dataset={},e.idLookup={},e.dailyGrandTotal=0,e.dailyTotals=[],e.idColumn="",e.hoveredStateId=null,e.currentChart={},e}return Object(w["a"])(i,[{key:"toggleShowAllRoads",value:function(){this.changedTimeSlider(this.currentTimeBin)}},{key:"toggleShowTimeRange",value:function(){!this.showTimeRange&&this.headers.length&&(this.currentTimeBin=this.headers[0]),this.changedTimeSlider(this.currentTimeBin)}},{key:"destroyed",value:function(){v.commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=7;break}return this.myState.loadingText="",e.abrupt("return");case 7:this.generateBreadcrumbs(),this.setupMap();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this.mapExtentXYXY[0]=Math.min(this.mapExtentXYXY[0],e[0]),this.mapExtentXYXY[1]=Math.min(this.mapExtentXYXY[1],e[1]),this.mapExtentXYXY[2]=Math.max(this.mapExtentXYXY[2],e[0]),this.mapExtentXYXY[3]=Math.max(this.mapExtentXYXY[3],e[1])}},{key:"setMapExtent",value:function(){this.mapExtentXYXY=Object(Wn["bbox"])(this.geojson),localStorage.setItem(this.myState.subfolder+"-bounds",JSON.stringify(this.mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:10,bottom:10,right:10,left:250},animate:!1};this.map.fitBounds(this.mapExtentXYXY,e)}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"setupMap",value:function(){try{this.map=new Hn.a.Map({bearing:0,container:this.mapId,logoPosition:"bottom-right",style:"mapbox://styles/mapbox/streets-v11",pitch:0}),this.findCenter(),this.map.on("style.load",this.mapIsReady),this.map.addControl(new Hn.a.NavigationControl,"top-right")}catch(e){console.log(e)}}},{key:"findCenter",value:function(){try{var e=localStorage.getItem(this.myState.subfolder+"-bounds");if(e){var t=JSON.parse(e),i={top:5,bottom:5,right:5,left:30};this.thumbnail?this.map.fitBounds(t,{animate:!1}):this.map.fitBounds(t,{padding:i,animate:!1})}}catch(a){}}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 10:this.$emit("title",this.vizDetails.title),this.vizDetails.shpFileIdProperty||(this.vizDetails.shpFileIdProperty="Id"),this.sampleRate=this.vizDetails.sampleRate?this.vizDetails.sampleRate:1,this.buildThumbnail(),Un.a.done();case 15:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Re.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"loadFiles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.myState.loadingText="Dateien laden...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile);case 4:if(t=e.sent,i="",!this.vizDetails.csvFile2){e.next=10;break}return e.next=9,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile2);case 9:i=e.sent;case 10:if(a=null,n=null,s=null,!this.vizDetails.geojsonFile){e.next=28;break}return console.log("reading",this.vizDetails.geojsonFile),e.next=17,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.geojsonFile);case 17:if(r=e.sent,!r){e.next=24;break}return e.next=21,Object(Ne["a"])(r);case 21:e.t0=e.sent,e.next=25;break;case 24:e.t0=null;case 25:s=e.t0,e.next=41;break;case 28:return console.log("reading",this.vizDetails.shpFile),e.next=31,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.shpFile);case 31:return o=e.sent,e.next=34,Re.a.arraybuffer(o);case 34:return a=e.sent,e.next=37,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.dbfFile);case 37:return l=e.sent,e.next=40,Re.a.arraybuffer(l);case 40:n=e.sent;case 41:return e.abrupt("return",{shpFile:a,dbfFile:n,linkFlows:i||t,linkBaseFlows:i?t:i,geojsonFile:s});case 44:return e.prev=44,e.t1=e["catch"](0),console.error({e:e.t1}),this.myState.loadingText=""+e.t1,e.abrupt("return",null);case 49:case"end":return e.stop()}}),e,this,[[0,44]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedTimeSlider",value:function(e){e.length&&1===e.length&&(e=e[0]),this.currentTimeBin=e;var t=this.WIDTH_SCALE*this.currentScale;if(0==this.showTimeRange){this.map.setPaintProperty("my-layer","line-width",["*",t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#ff0",["==",["get",e],null],"#8ca",["<",["get",e],0],"#5f5",this.vizDetails.csvFile2?"#900":"#55b"]);var i=this.showAllRoads?null:["!=",["get",this.currentTimeBin],null];this.map.setFilter("my-layer",i)}else{var a,n=["+"],s=!1,r=Object(b["a"])(this.headers);try{for(r.s();!(a=r.n()).done;){var o=a.value;o===e[0]&&(s=!0),o!==this.TOTAL_MSG&&(s&&n.push(["get",o]),o===e[1]&&(s=!1))}}catch(l){r.e(l)}finally{r.f()}this.map.setPaintProperty("my-layer","line-width",["*",t,n]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,n]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#0f6",["==",n,null],"#8ca",["<",n,0],"#fc0","#559"])}}},{key:"processHeaders",value:function(e){var t=e.split("\n"),i=t[0].indexOf(";")>0?";":",",a=t[0].split(i).map((function(e){return e.trim()}));this.headers=[this.TOTAL_MSG].concat(a.slice(1))}},{key:"processGeojsonFile",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,Ie["run"](ze.a.inflateAsync(t.geojsonFile,{to:"string"}));case 3:return i=e.sent,a=JSON.parse(i),n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",s=0,e.next=9,Ie["forEachAsync"](a.features,(function(e){e.properties&&(e.id=s++,r.idLookup[e.properties[n]]=e.id)}));case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"processShapefile",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,Vn["a"](t.shpFile,t.dbfFile);case 3:return i=e.sent,this.myState.loadingText="Converting coordinates...",a=0,n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",s=0,e.next=10,Ie["forEachAsync"](i.features,(function(e){e.properties&&(e.id=s++,r.idLookup[e.properties[n]]=e.id);try{"MultiPolygon"===e.geometry.type?r.convertMultiPolygonCoordinatesToWGS84(e):"LineString"===e.geometry.type?r.convertLineStringCoordinatesToWGS84(e):r.convertPolygonCoordinatesToWGS84(e)}catch(t){a++,a<5&&(console.error("ERR with feature: "+e),console.error(t))}}));case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertLineStringCoordinatesToWGS84",value:function(e){var t,i=[],a=e.geometry.coordinates,n=Object(b["a"])(a);try{for(n.s();!(t=n.n()).done;){var s=t.value,r=ya.toLngLat(this.vizDetails.projection,s);i.push(r),this.updateMapExtent(r)}}catch(o){n.e(o)}finally{n.f()}a.length=0,a.push.apply(a,i)}},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(b["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,s=[],r=Object(b["a"])(n);try{for(r.s();!(a=r.n()).done;){var o=a.value,l=ya.toLngLat(this.vizDetails.projection,o);s.push(l)}}catch(c){r.e(c)}finally{r.f()}n.length=0,n.push.apply(n,s)}}catch(c){i.e(c)}finally{i.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(b["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,s=n[0],r=[],o=Object(b["a"])(s);try{for(o.s();!(a=o.n()).done;){var l=a.value,c=Object(ba["default"])(this.vizDetails.projection,"WGS84",l);r.push(c)}}catch(u){o.e(u)}finally{o.f()}n[0]=r}}catch(u){i.e(u)}finally{i.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,i=[],a=Object(b["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;Array.isArray(n[0])?i.push(this.recurseWGS84(n)):i.push(Object(ba["default"])(this.vizDetails.projection,"WGS84",n))}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"mapIsReady",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,t){e.next=6;break}return this.myState.loadingText="Fehler mit Dateien, sorry",e.abrupt("return");case 6:if(!this.vizDetails.geojsonFile){e.next=12;break}return e.next=9,this.processGeojsonFile(t);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,this.processShapefile(t);case 14:e.t0=e.sent;case 15:return this.geojson=e.t0,this.setMapExtent(),e.next=19,this.processCSVFiles(t);case 19:return this.processHeaders(t.linkFlows),e.next=22,this.calculateLinkProperties(this.geojson);case 22:return this.addJsonToMap(this.geojson),this.changedScale(1),this.setupMapListeners(),this.myState.loadingText="",e.next=28,this.$nextTick();case 28:Un.a.done();case 29:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processCSVFiles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.dataset={},i=",";try{a=t.linkFlows.substring(0,t.linkFlows.indexOf("\n")),a.indexOf(",")>-1?i=",":a.indexOf(";")>-1?i=";":a.indexOf("\t")>-1?i="\t":a.indexOf(" ")>-1&&(i=" ")}catch(o){i=","}return n=ke.a.parse(t.linkFlows,{header:!0,dynamicTyping:!0,delimiter:i}),s=n.meta.fields[0],this.idColumn=s,e.next=8,Ie["forEachAsync"](n.data,(function(e){var t=e[s],i=r.idLookup[t];r.dataset[i]=e}));case 8:if(!t.linkBaseFlows){e.next=11;break}return e.next=11,this.subtractBaseFlows(t.linkBaseFlows,i);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subtractBaseFlows",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t,i){var a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText=this.vizDetails.sum?"Summen berechnen...":"Differenzen berechnen...",a=ke.a.parse(t,{header:!0,dynamicTyping:!0,delimiter:i}),n=a.meta.fields[0],s=0,e.next=6,Ie["forEachAsync"](a.data,(function(e){var t=e[n],i=r.idLookup[t];if(r.dataset[i]){var a=r.dataset[i];if(r.vizDetails.sum)for(var o=0,l=Object.keys(e);o<l.length;o++){var c=l[o];a[c]=a[c]+e[c]}else for(var u=0,h=Object.keys(e);u<h.length;u++){var d=h[u];a[d]=a[d]-e[d]}r.dataset[i]=a,s++}else{if(!r.vizDetails.sum)for(var p=0,m=Object.keys(e);p<m.length;p++){var f=m[p];isNaN(e[f])||(e[f]=-1*e[f])}r.dataset[i]=e}}));case 6:console.log(s,"total DIFFs happened");case 7:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"calculateLinkProperties",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Berechnen...",e.next=3,Ie["forEachAsync"](t.features,(function(e){var t=e.id,a=i.dataset[t];if(a){for(var n=0,s=0,r=Object.keys(a);s<r.length;s++){var o=r[s];if(o!==i.idColumn&&!isNaN(a[o])){var l=a[o]/i.sampleRate;e.properties[o]=l,n+=l,i.dailyTotals[o]||(i.dailyTotals[o]=0),i.dailyTotals[o]+=l}}e.properties[i.TOTAL_MSG]=n}}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addJsonToMap",value:function(e){this.map&&(this.map.addSource("my-data",{data:e,type:"geojson"}),this.map.addLayer({id:"my-layer",source:"my-data",type:"line",paint:{"line-opacity":1,"line-width":["get","width"],"line-offset":["+",.25,["*",.5,["get","width"]]],"line-color":["case",["boolean",["feature-state","hover"],!1],"#fb0","#559"]},layout:{"line-cap":"round"}}))}},{key:"setupMapListeners",value:function(){var e=this;if(this.map){var t="my-layer",i=this;this.map.on("click",t,(function(t){e.clickedOnElement(t)})),this.map.on("mousemove",t,(function(t){e.map&&(e.map.getCanvas().style.cursor=t?"pointer":"auto")})),this.map.on("mouseleave",t,(function(){e.map&&(e.map.getCanvas().style.cursor="auto")})),this.map.on("mousemove",t,(function(e){var t=i.map.queryRenderedFeatures(e.point);t.length>0&&(i.hoveredStateId&&i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!1}),i.hoveredStateId=t[0].id,i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!0}))})),this.map.on("mouseleave",t,(function(){i.hoveredStateId&&i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!1}),i.hoveredStateId=null}))}}},{key:"clickedOnElement",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:if(i=t.features[0],a=[],n=0,!i.properties){e.next=28;break}s=this.headers,r=Object(b["a"])(s),e.prev=8,r.s();case 10:if((o=r.n()).done){e.next=20;break}if(l=o.value,l!==this.TOTAL_MSG){e.next=14;break}return e.abrupt("continue",18);case 14:c=i.properties[l],c||(c=0),n+=c,a.push({hour:l,trips:c});case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](8),r.e(e.t0);case 25:return e.prev=25,r.f(),e.finish(25);case 28:n||(n=0),u='<p style="text-align: center; min-width: max-content;"><b>Details</b><br/>Insgesamt: '+n+"</p>",n&&(u+='<div id="chart" style="width: 300px; height:250px;"></div>'),this._popup&&this._popup.remove(),this._popup=new Hn.a.Popup({closeOnClick:!0}).setLngLat(t.lngLat).setHTML(u),this._popup.addTo(this.map),console.log({data:a}),n&&(this.currentChart=new Morris.Bar({element:"chart",data:a,stacked:!0,xkey:"hour",ykeys:["trips"],labels:["Trips"],barColors:["#3377cc"],xLabels:"Uhr",xLabelAngle:90,hideHover:!0,parseTime:!1,resize:!0}));case 36:case"end":return e.stop()}}),e,this,[[8,22,25,28]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],ms.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ms.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ms.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],ms.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("showAllRoads")],ms.prototype,"toggleShowAllRoads",null),Object(j["a"])([Object(_["d"])("showTimeRange")],ms.prototype,"toggleShowTimeRange",null),ms=Object(j["a"])([Object(_["a"])({components:{LeftDataPanel:Qn,ScaleSlider:rs,TimeSlider:ps}})],ms),v.commit("registerPlugin",{kebabName:"link-volumes",prettyName:"Volumes",description:"Aggregate volumes on network links",filePatterns:["viz-link*.y?(a)ml"],component:ms});var fs=ms,vs=fs,bs=(i("780e"),Object(L["a"])(vs,In,Bn,!1,null,"ae413ea2",null)),gs=bs.exports,ys=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"gl-viz",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded&&e.shapefile.data.length?i("polygon-layer",{staticClass:"anim",attrs:{center:e.center,shapefile:e.shapefile,activeColumn:this.activeHeader,dark:e.isDarkMode,colors:e.selectedColorRamp,maxValue:e.maxValueForScaling}}):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{darkMode:e.isDarkMode,width:"250",direction:"right"}},[i("div",{staticClass:"panel-items"},[i("div",{staticClass:"panel-item"},[i("h3",[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])]),i("div",{staticClass:"panel-item"},[i("p",[i("b",[e._v(e._s(e.$t("selectColumn")))])]),i("div",{staticClass:"dropdown full-width is-hoverable"},[i("div",{staticClass:"dropdown-trigger"},[i("button",{staticClass:"full-width is-warning button",class:{"is-loading":""===e.activeHeader},attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"}},[i("b",[e._v(e._s(e.buttonTitle))]),i("span",{staticClass:"icon is-small"},[i("i",{staticClass:"fas fa-angle-down",attrs:{"aria-hidden":"true"}})])])]),i("div",{staticClass:"dropdown-menu",style:{"max-height":"16rem","overflow-y":"auto",border:"1px solid #ccc"},attrs:{id:"dropdown-menu-column-selector",role:"menu"}},[i("div",{staticClass:"dropdown-content"},e._l(e.shapefile.header,(function(t){return i("a",{staticClass:"dropdown-item",on:{click:function(i){return e.handleNewDataColumn(t)}}},[e._v(e._s(t))])})),0)])])])])])],1):e._e(),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"nav"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},ks=[],Ss=i("7ca5"),Cs=i.n(Ss),ws=i("7306"),Os="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",xs=Object(Tn["a"])().domain([0,.1,.2,.3,.4,.5,.6,.7,.8,.9]).range([[26,152,80],[102,189,99],[166,217,106],[217,239,139],[255,255,191],[254,224,139],[253,174,97],[244,109,67],[215,48,39],[168,0,0]]),js=(Object(Rn["a"])().clamp(!0).domain([0,200]).range([10,2e3]),{latitude:13.45,longitude:-52.51,zoom:10});function _s(e){var t=e.shapefile,i=void 0===t?{}:t,a=e.center,n=void 0===a?[]:a,s=e.dark,r=void 0!==s&&s,o=e.colors,l=void 0===o?"":o,c=e.activeColumn,u=void 0===c?"":c,h=e.maxValue,p=void 0===h?1e3:h,m=i.data,f=(i.header,i.prj,Object(Tt["a"])(n,2)),v=f[0],b=f[1],g=Object.assign(js,{longitude:v,latitude:b}),y=Object(Ye["useState"])({}),k=Object(Tt["a"])(y,2),S=k[0],C=k[1],w=Fe()({colormap:l,nshades:20,format:"rba"}).map((function(e){return[e.slice(0,3)]}));Object(Tn["a"])().domain(new Array(20).fill(0).map((function(e,t){return.05*t}))).range(w);function O(){console.log("click!")}function x(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(i){var s=24+22*Object.keys(i.properties).length;n+s<window.innerHeight&&(s=0);var o=Ke.a.createElement("div",{id:"shape-tooltip",className:"tooltip",style:{backgroundColor:r?"#445":"white",color:r?"white":"#222",padding:"1rem 1rem",position:"absolute",left:a+15,top:n-s,boxShadow:"0px 2px 10px #22222266"}},Ke.a.createElement("div",null,Object.keys(i.properties).map((function(e,t){return Ke.a.createElement("div",{key:t},Ke.a.createElement("b",null,e,": ")," ",i.properties[e])}))));return o}}var j=[new ws["a"]({id:"shapefileLayer",data:m,filled:!0,lineWidthUnits:"pixels",lineWidthMinPixels:1,pickable:!0,stroked:!0,opacity:.5,autoHighlight:!0,parameters:{depthTest:!0},getLineColor:[255,255,255,128],getFillColor:function(e){return xs(e.properties[u]/p)},getLineWidth:2,onHover:C,updateTriggers:{getFillColor:{dark:r,colors:l,activeColumn:u,maxValue:p}},transitions:{getFillColor:250}})];return Ke.a.createElement(Ft["a"],{layers:j,initialViewState:g,controller:!0,pickingRadius:5,getCursor:function(){return"pointer"},onClick:O},Ke.a.createElement(Rt["b"],{reuseMaps:!0,mapStyle:r?d.dark:d.light,preventStyleDiffing:!0,mapboxApiAccessToken:Os}),x({hoverInfo:S}))}_["c"].use(Qt["VuePlugin"]);var Ts=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.shapefile={data:[],prj:"",header:[],bbox:{minX:0,minY:0,maxX:0,maxY:0}},e.activeHeader="",e.isButtonActiveColumn=!1,e.center=[13.45,52.53],e.maxValueForScaling=1e3,e.selectedColorRamp="viridis",e.colorRamps={viridis:{png:"scale-viridis.png"},inferno:{png:"scale-inferno.png"},bluered:{png:"scale-salinity.png",diff:!0},picnic:{png:"scale-picnic.png"}},e.vizDetails={title:"",description:"",csvFile:"",csvBase:"",useSlider:!1,shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,thumbnail:"",sum:!1},e.myState={statusMessage:"",fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.globalState=v.state,e.isDarkMode=e.globalState.colorScheme===n.DarkMode,e.isLoaded=!1,e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.columnMax={},e}return Object(w["a"])(i,[{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.fileSystem)return[];var e,t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i);try{for(n.s();!(e=n.n()).done;){var s=e.value;s&&(a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a}))}}catch(r){n.e(r)}finally{n.f()}return t.push({label:this.vizDetails.title,url:"#"}),v.commit("setBreadCrumbs",t),t}},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$emit("title","Shapefile: ".concat(this.myState.yamlConfig.slice(0,this.myState.yamlConfig.length-4)));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Re.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===n.DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"clickedColorRamp",value:function(e){this.selectedColorRamp=e,console.log(this.selectedColorRamp)}},{key:"handleNewDataColumn",value:function(e){if(!this.columnMax[e]){var t=0;Object.values(this.shapefile.data).forEach((function(i){t=Math.max(t,i.properties[e])})),t&&(this.columnMax[e]=t||1)}this.activeHeader=e,this.maxValueForScaling=this.columnMax[e],this.isButtonActiveColumn=!1}},{key:"findCenter",value:function(e){return[13.45,52.53]}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.myState.statusMessage="Dateien laden...",this.loadShapefile(),this.center=this.findCenter([]),this.isLoaded=!0,this.buildThumbnail(),this.myState.statusMessage="";case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){v.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"loadShapefile",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u,h,d,p,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("loading shapefile"),t="".concat(this.myState.subfolder,"/").concat(this.myState.yamlConfig),console.log(t),i={},e.prev=4,s=this.myState.fileApi.getFileBlob(t),r=this.myState.fileApi.getFileBlob(t.replace(".shp",".dbf")),e.next=9,Promise.all([s,r]);case 9:return e.next=11,s;case 11:if(e.t1=a=e.sent,e.t0=null===e.t1,e.t0){e.next=15;break}e.t0=void 0===a;case 15:if(!e.t0){e.next=19;break}e.t2=void 0,e.next=20;break;case 19:e.t2=a.arrayBuffer();case 20:return e.next=22,e.t2;case 22:return o=e.sent,e.next=25,r;case 25:if(e.t4=n=e.sent,e.t3=null===e.t4,e.t3){e.next=29;break}e.t3=void 0===n;case 29:if(!e.t3){e.next=33;break}e.t5=void 0,e.next=34;break;case 33:e.t5=n.arrayBuffer();case 34:return e.next=36,e.t5;case 36:if(l=e.sent,o&&l){e.next=39;break}return e.abrupt("return");case 39:return e.next=41,Vn["a"](o,l);case 41:i=e.sent,e.next=49;break;case 44:return e.prev=44,e.t6=e["catch"](4),console.error(e.t6),this.myState.statusMessage=""+e.t6,e.abrupt("return");case 49:return c="",e.prev=50,e.next=53,this.myState.fileApi.getFileText(t.replace(".shp",".prj"));case 53:c=e.sent,e.next=58;break;case 56:e.prev=56,e.t7=e["catch"](50);case 58:c&&(i=Cs.a.toWgs84(i,c)),console.log({geojson:i}),u=i.bbox,h=ya.toLngLat(c,{x:u[0],y:u[1]}),d=ya.toLngLat(c,{x:u[2],y:u[3]}),p={minX:h.x,minY:h.y,maxX:d.x,maxY:d.y},m=Object.keys(i.features[0].properties),this.shapefile={data:i.features,prj:c,header:m,bbox:p},this.handleNewDataColumn(this.shapefile.header[0]);case 67:case"end":return e.stop()}}),e,this,[[4,44],[50,56]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"buttonTitle",get:function(){return this.activeHeader?this.activeHeader:this.$t("loading")}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],Ts.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ts.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ts.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ts.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],Ts.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("globalState.colorScheme")],Ts.prototype,"swapTheme",null),Ts=Object(j["a"])([Object(_["a"])({components:{CollapsiblePanel:Xe,PolygonLayer:_s,TimeSlider:bn,ToggleButton:_e["ToggleButton"]}})],Ts),v.commit("registerPlugin",{kebabName:"shape-file",prettyName:"Shapefile",description:"Shapefile Viewer",filePatterns:["*.shp"],component:Ts});var Rs=Ts,Ds=Rs,Es=(i("7b21"),i("a2d2")),As=Object(L["a"])(Ds,ys,ks,!1,null,"16623146",null);"function"===typeof Es["default"]&&Object(Es["default"])(As);var Fs=As.exports,Ls=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{staticClass:"sankey-container",class:{"show-thumbnail":e.myState.thumbnail,"show-flipper":e.flipperID}},[i("div",{staticClass:"main-area"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.myState.thumbnail,expression:"!(myState.thumbnail)"}],staticClass:"labels"},[i("h3",{staticClass:"center"},[e._v(e._s(e.vizDetails.title))]),i("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))]),i("p",{staticClass:"center"},[e._v(e._s(e.totalTrips.toLocaleString())+" total trips")])]),i("svg",{attrs:{id:e.cleanConfigId}})])]):e._e()},Ms=[],Ps=(i("caad"),i("ed18")),zs=i("00a5"),Ns=i("df19"),Is=i("a968"),Bs=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csv:"",title:"",description:""},e.loadingText="Flow Diagram",e.jsonChart={},e.totalTrips=0,e}return Object(w["a"])(i,[{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.yamlConfig||this.buildRouteFromUrl(),e.next=3,this.getVizDetails();case 3:this.thumbnail||this.generateBreadcrumbs();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,t){e.next=5;break}return e.abrupt("return");case 5:this.jsonChart=this.processInputs(t),this.loadingText="",this.doD3(),Un.a.done();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Loading files...",e.prev=1,e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 4:return t=e.sent,this.vizDetails=Ce.a.parse(t),this.$emit("title",this.vizDetails.title),i=this.myState.subfolder+"/"+this.vizDetails.csv,e.next=10,this.myState.fileApi.getFileText(i);case 10:return n=e.sent,e.abrupt("return",n);case 14:e.prev=14,e.t0=e["catch"](1),console.error({e:e.t0}),this.loadingText=""+e.t0,this.$store.commit("setStatus",{type:a.WARNING,msg:"In: ".concat(this.myState.subfolder+"/"+this.myState.yamlConfig,":<br/>")+"Could not find: ".concat(this.vizDetails.csv)}),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 20:return e.abrupt("return","");case 21:case"end":return e.stop()}}),e,this,[[1,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(e){this.loadingText="Building node graph...";var t=[],i=[],a=[];this.totalTrips=0;var n,s=ke.a.parse(e,{header:!1,skipEmptyLines:!0,dynamicTyping:!0}),r=Object(b["a"])(s.data.slice(1));try{for(r.s();!(n=r.n()).done;){var o=n.value;if(!(o.length<2)){t.includes(o[0])||t.push(o[0]),i.includes(o[1])||i.push(o[1]);var l=parseFloat(o[2]);l>0&&(a.push([o[0],o[1],l]),this.totalTrips+=l)}}}catch(f){r.e(f)}finally{r.f()}var c={nodes:[],links:[]},u={},h={};t.forEach((function(e,t){c.nodes.push({id:t,title:e}),u[e]=t})),i.forEach((function(e,i){c.nodes.push({id:i+t.length,title:e}),h[e]=i+t.length}));for(var d=0,p=a;d<p.length;d++){var m=p[d];c.links.push({source:u[m[0]],target:h[m[1]],value:m[2]})}return c}},{key:"doD3",value:function(){var e=this.jsonChart,t=Object(Ps["sankey"])().extent([[150,0],[650,800]]).nodeWidth(5),i=Object(Ns["a"])(Is["a"]),a=Object(Ps["sankeyDiagram"])().linkColor((function(e){var t=i(e.source.id);return t+"bb"}));Object(zs["a"])("#"+this.cleanConfigId).datum(t(e)).call(a).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 800 800").style("font-size",this.thumbnail?"34px":"24px").style("font-weight","bold").style("text-color","#aaa")}},{key:"cleanConfigId",get:function(){if(this.flipperID)return this.flipperID;var e=this.myState.yamlConfig.replace(/[\W_]+/g,"");return e}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],Bs.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Bs.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Bs.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Bs.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Bs.prototype,"flipperID",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],Bs.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("yamlConfig")],Bs.prototype,"changedYaml",null),Object(j["a"])([Object(_["d"])("subfolder")],Bs.prototype,"changedSubfolder",null),Bs=Object(j["a"])([Object(_["a"])({components:{}})],Bs),v.commit("registerPlugin",{kebabName:"sankey-diagram",prettyName:"Flow Diagram",description:"Depicts flows between choices",filePatterns:["sankey*.y?(a)ml"],component:Bs});var Vs=Bs,$s=Vs,Hs=(i("85b4"),Object(L["a"])($s,Ls,Ms,!1,null,"6f8f58aa",null)),qs=Hs.exports,Us=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{attrs:{id:"vega-container"}},[i("div",{staticClass:"main-area"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.thumbnail,expression:"myState.thumbnail"}],staticClass:"labels"},[i("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.myState.thumbnail,expression:"!(myState.thumbnail)"}],staticClass:"labels"},[i("h3",{staticClass:"center"},[e._v(e._s(e.title))]),i("h5",{staticClass:"center"},[e._v(e._s(e.description))])]),e.hasFacets?i("div",{staticClass:"chart-area center-chart"},[i("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})]):e._e(),e.hasFacets?e._e():i("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})])]):e._e()},Ws=[],Gs=i("87e7"),Xs=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={title:"",description:""},e.title="",e.description="",e.loadingText="Flow Diagram",e.jsonChart={},e.totalTrips=0,e}return Object(w["a"])(i,[{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.yamlConfig||this.buildRouteFromUrl(),e.next=3,this.getVizDetails();case 3:this.thumbnail||this.generateBreadcrumbs();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:this.vizDetails=e.sent,this.vizDetails&&(this.jsonChart=this.processInputs()),this.loadingText="",Un.a.done();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={data:{}},e.prev=1,this.loadingText="Loading chart...",e.next=5,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.myState.yamlConfig);case 5:t=e.sent,this.description=t.description?t.description:"",this.title=t.title?t.title:this.myState.yamlConfig.substring(0,this.myState.yamlConfig.length-10).replace(/_/g," "),this.$emit("title",this.title),e.next=17;break;case 11:return e.prev=11,e.t0=e["catch"](1),console.error({e:e.t0}),this.loadingText=""+e.t0,this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url),e.abrupt("return");case 17:if(!t.data.url){e.next=38;break}if(e.prev=18,i="",a=this.myState.subfolder+"/"+t.data.url,!t.data.url.endsWith(".json")){e.next=28;break}return e.next=24,this.myState.fileApi.getFileJson(a);case 24:i=e.sent,i&&(t.data={values:i}),e.next=33;break;case 28:if(!t.data.url.endsWith(".csv")){e.next=33;break}return e.next=31,this.myState.fileApi.getFileText(a);case 31:i=e.sent,i&&(t.data={values:i,format:{type:"csv"}});case 33:e.next=38;break;case 35:e.prev=35,e.t1=e["catch"](18),console.warn(e.t1);case 38:return e.abrupt("return",t);case 39:case"end":return e.stop()}}),e,this,[[1,11],[18,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(){this.loadingText="Building chart...";var e={export:!0,source:!1,compiled:!1,editor:!1},t={actions:!this.thumbnail&&e,hover:!0,scaleFactor:2,padding:{top:2,left:8,right:8,bottom:8}};if(this.thumbnail&&this.vizDetails.encoding)for(var i=0,a=Object.keys(this.vizDetails.encoding);i<a.length;i++){var n=a[i];this.vizDetails.encoding[n].legend=null}Object(Gs["a"])("#".concat(this.cleanConfigId),this.vizDetails,t)}},{key:"cleanConfigId",get:function(){return this.myState.yamlConfig.replace(/[\W_]+/g,"")}},{key:"hasFacets",get:function(){return!!this.vizDetails&&(!!this.vizDetails.encoding&&!!(this.vizDetails.encoding.facet||this.vizDetails.encoding.row||this.vizDetails.encoding.column))}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],Xs.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Xs.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Xs.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Xs.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],Xs.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("yamlConfig")],Xs.prototype,"changedYaml",null),Object(j["a"])([Object(_["d"])("subfolder")],Xs.prototype,"changedSubfolder",null),Xs=Object(j["a"])([Object(_["a"])({components:{}})],Xs),v.commit("registerPlugin",{kebabName:"vega-lite",prettyName:"Chart",description:"Interactive chart visualization",filePatterns:["*.vega.json"],component:Xs});var Ys=Xs,Ks=Ys,Js=(i("0c3c"),Object(L["a"])(Ks,Us,Ws,!1,null,"664f8ede",null)),Zs=Js.exports,Qs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mycomponent",attrs:{id:e.containerId}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.thumbnail&&e.loadingText,expression:"!thumbnail && loadingText"}],staticClass:"status-blob"},[i("p",[e._v(e._s(e.loadingText))])]),e.thumbnail||e.isMobile()?e._e():i("div",{staticClass:"map-complications"},[i("legend-box",{staticClass:"complication",attrs:{rows:e.legendRows}}),i("scale-box",{staticClass:"complication",attrs:{rows:e.scaleRows}})],1),i("div",{staticClass:"map-container"},[i("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.loadingText?e._e():i("left-data-panel",{staticClass:"left-panel"},[i("div",{staticClass:"dashboard-panel"},[i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{"text-align":"center",padding:"0.5rem 3rem","font-weight":"normal",color:"white"}},[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?i("div",{staticClass:"info-description",staticStyle:{padding:"0px 0.5rem"}},[i("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),i("div",{staticClass:"widgets"},[i("h4",{staticClass:"heading"},[e._v("Uhrzeit")]),e.headers.length>0?i("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var i=e.showTimeRange,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showTimeRange=i.concat([s])):r>-1&&(e.showTimeRange=i.slice(0,r).concat(i.slice(r+1)))}else e.showTimeRange=n}}}),e._v(" Zeitraum")]),i("h4",{staticClass:"heading"},[e._v("Kreise")]),i("div",{staticClass:"white-box"},[i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroids,expression:"showCentroids"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroids)?e._i(e.showCentroids,null)>-1:e.showCentroids},on:{change:function(t){var i=e.showCentroids,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showCentroids=i.concat([s])):r>-1&&(e.showCentroids=i.slice(0,r).concat(i.slice(r+1)))}else e.showCentroids=n}}}),e._v(" Kreise anzeigen")]),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroidLabels,expression:"showCentroidLabels"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroidLabels)?e._i(e.showCentroidLabels,null)>-1:e.showCentroidLabels},on:{change:function(t){var i=e.showCentroidLabels,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showCentroidLabels=i.concat([s])):r>-1&&(e.showCentroidLabels=i.slice(0,r).concat(i.slice(r+1)))}else e.showCentroidLabels=n}}}),e._v(" Nummern anzeigen")])]),i("h4",{staticClass:"heading"},[e._v("Strecken")]),i("div",{staticClass:"white-box"},[i("div",{staticClass:"subheading"},[e._v("Linienbreiten")]),i("scale-slider",{staticClass:"scale-slider",attrs:{stops:e.scaleValues,initialTime:1},on:{change:e.bounceScaleSlider}}),i("div",{staticClass:"subheading"},[e._v("Ausblenden bis")]),i("line-filter-slider",{staticClass:"scale-slider",attrs:{initialValue:e.lineFilter},on:{change:e.bounceLineFilter}})],1),i("h4",{staticClass:"heading"},[e._v("Insgesamt für")]),i("div",{staticClass:"buttons-bar"},[i("button",{staticClass:"button",class:{"is-link":e.isOrigin,"is-active":e.isOrigin},on:{click:e.clickedOrigins}},[e._v("Quellen")]),i("button",{staticClass:"button",class:{"is-link":!e.isOrigin,"is-active":!e.isOrigin},attrs:{hint:"hide"},on:{click:e.clickedDestinations}},[e._v("Zielorte")])])],1)])])],1)},er=[],tr=(i("6b93"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"legend-container"}},[i("p",{staticClass:"title"},[e._v("Legende:")]),e._l(e.rows,(function(t){return i("div",{staticClass:"legend-item"},["string"===typeof t&&t.includes("#")?i("div",{staticClass:"legend-col",style:{"background-color":t}}):e._e(),"string"!==typeof t||t.includes("#")||"↓"!=t?e._e():i("div",{staticClass:"legend-element1"},[e._v(e._s(t))]),"string"!==typeof t||t.includes("#")||"↓"==t?e._e():i("div",{staticClass:"legend-element2"},[e._v(e._s(t))])])}))],2)}),ir=[],ar=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return Object(w["a"])(i,[{key:"created",value:function(){}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({type:Array,required:!0})],ar.prototype,"rows",void 0),ar=Object(j["a"])([_["a"]],ar);var nr=ar,sr=nr,rr=(i("31ec"),Object(L["a"])(sr,tr,ir,!1,null,"64318484",null)),or=rr.exports,lr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},cr=[],ur=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=0,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:0,data:[0,1,2,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,"Alle"],marks:[0,25,50,75,"Alle"],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom"},e}return Object(w["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.sliderValue=this.initialValue}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){console.log(e),this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])()],ur.prototype,"initialValue",void 0),Object(j["a"])([Object(_["b"])()],ur.prototype,"useRange",void 0),Object(j["a"])([Object(_["b"])()],ur.prototype,"stops",void 0),Object(j["a"])([Object(_["d"])("stops")],ur.prototype,"setStops",null),Object(j["a"])([Object(_["d"])("sliderValue")],ur.prototype,"sliderChangedEvent",null),ur=Object(j["a"])([Object(_["a"])({components:{"vue-slider":je.a}})],ur);var hr=ur,dr=hr,pr=(i("f0aa"),Object(L["a"])(dr,lr,cr,!1,null,"25daa34f",null)),mr=pr.exports,fr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"scale-container"}},[i("p",{staticClass:"title"},[e._v("Linienbreite:")]),i("div",{staticClass:"scale-element"},[e._v(e._s("|↔︎|"))]),i("div",{staticClass:"scale-scale"},[e._v(e._s("~ "+this.rows[0]+" Fahrten"))]),i("p")])},vr=[],br=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return Object(w["a"])(i,[{key:"created",value:function(){}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({type:Array,required:!0})],br.prototype,"rows",void 0),br=Object(j["a"])([_["a"]],br);var gr=br,yr=gr,kr=(i("b8ce"),Object(L["a"])(yr,fr,vr,!1,null,"487e92bd",null)),Sr=kr.exports,Cr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},wr=[],Or=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="All >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(w["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=et(e),i=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(i)}catch(a){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=et(e),i=("00"+t.minutes).slice(-2),a=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(i,":").concat(a)}},{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])()],Or.prototype,"initialTime",void 0),Object(j["a"])([Object(_["b"])()],Or.prototype,"useRange",void 0),Object(j["a"])([Object(_["b"])()],Or.prototype,"stops",void 0),Object(j["a"])([Object(_["d"])("initialTime")],Or.prototype,"initialTimeChanged",null),Object(j["a"])([Object(_["d"])("useRange")],Or.prototype,"changeUseRange",null),Object(j["a"])([Object(_["d"])("stops")],Or.prototype,"setStops",null),Object(j["a"])([Object(_["d"])("sliderValue")],Or.prototype,"sliderChangedEvent",null),Or=Object(j["a"])([Object(_["a"])({components:{"vue-slider":je.a}})],Or);var xr=Or,jr=xr,_r=(i("fc60"),Object(L["a"])(jr,Cr,wr,!1,null,"9a42ac2e",null)),Tr=_r.exports,Rr="Alle >>",Dr=0,Er=[1,3,5,10,25,50,100,150,200,300,400,450,500],Ar=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csvFile:"",shpFile:"",dbfFile:"",projection:"",scaleFactor:1,title:"",description:""},e.containerId="c".concat(Math.floor(Math.random()*Math.floor(1e10))),e.mapId="map-"+e.containerId,e.centroids={},e.centroidSource={},e.linkData={},e.spiderLinkFeatureCollection={},e.zoneData={},e.dailyData={},e.marginals={},e.hoveredStateId=0,e.rowName="",e.colName="",e.headers=[],e.geojson={},e.idColumn="",e.showTimeRange=!1,e.showCentroids=!0,e.showCentroidLabels=!0,e.isOrigin=!0,e.selectedCentroid=0,e.maxZonalTotal=0,e.loadingText="Aggregierte Quell-Ziel Muster",e.project={},e.scaleFactor=1,e.sliderValue=[1,500],e.scaleValues=Er,e.currentScale=Er[0],e.currentTimeBin=Rr,e.lineFilter=0,e.bounceTimeSlider=Object(kn["debounce"])(e.changedTimeSlider,100),e.bounceScaleSlider=Object(kn["debounce"])(e.changedScale,50),e.bounceLineFilter=Object(kn["debounce"])(e.changedLineFilter,250),e}return Object(w["a"])(i,[{key:"created",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0;case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"destroyed",value:function(){v.commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.thumbnail||v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:this.thumbnail||this.generateBreadcrumbs(),this.setupMap();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:this.setupMap();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clickedRange",value:function(e){console.log(e)}},{key:"clickedShowCentroids",value:function(){this.updateCentroidLabels()}},{key:"clickedShowCentroidBubbles",value:function(){this.updateCentroidLabels()}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 10:this.$emit("title",this.vizDetails.title),this.scaleFactor=this.vizDetails.scaleFactor,this.projection=this.vizDetails.projection,this.idColumn=this.vizDetails.idColumn?this.vizDetails.idColumn:"id",Un.a.done();case 15:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.loadingText="Dateien laden...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.csvFile);case 4:return t=e.sent,e.next=7,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.shpFile);case 7:return i=e.sent,e.next=10,Re.a.arraybuffer(i);case 10:return a=e.sent,e.next=13,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.dbfFile);case 13:return n=e.sent,e.next=16,Re.a.arraybuffer(n);case 16:return s=e.sent,e.abrupt("return",{shpFile:a,dbfFile:s,odFlows:t});case 20:return e.prev=20,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"setupMap",value:function(){try{this.mymap=new Hn.a.Map({container:this.mapId,logoPosition:"bottom-right",style:"mapbox://styles/mapbox/outdoors-v9"});var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(e){var t=JSON.parse(e),i=this.isMobile()?0:1,a={top:50*i,bottom:100*i,right:100*i,left:300*i};this.thumbnail?this.mymap.fitBounds(t,{animate:!1}):this.mymap.fitBounds(t,{padding:a,animate:!1})}this.mymap.on("click",this.handleEmptyClick),this.mymap.on("load",this.mapIsReady),this.mymap.addControl(new Hn.a.NavigationControl,"top-right")}catch(y){}if(this.thumbnail){var n,s=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact"),r=Object(b["a"])(s);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.setAttribute("style","display: none")}}catch(k){r.e(k)}finally{r.f()}s=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-group");var l,c=Object(b["a"])(s);try{for(c.s();!(l=c.n()).done;){var u=l.value;u.setAttribute("style","display: none")}}catch(k){c.e(k)}finally{c.f()}s=document.getElementsByClassName("mapboxgl-ctrl-logo");var h,d=Object(b["a"])(s);try{for(d.s();!(h=d.n()).done;){var p=h.value;p.setAttribute("style","display: none")}}catch(k){d.e(k)}finally{d.f()}}else{var m,f=document.getElementsByClassName("mapboxgl-ctrl-logo"),v=Object(b["a"])(f);try{for(v.s();!(m=v.n()).done;){var g=m.value;g.setAttribute("style","margin-bottom: 3rem;")}}catch(k){v.e(k)}finally{v.f()}}}},{key:"handleEmptyClick",value:function(e){this.fadeUnselectedLinks(-1),this.isMobile()}},{key:"mapIsReady",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,!t){e.next=18;break}return e.next=6,this.processShapefile(t);case 6:return this.geojson=e.sent,e.next=9,this.processHourlyData(t.odFlows);case 9:return e.next=11,this.getDailyDataSummary();case 11:this.marginals=e.sent,this.buildCentroids(this.geojson),this.convertRegionColors(this.geojson),this.addGeojsonToMap(this.geojson),this.setMapExtent(),this.buildSpiderLinks(),this.setupKeyListeners();case 18:this.loadingText="",Un.a.done();case 20:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isMobile",value:function(){var e=window,t=document,i=t.documentElement,a=t.getElementsByTagName("body")[0],n=e.innerWidth||i.clientWidth||a.clientWidth;e.innerHeight||i.clientHeight||a.clientHeight;return n<640}},{key:"createSpiderLinks",value:function(){var e=this;this.spiderLinkFeatureCollection={type:"FeatureCollection",features:[]};for(var t=0,i=Object.keys(this.linkData);t<i.length;t++){var a=i[t],n=this.linkData[a];if(!(n.daily<=this.lineFilter))try{(function(){var t=e.centroids[n.orig].geometry.coordinates,i=e.centroids[n.dest].geometry.coordinates,s=t[1]-i[1]>0?"#00aa66":"#880033",r=.7,o={id:a,orig:n.orig,dest:n.dest,daily:n.daily,color:s,fade:r};o[Rr]=n.daily,n.values.forEach((function(t,i){o[e.headers[i+1]]=t||0}));var l={type:"Feature",properties:o,geometry:{type:"LineString",coordinates:[t,i]}};e.spiderLinkFeatureCollection.features.push(l)})()}catch(s){}}}},{key:"updateSpiderLinks",value:function(){if(this.createSpiderLinks(),this.selectedCentroid)this.fadeUnselectedLinks(this.selectedCentroid);else{var e=this.mymap;e.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}}},{key:"buildSpiderLinks",value:function(){this.createSpiderLinks(),this.mymap.addSource("spider-source",{data:this.spiderLinkFeatureCollection,type:"geojson"}),this.mymap.addLayer({id:"spider-layer",source:"spider-source",type:"line",paint:{"line-color":["get","color"],"line-width":["*",.002*this.scaleFactor,["get","daily"]],"line-offset":["*",.5,["get","daily"]],"line-opacity":["get","fade"]}},"centroid-layer"),this.changedScale(this.currentScale);var e=this;this.mymap.on("click","spider-layer",(function(t){e.clickedOnSpiderLink(t)})),this.mymap.on("mousemove","spider-layer",(function(t){e.mymap.getCanvas().style.cursor=t?"pointer":"grab"})),this.mymap.on("mouseleave","spider-layer",(function(){e.mymap.getCanvas().style.cursor="grab"}))}},{key:"clickedOrigins",value:function(){this.isOrigin=!0,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"clickedDestinations",value:function(){this.isOrigin=!1,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"updateCentroidLabels",value:function(){var e=this.isOrigin?"{dailyFrom}":"{dailyTo}",t=this.isOrigin?"widthFrom":"widthTo";this.mymap.getLayer("centroid-layer")&&this.mymap.removeLayer("centroid-layer"),this.mymap.getLayer("centroid-label-layer")&&this.mymap.removeLayer("centroid-label-layer"),this.showCentroids&&this.mymap.addLayer({id:"centroid-layer",source:"centroids",type:"circle",paint:{"circle-color":"#ec0","circle-radius":["get",t],"circle-stroke-width":3,"circle-stroke-color":"white"}}),this.showCentroidLabels&&this.mymap.addLayer({id:"centroid-label-layer",source:"centroids",type:"symbol",layout:{"text-field":e,"text-size":11},paint:this.showCentroids?{}:{"text-halo-color":"white","text-halo-width":2}})}},{key:"unselectAllCentroids",value:function(){this.fadeUnselectedLinks(-1),this.selectedCentroid=0}},{key:"clickedOnCentroid",value:function(e){e.originalEvent.stopPropagating=!0;var t=e.features[0].properties,i=t.id;i!==this.selectedCentroid?(this.selectedCentroid=i,this.fadeUnselectedLinks(i)):this.unselectAllCentroids()}},{key:"fadeUnselectedLinks",value:function(e){var t,i=this.mymap,a=Object(b["a"])(this.spiderLinkFeatureCollection.features);try{for(a.s();!(t=a.n()).done;){var n=t.value,s=n.properties.id.split(":"),r=s[0]===String(e)||s[1]===String(e)?.7:Dr;-1===e&&(r=.7),n.properties.fade=r}}catch(o){a.e(o)}finally{a.f()}i.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}},{key:"clickedOnSpiderLink",value:function(e){if(!e.originalEvent.stopPropagating){var t=e.features[0].properties,i=t.daily*this.scaleFactor,a=0,n=t.dest+":"+t.orig;this.linkData[n]&&(a=this.linkData[n].daily*this.scaleFactor);var s=i+a,r="<h1><b>".concat(s.toLocaleString()," Bidirectional&nbsp;Trips</b></h1>");r+="<p>____________________________</p>",r+="<p>".concat(i," trips<br/>").concat(a," reverse trips</p>"),new Hn.a.Popup({closeOnClick:!0}).setLngLat(e.lngLat).setHTML(r).addTo(this.mymap)}}},{key:"convertRegionColors",value:function(e){var t,i=Object(b["a"])(e.features);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.properties){var n=this.isOrigin?a.properties.dailyFrom:a.properties.dailyTo,s=n/this.maxZonalTotal,r=128+127*(1-s);r||(r=255),a.properties.blue=r}}}catch(o){i.e(o)}finally{i.f()}}},{key:"handleCentroidsForTimeOfDayChange",value:function(e){var t,i={type:"FeatureCollection",features:[]},a=Object(b["a"])(this.geojson.features);try{for(a.s();!(t=a.n()).done;){var n=t.value,s=Wn["centerOfMass"](n);s.properties.id=n.id;var r=this.calculateCentroidValuesForZone(e,n);s.properties.dailyFrom=parseFloat((r.from*this.scaleFactor).toFixed(1)),s.properties.dailyTo=parseFloat((r.to*this.scaleFactor).toFixed(1)),this.dailyFrom=r.from*this.scaleFactor,this.dailyTo=r.to*this.scaleFactor,s.properties.widthFrom=Math.min(35,Math.max(12,4*(2+Math.log10(this.dailyFrom)))),s.properties.widthTo=Math.min(35,Math.max(12,Math.max(12,4*(2+Math.log10(this.dailyTo))))),n.properties||(n.properties={}),n.properties.dailyFrom=r.from,n.properties.dailyTo=r.to,s.properties.dailyFrom+s.properties.dailyTo>0&&(i.features.push(s),n.properties&&(this.centroids[n.properties[this.idColumn]]=s))}}catch(l){a.e(l)}finally{a.f()}this.centroidSource=i;var o=this.mymap;o.getSource("centroids").setData(this.centroidSource),this.updateCentroidLabels()}},{key:"calculateCentroidValuesForZone",value:function(e,t){var i=0,a=0;if("Alle >>"===e)return i=Math.round(this.marginals.rowTotal[t.id]),a=Math.round(this.marginals.colTotal[t.id]),{from:i,to:a};var n=this.marginals.from[t.id],s=this.marginals.to[t.id];if(Array.isArray(e)){var r=this.headers.indexOf(e[0])-1;r<0&&(r=0);for(var o=this.headers.indexOf(e[1])-1,l=r;l<=o;l++)i+=n?Math.round(n[l]):0,a+=s?Math.round(s[l]):0;return{from:i,to:a}}var c=this.headers.indexOf(e)-1;return i=n?Math.round(n[c]):0,a=s?Math.round(s[c]):0,{from:i,to:a}}},{key:"buildCentroids",value:function(e){var t,i={type:"FeatureCollection",features:[]},a=Object(b["a"])(e.features);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(n.id){var s=Wn["centerOfMass"](n);s.properties.id=n.id,s.id=n.id;var r=Math.round(this.marginals.rowTotal[n.id]),o=Math.round(this.marginals.colTotal[n.id]);r||(r=0),o||(o=0),s.properties.dailyFrom=r*this.scaleFactor,s.properties.dailyTo=o*this.scaleFactor,this.dailyFrom=s.properties.dailyFrom,this.dailyTo=s.properties.dailyTo,s.properties.widthFrom=Math.min(70,Math.max(12,Math.sqrt(this.dailyFrom/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),s.properties.widthTo=Math.min(70,Math.max(12,Math.sqrt(this.dailyTo/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),r&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,r)),o&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,o)),n.properties||(n.properties={}),n.properties.dailyFrom=r,n.properties.dailyTo=o,s.properties.dailyFrom+s.properties.dailyTo>0&&(i.features.push(s),n.properties&&(this.centroids[n.id]=s),this.updateMapExtent(s.geometry.coordinates))}}}catch(c){a.e(c)}finally{a.f()}this.centroidSource=i,this.mymap.addSource("centroids",{data:this.centroidSource,type:"geojson"}),this.updateCentroidLabels();var l=this;this.mymap.on("click","centroid-layer",(function(e){l.clickedOnCentroid(e)})),this.mymap.on("mousemove","centroid-layer",(function(e){l.mymap.getCanvas().style.cursor=e?"pointer":"grab"})),this.mymap.on("mouseleave","centroid-layer",(function(){l.mymap.getCanvas().style.cursor="grab"}))}},{key:"setMapExtent",value:function(){localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:50,bottom:100,right:100,left:300},animate:!1};this.mymap.fitBounds(this._mapExtentXYXY,e)}},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"processShapefile",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Verkehrsnetz bauarbeiten...",e.next=3,Vn["a"](t.shpFile,t.dbfFile);case 3:return i=e.sent,i.features.length>150&&(this.lineFilter=10),this.loadingText="Koordinaten berechnen...",e.next=8,Object(Ie["forEachAsync"])(i.features,(function(e){!a.idColumn&&e.properties&&(a.idColumn=Object.keys(e.properties)[0]),e.properties&&(e.id=e.properties[a.idColumn]);try{"MultiPolygon"===e.geometry.type?a.convertMultiPolygonCoordinatesToWGS84(e):a.convertPolygonCoordinatesToWGS84(e)}catch(t){console.error("ERR with feature: "+e),console.error(t)}}));case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(b["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,s=[],r=Object(b["a"])(n);try{for(r.s();!(a=r.n()).done;){var o=a.value,l=ya.toLngLat(this.projection,o);s.push(l)}}catch(c){r.e(c)}finally{r.f()}n.length=0,n.push.apply(n,s)}}catch(c){i.e(c)}finally{i.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(b["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,s=n[0],r=[],o=Object(b["a"])(s);try{for(o.s();!(a=o.n()).done;){var l=a.value,c=Object(ba["default"])(this.projection,"WGS84",l);r.push(c)}}catch(u){o.e(u)}finally{o.f()}n[0]=r}}catch(u){i.e(u)}finally{i.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,i=[],a=Object(b["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;Array.isArray(n[0])?i.push(this.recurseWGS84(n)):i.push(Object(ba["default"])(this.projection,"WGS84",n))}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"getDailyDataSummary",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},i={},a={},n={},e.next=6,Object(Ie["forEachAsync"])(Object.keys(this.zoneData),(function(e){a[e]=Array(r.headers.length-1).fill(0);for(var s=0,o=Object.keys(r.zoneData[e]);s<o.length;s++){var l=o[s];t[e]||(t[e]=0),i[l]||(i[l]=0),r.dailyData[e][l]&&(t[e]+=r.dailyData[e][l],i[l]+=r.dailyData[e][l]),n[l]||(n[l]=Array(r.headers.length-1).fill(0));for(var c=0;c<r.headers.length-1;c++)r.zoneData[e][l][c]&&(a[e][c]+=r.zoneData[e][l][c],n[l][c]+=r.zoneData[e][l][c])}}));case 6:for(s in this.zoneData);return e.abrupt("return",{rowTotal:t,colTotal:i,from:a,to:n});case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processHourlyData",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Uhrzeitdaten entwicklen...",i=t.split("\n"),a=i[0].indexOf(";")>0?";":",",n=i[0].split(a).map((function(e){return e.trim()})),this.rowName=n[0],this.colName=n[1],this.headers=[Rr].concat(n.slice(2)),e.next=9,Object(Ie["forEachAsync"])(i.slice(1),(function(e){var t=e.split(a),i=t.slice(2).map((function(e){return parseFloat(e)})),n=t[0],r=t[1];s.zoneData[n]||(s.zoneData[n]={}),s.zoneData[n][r]=i;var o=i.reduce((function(e,t){return e+t}),0);if(s.dailyData[n]||(s.dailyData[n]={}),s.dailyData[n][r]=o,0!==o){var l=String(t[0])+":"+String(t[1]);s.linkData[l]={orig:t[0],dest:t[1],daily:o,values:i}}}));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this._mapExtentXYXY[0]=Math.min(this._mapExtentXYXY[0],e[0]),this._mapExtentXYXY[1]=Math.min(this._mapExtentXYXY[1],e[1]),this._mapExtentXYXY[2]=Math.max(this._mapExtentXYXY[2],e[0]),this._mapExtentXYXY[3]=Math.max(this._mapExtentXYXY[3],e[1])}},{key:"addGeojsonToMap",value:function(e){this.addGeojsonLayers(e),this.addNeighborhoodHoverEffects()}},{key:"addGeojsonLayers",value:function(e){this.mymap.addSource("shpsource",{data:e,type:"geojson"}),this.mymap.addLayer({id:"shplayer-fill",source:"shpsource",type:"fill",paint:{"fill-color":["rgb",["get","blue"],["get","blue"],255],"fill-opacity":.5}},"road-primary"),this.mymap.addLayer({id:"shplayer-border",source:"shpsource",type:"line",paint:{"line-color":"#66f","line-opacity":.5,"line-width":["case",["boolean",["feature-state","hover"],!1],3,1]}},"centroid-layer")}},{key:"addNeighborhoodHoverEffects",value:function(){var e=this;this.mymap.on("mousemove","shplayer-fill",(function(t){var i=e.mymap;t.features.length>0&&(e.hoveredStateId&&i.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=t.features[0].properties[e.idColumn],i.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!0}))})),this.mymap.on("mouseleave","shplayer-fill",(function(){var t=e.mymap;e.hoveredStateId&&t.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=null}))}},{key:"offsetLineByMeters",value:function(e,t){try{var i=Wn["lineOffset"](e,t,{units:"meters"});return i}catch(a){}return e}},{key:"pressedEscape",value:function(){this.unselectAllCentroids()}},{key:"pressedArrowKey",value:function(e){}},{key:"changedTimeSlider",value:function(e){this.currentTimeBin=e;var t=this.currentScale/500*this.scaleFactor;if(0==this.showTimeRange)this.mymap.setPaintProperty("spider-layer","line-width",["*",t,["get",e]]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,["get",e]]);else{var i,a=["+"],n=!1,s=Object(b["a"])(this.headers);try{for(s.s();!(i=s.n()).done;){var r=i.value;r===e[0]&&(n=!0),r!==Rr&&(n&&a.push(["get",r]),r===e[1]&&(n=!1))}}catch(o){s.e(o)}finally{s.f()}this.mymap.setPaintProperty("spider-layer","line-width",["*",t,a]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,a])}this.handleCentroidsForTimeOfDayChange(e)}},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedLineFilter",value:function(e){this.lineFilter="Alle"===e?1/0:e,this.updateSpiderLinks()}},{key:"legendRows",get:function(){return["#00aa66","#880033","↓","↑"]}},{key:"scaleRows",get:function(){return[Math.min(Math.round((1200*Math.pow(this.currentScale,-1)+20)*Math.sqrt(this.scaleFactor)),1e3*this.scaleFactor)]}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],Ar.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ar.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ar.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Ar.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],Ar.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("showTimeRange")],Ar.prototype,"clickedRange",null),Object(j["a"])([Object(_["d"])("showCentroids")],Ar.prototype,"clickedShowCentroids",null),Object(j["a"])([Object(_["d"])("showCentroidLabels")],Ar.prototype,"clickedShowCentroidBubbles",null),Ar=Object(j["a"])([Object(_["a"])({components:{LeftDataPanel:Qn,LegendBox:or,LineFilterSlider:mr,ScaleBox:Sr,ScaleSlider:rs,TimeSlider:Tr}})],Ar),v.commit("registerPlugin",{kebabName:"aggregate-od",prettyName:"Origin/Destination Patterns",description:"Depicts aggregate O/D flows between areas.",filePatterns:["viz-od*.y?(a)ml"],component:Ar});var Fr,Lr=Ar,Mr=Lr,Pr=(i("6a1a"),Object(L["a"])(Mr,Qs,er,!1,null,"66d61fb1",null)),zr=Pr.exports,Nr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"container"}},[!e.thumbnail&&e.loadingText?i("div",{staticClass:"status-blob"},[i("p",[e._v(e._s(e.loadingText))])]):e._e(),e.routesOnLink.length>0?i("left-data-panel",{staticClass:"left-panel",attrs:{title:"Transit routes on selected link:"}},[i("div",{staticClass:"dashboard-panel"},[0===e.routesOnLink.length?i("p",{staticClass:"details help-text",staticStyle:{"margin-top":"20px"}},[e._v("Select a link to see the routes traversing it.")]):e._e(),i("div",{staticClass:"route-list"},e._l(e.routesOnLink,(function(t){return i("div",{key:t.uniqueRouteID,staticClass:"route",class:{highlightedRoute:e.selectedRoute&&t.id===e.selectedRoute.id},on:{click:function(i){return e.showRouteDetails(t.id)}}},[i("h3",{staticClass:"mytitle"},[e._v(e._s(t.id))]),i("p",{staticClass:"details"},[i("b",[e._v(e._s(t.departures)+" departures")])]),i("p",{staticClass:"details"},[e._v("First: "+e._s(t.firstDeparture))]),i("p",{staticClass:"details"},[e._v("Last: "+e._s(t.lastDeparture))])])})),0)])]):e._e(),i("div",{staticClass:"map-container",class:{"hide-thumbnail":!e.thumbnail}},[i("div",{attrs:{id:"mymap"}},e._l(e.stopMarkers,(function(e){return i("div",{key:e.i,staticClass:"stop-marker",style:{transform:"translate(-50%,-50%) rotate("+e.bearing+"deg)",left:e.xy.x+"px",top:e.xy.y+"px"}})})),0)]),e.thumbnail?e._e():i("legend-box",{staticClass:"legend",attrs:{rows:e.legendRows}})],1)},Ir=[],Br=(i("6062"),i("6b0c")),Vr=i.n(Br);(function(e){e["CreateNodesAndLinks"]="CreateNodesAndLinks",e["ConvertCoordinates"]="ConvertCoordinates",e["ProcessTransit"]="ProcessTransit"})(Fr||(Fr={}));var $r=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.call(this,new Vr.a)}return Object(w["a"])(i,[{key:"createNodesAndLinks",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Fr.CreateNodesAndLinks,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertCoordinates",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Fr.ConvertCoordinates,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processTransit",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Fr.ProcessTransit,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(St,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(Ot),Hr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"legend-container"}},[i("p",{staticClass:"title"},[e._v("Legend")]),e._l(e.rows,(function(t){return i("div",{key:t[0],staticClass:"legend-item"},[i("div",{staticClass:"legend-col-1",style:{"background-color":t[0]}}),i("span",{staticClass:"legend-col-2"},[e._v(e._s(t[1]))])])}))],2)},qr=[],Ur=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){return Object(C["a"])(this,i),t.apply(this,arguments)}return Object(w["a"])(i,[{key:"created",value:function(){console.log(this.rows)}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({type:Array,required:!0})],Ur.prototype,"rows",void 0),Ur=Object(j["a"])([_["a"]],Ur);var Wr=Ur,Gr=Wr,Xr=(i("677a"),Object(L["a"])(Gr,Hr,qr,!1,null,"cb0d8438",null)),Yr=Xr.exports,Kr="EPSG:31468",Jr=16,Zr=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.vizDetails={transitSchedule:"",network:"",projection:"",title:"",description:""},e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.loadingText="MATSim Transit Inspector",e.project={},e.projection=Kr,e.routesOnLink=[],e.selectedRoute={},e.stopMarkers=[],e}return Object(w["a"])(i,[{key:"created",value:function(){this._attachedRouteLayers=[],this._departures={},this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0,this._network={nodes:{},links:{}},this._routeData={},this._stopFacilities={},this._transitLines={},this.selectedRoute=null}},{key:"destroyed",value:function(){v.commit("setFullScreen",!1)}},{key:"authenticationChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){this._roadFetcher&&this._roadFetcher.destroy(),this._transitFetcher&&this._transitFetcher.destroy(),this._transitHelper&&this._transitHelper.destroy()}},{key:"mounted",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.setupMap();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(b["a"])(i),e.prev=6,n.s();case 8:if((s=n.n()).done){e.next=16;break}if(r=s.value,r){e.next=12;break}return e.abrupt("continue",14);case 12:a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Ce.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),v.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Ce.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.fileSystem.url);case 10:i=this.vizDetails.title?this.vizDetails.title:"Transit Network",this.$emit("title",i),this.projection=this.vizDetails.projection,Un.a.done();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"isMobile",value:function(){var e=window,t=document,i=t.documentElement,a=t.getElementsByTagName("body")[0],n=e.innerWidth||i.clientWidth||a.clientWidth;e.innerHeight||i.clientHeight||a.clientHeight;return n<640}},{key:"setupMap",value:function(){this.mymap=new Hn.a.Map({bearing:0,container:"mymap",logoPosition:"bottom-right",style:"mapbox://styles/mapbox/dark-v9",pitch:0});try{var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(console.log({extent:e}),e){var t=JSON.parse(e);this.isMobile();this.thumbnail,this.mymap.fitBounds(t,{animate:!1})}}catch(i){console.log({E:i})}this.mymap.on("load",this.mapIsReady),this.mymap.on("move",this.handleMapMotion),this.mymap.on("zoom",this.handleMapMotion),this.mymap.on("click",this.handleEmptyClick),this.mymap.keyboard.disable(),this.mymap.addControl(new Hn.a.NavigationControl,"top-right")}},{key:"handleMapMotion",value:function(){this.stopMarkers.length>0&&this.showTransitStops()}},{key:"handleEmptyClick",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute(),this.removeAttachedRoutes(),this.routesOnLink=[]}},{key:"showRouteDetails",value:function(e){(e||this.selectedRoute)&&(console.log({routeID:e}),e?this.showTransitRoute(e):this.showTransitRoute(this.selectedRoute.id),this.showTransitStops())}},{key:"mapIsReady",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadNetworks();case 2:t=e.sent,t&&this.processInputs(t),this.setupKeyListeners();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"loadNetworks",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,console.log(this.vizDetails),this.myState.fileSystem){e.next=4;break}return e.abrupt("return");case 4:return this.loadingText="Loading networks...",e.next=7,qa.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 7:return this._roadFetcher=e.sent,e.next=10,qa.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.transitSchedule});case 10:return this._transitFetcher=e.sent,t=this._roadFetcher.fetchXML(),i=this._transitFetcher.fetchXML(),e.next=15,Promise.all([t,i]);case 15:return a=e.sent,this._roadFetcher.destroy(),this._transitFetcher.destroy(),e.abrupt("return",{roadXML:a[0],transitXML:a[1]});case 21:return e.prev=21,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Preparing...",e.next=3,$r.create({xml:t,projection:this.projection});case 3:return this._transitHelper=e.sent,this.loadingText="Crunching road network...",e.next=7,this._transitHelper.createNodesAndLinks();case 7:return this.loadingText="Converting coordinates...",e.next=10,this._transitHelper.convertCoordinates();case 10:return this.loadingText="Crunching transit network...",e.next=13,this._transitHelper.processTransit();case 13:return i=e.sent,this._network=i.network,this._routeData=i.routeData,this._stopFacilities=i.stopFacilities,this._transitLines=i.transitLines,this._mapExtentXYXY=i.mapExtent,this.loadingText="Summarizing departures...",e.next=22,this.processDepartures();case 22:return e.next=24,this.constructDepartureFrequencyGeoJson();case 24:return a=e.sent,e.next=27,this.addTransitToMap(a);case 27:localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY)),this.mymap.fitBounds(this._mapExtentXYXY,{padding:{top:2,bottom:2,right:2,left:2},animate:!1}),this.loadingText="",Un.a.done();case 31:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addLinksToMap",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.constructGeoJsonFromLinkData(),this.mymap.addSource("link-data",{data:t,type:"geojson"}),this.mymap.addLayer({id:"link-layer",source:"link-data",type:"line",paint:{"line-opacity":1,"line-width":3,"line-color":"#ccf"}});case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processDepartures",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t in this.loadingText="Processing departures",this._transitLines)if(this._transitLines.hasOwnProperty(t)){i=this._transitLines[t],a=Object(b["a"])(i.transitRoutes);try{for(a.s();!(n=a.n()).done;){s=n.value,r=Object(b["a"])(s.route);try{for(r.s();!(o=r.n()).done;)l=o.value,l in this._departures||(this._departures[l]={total:0,routes:new Set}),this._departures[l].total+=s.departures,this._departures[l].routes.add(s.id),this._maximum=Math.max(this._maximum,this._departures[l].total)}catch(c){r.e(c)}finally{r.f()}}}catch(c){a.e(c)}finally{a.f()}}case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addTransitToMap",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.mymap.addSource("transit-source",{data:t,type:"geojson"}),this.mymap.addLayer({id:"transit-link",source:"transit-source",type:"line",paint:{"line-opacity":1,"line-width":["get","width"],"line-color":["get","color"]}}),i=this,this.mymap.on("click","transit-link",(function(e){i.clickedOnTransitLink(e)})),this.mymap.on("mousemove","transit-link",(function(e){i.mymap.getCanvas().style.cursor=e?"pointer":"grab"})),this.mymap.on("mouseleave","transit-link",(function(){i.mymap.getCanvas().style.cursor="grab"}));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"constructGeoJsonFromLinkData",value:function(){var e=[];for(var t in this._network.links)if(this._network.links.hasOwnProperty(t)){var i=this._network.links[t],a=this._network.nodes[i.from],n=this._network.nodes[i.to],s=[[a.x,a.y],[n.x,n.y]],r={type:"Feature",geometry:{type:"LineString",coordinates:s},properties:{id:t,color:"#aaa"}};e.push(r)}return this._linkData={type:"FeatureCollection",features:e},this._linkData}},{key:"constructDepartureFrequencyGeoJson",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u,h,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i in this.loadingText="Construct departure frequencies",t=[],this._departures)if(this._departures.hasOwnProperty(i)){a=this._network.links[i],n=[[this._network.nodes[a.from].x,this._network.nodes[a.from].y],[this._network.nodes[a.to].x,this._network.nodes[a.to].y]],s=this._departures[i].total,r=.25+.75*(s-1)/this._maximum,o=Math.floor(Jr*r),l=!0,c=Object(b["a"])(this._departures[i].routes);try{for(c.s();!(u=c.n()).done;)h=u.value,"bus"===this._routeData[h].transportMode&&(l=!1)}catch(p){c.e(p)}finally{c.f()}d={type:"Feature",geometry:{type:"LineString",coordinates:n},properties:{width:Math.max(3,.01*this._departures[i].total),color:l?"#a03919":eo[o],colorBin:o,departures:s,id:i,isRail:l,from:a.from,to:a.to}},d=this.offsetLineByMeters(d,-10),t.push(d)}return t.sort((function(e,t){return e.isRail&&!t.isRail?-1:t.isRail&&!e.isRail?1:0})),e.abrupt("return",{type:"FeatureCollection",features:t});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"offsetLineByMeters",value:function(e,t){try{var i=Wn["lineOffset"](e,t,{units:"meters"});return i}catch(a){}return e}},{key:"removeStopMarkers",value:function(){this.stopMarkers=[]}},{key:"showTransitStops",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u,h,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.removeStopMarkers(),t=this.selectedRoute,"stopmarker",i=this.mymap.getBearing(),n=Object(b["a"])(t.routeProfile.entries());try{for(n.s();!(s=n.n()).done;)r=Object(Tt["a"])(s.value,2),o=r[0],l=r[1],c=[this._stopFacilities[l.refId].x,this._stopFacilities[l.refId].y],o<t.routeProfile.length-1&&(u=Wn["point"]([c[0],c[1]]),h=Wn["point"]([this._stopFacilities[t.routeProfile[o+1].refId].x,this._stopFacilities[t.routeProfile[o+1].refId].y]),a=Wn["bearing"](u,h)-i),d=this.mymap.project([c[0],c[1]]),p={i:o,bearing:a,xy:{x:Math.floor(d.x),y:Math.floor(d.y)}},this.stopMarkers.push(p)}catch(m){n.e(m)}finally{n.f()}case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showTransitRoute",value:function(e){if(e){var t=this._routeData[e];console.log({SELECTED_ROUTE:t}),this.selectedRoute=t;var i=this.mymap.getSource("selected-route-data");i?i.setData(t.geojson):this.mymap.addSource("selected-route-data",{data:t.geojson,type:"geojson"}),this.mymap.getLayer("selected-route")||this.mymap.addLayer({id:"selected-route",source:"selected-route-data",type:"line",paint:{"line-opacity":1,"line-width":5,"line-color":"#097c43"}})}}},{key:"removeSelectedRoute",value:function(){this.selectedRoute&&(this.mymap.removeLayer("selected-route"),this.selectedRoute=null)}},{key:"clickedOnTransitLink",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute();var t,i=e.features[0].properties,a=this._departures[i.id].routes,n=[],s=Object(b["a"])(a);try{for(s.s();!(t=s.n()).done;){var r=t.value;n.push(this._routeData[r])}}catch(o){s.e(o)}finally{s.f()}n.sort((function(e,t){return e.departures>t.departures?-1:1})),this.routesOnLink=n,this.highlightAllAttachedRoutes(),n.length>0&&this.showRouteDetails(n[0].id)}},{key:"removeAttachedRoutes",value:function(){var e,t=Object(b["a"])(this._attachedRouteLayers);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.mymap.removeLayer("route-"+i),this.mymap.removeSource("source-route-"+i)}}catch(a){t.e(a)}finally{t.f()}this._attachedRouteLayers=[]}},{key:"highlightAllAttachedRoutes",value:function(){this.removeAttachedRoutes();var e,t=Object(b["a"])(this.routesOnLink);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.mymap.addSource("source-route-"+i.id,{data:i.geojson,type:"geojson"}),this.mymap.addLayer({id:"route-"+i.id,source:"source-route-"+i.id,type:"line",paint:{"line-opacity":.7,"line-width":8,"line-color":"#ccff33"}}),this._attachedRouteLayers.push(i.id)}}catch(a){t.e(a)}finally{t.f()}}},{key:"pressedEscape",value:function(){this.removeSelectedRoute(),this.removeStopMarkers(),this.removeAttachedRoutes(),this.selectedRoute=null,this.routesOnLink=[]}},{key:"pressedArrowKey",value:function(e){if(this.selectedRoute){var t=this.routesOnLink.indexOf(this.selectedRoute);t+=e,t<0||t>=this.routesOnLink.length||this.showRouteDetails(this.routesOnLink[t].id)}}},{key:"legendRows",get:function(){return[["#a03919","Rail"],["#448","Bus"]]}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],Zr.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Zr.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Zr.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],Zr.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],Zr.prototype,"authenticationChanged",null),Zr=Object(j["a"])([Object(_["a"])({components:{LeftDataPanel:Qn,LegendBox:Yr}})],Zr),v.commit("registerPlugin",{kebabName:"transit-supply",prettyName:"Transit Routes",description:"The scheduled transit routes on a network",filePatterns:["viz-transit*.y?(a)ml"],component:Zr});var Qr=Zr,eo=Fe()({colormap:"viridis",nshades:Jr}),to=Qr,io=(i("b950"),Object(L["a"])(to,Nr,Ir,!1,null,"259a0118",null)),ao=io.exports,no=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{padding:e.thumbnail?"0 0":"0 20px 20px 20px"},attrs:{id:"container"}},[e.thumbnail?e._e():i("h3",[e._v(e._s(e.title))]),i("div",{staticClass:"vid-container"},[e.movieSource?i("video-player",{ref:"videoPlayer",staticClass:"vjs-default-skin vjs-big-play-centered",attrs:{options:e.playerOptions}}):e._e()],1)])},so=[],ro=i("d6d3"),oo=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.movieSource="",e.title="",e.playerOptions={muted:!1,language:"en",playbackRates:[.5,1,1.5,2,5],preload:"metadata",responsive:!0,fluid:!0,playsInline:!0,controls:!0,sources:[]},e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.aspect=0,e}return Object(w["a"])(i,[{key:"destroyed",value:function(){window.removeEventListener("resize",this.onResize),this.thumbnail||v.commit("setFullScreen",!1)}},{key:"mounted",value:function(){if(this.thumbnail||v.commit("setFullScreen",!0),this.yamlConfig){var e=this.getFileSystem(this.$route.name);this.buildMovieSource(e.svn,this.subfolder+"/",this.yamlConfig)}else this.buildRouteFromUrl();this.getVizDetails(),this.thumbnail||this.generateBreadcrumbs(),this.thumbnail||window.addEventListener("resize",this.onResize)}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"buildMovieSource",value:function(e,t,i){this.movieSource="".concat(e,"/").concat(t).concat(i),this.playerOptions.sources.push({type:"video/mp4",src:this.movieSource})}},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length&&(t=v.state.svnProjects.filter((function(t){return t.url===e.substring(8)}))),0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t);var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n,this.buildMovieSource(t.svn,a,n)}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"onResize",value:function(){var e=document.getElementsByClassName("vid-container")[0],t=document.getElementsByClassName("video-js")[0];this.aspect||(this.aspect=t.clientHeight/t.clientWidth);e.clientWidth;var i=window.innerHeight,a=window.innerWidth;e.style.width="100%",e.style.margin="auto auto";var n=i-120,s=Math.floor(n/this.aspect);t.style.width="".concat(s,"px"),t.style.height="".concat(s*this.aspect,"px"),e.style.width="".concat(s,"px"),e.style.height="".concat(s*this.aspect,"px");var r=a-60;if(t.clientWidth>r){var o=r;t.style.width="".concat(o,"px"),t.style.height="".concat(o*this.aspect,"px"),e.style.width="".concat(o,"px"),e.style.height="".concat(o*this.aspect,"px")}}},{key:"generateBreadcrumbs",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.getFileSystem(this.$route.params.project),t){e.next=3;break}return e.abrupt("return",[]);case 3:i=[{label:t.name,url:"/"+t.url}],a=this.myState.subfolder.split("/"),n="/",s=Object(b["a"])(a),e.prev=7,s.s();case 9:if((r=s.n()).done){e.next=17;break}if(o=r.value,o){e.next=13;break}return e.abrupt("continue",15);case 13:n+=o+"/",i.push({label:o,url:"/"+t.url+n});case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](7),s.e(e.t0);case 22:return e.prev=22,s.f(),e.finish(22);case 25:return v.commit("setBreadCrumbs",i),e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[7,19,22,25]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.title=this.myState.yamlConfig.replace(/_/g," "),this.title=this.title.substring(0,this.title.lastIndexOf(".")),this.title&&this.$emit("title",this.title);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],oo.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],oo.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],oo.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],oo.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("yamlConfig")],oo.prototype,"changedYaml",null),Object(j["a"])([Object(_["d"])("subfolder")],oo.prototype,"changedSubfolder",null),oo=Object(j["a"])([Object(_["a"])({components:{"video-player":ro["videoPlayer"]}})],oo),v.commit("registerPlugin",{kebabName:"video-player",prettyName:"Video",description:"",filePatterns:["*.mp4"],component:oo});var lo=oo,co=lo,uo=(i("8838"),Object(L["a"])(co,no,so,!1,null,"16e5d11d",null)),ho=uo.exports,po=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{staticClass:"image-container",class:{zthumbnail:e.thumbnail}},[i("img",{staticClass:"medium-zoom",class:{"invert-colors":e.isDarkMode},attrs:{src:e.myState.imageData}})]):e._e()},mo=[],fo=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.matsimPngTitles={"modestats.png":"Mode statistics","ph_modestats.png":"Passenger hours traveled per mode","pkm_modestats.png":"Passenger km traveled per mode","scorestats.png":"Score statistics","stopwatch.png":"Stopwatch: computation time","traveldistancestatslegs.png":"Leg travel distance","traveldistancestatstrips.png":"Trip travel distance"},e}return Object(w["a"])(i,[{key:"mounted",value:function(){this.yamlConfig||this.buildRouteFromUrl(),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Zt(t);var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:if(t=e.sent,t){e.next=7;break}return console.log("no blob! :-("),e.abrupt("return");case 7:return e.next=9,Re.a.dataurl(t);case 9:i=e.sent,this.myState.imageData=i,a=this.matsimPngTitles[this.yamlConfig]?this.matsimPngTitles[this.yamlConfig]:this.yamlConfig,this.$emit("title",a),e.next=19;break;case 15:return e.prev=15,e.t0=e["catch"](0),console.error({e:e.t0}),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"isDarkMode",get:function(){return this.globalState.colorScheme==n.DarkMode}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!1})],fo.prototype,"fileApi",void 0),Object(j["a"])([Object(_["b"])({required:!1})],fo.prototype,"subfolder",void 0),Object(j["a"])([Object(_["b"])({required:!1})],fo.prototype,"yamlConfig",void 0),Object(j["a"])([Object(_["b"])({required:!1})],fo.prototype,"thumbnail",void 0),Object(j["a"])([Object(_["d"])("yamlConfig")],fo.prototype,"changedYaml",null),Object(j["a"])([Object(_["d"])("subfolder")],fo.prototype,"changedSubfolder",null),fo=Object(j["a"])([Object(_["a"])({components:{}})],fo),v.commit("registerPlugin",{kebabName:"image-view",prettyName:"Image",description:"",filePatterns:["!(*thumbnail*).(png|jpg)"],component:fo});var vo=fo,bo=vo,go=(i("7942"),Object(L["a"])(bo,po,mo,!1,null,"d5524b92",null)),yo=go.exports,ko={VehicleAnimation:oa,CarrierViewer:si,XyHexagons:xa,AgentAnimation:ln,LinksGl:Nn,LinkVolumes:gs,ShapeFile:Fs,SankeyDiagram:qs,VegaLite:Zs,AggregateOd:zr,TransitSupply:ao,VideoPlayer:ho,ImageView:yo},So=ko,Co=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.activePlot?i("div",{staticClass:"sankey-flipper"},[i("div",{staticClass:"diagram"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.activePlot.piechart,expression:"activePlot.piechart"}],staticClass:"pie",attrs:{id:"pie-chart"}}),e.selectedPlotNumber>-1&&!e.activePlot.piechart?i("sankey-diagram",{attrs:{yamlConfig:e.activePlot.config,fileApi:e.myState.svnRoot,subfolder:""+e.myState.selectedRun,thumbnail:!0,flipperID:"sankey-flipper"}}):e._e()],1),i("h4",[e._v(e._s(this.selectedPlotNumber+1+". "+e.activePlot.title))]),i("div",{staticClass:"buttons-prev-next"},[i("button",{staticClass:"button is-outlined",on:{click:function(t){return e.switchPlot(-1)}}},[e._m(0),i("span",[e._v(e._s(e.$t("prev")))])]),i("button",{staticClass:"button is-outlined",on:{click:function(t){return e.switchPlot(1)}}},[i("span",[e._v(e._s(e.$t("next")))]),e._m(1)])])]):e._e()},wo=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon is-small"},[i("i",{staticClass:"fas fa-arrow-left"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon is-small"},[i("i",{staticClass:"fas fa-arrow-right"})])}];Number.prototype.mod=function(e){return(this%e+e)%e};var Oo={actions:!1,hover:!0,padding:{top:0,left:5,right:5,bottom:0}},xo=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.allSankeys=[],e.selectedPlotNumber=-1,e}return Object(w["a"])(i,[{key:"switchPlot",value:function(e){this.selectedPlotNumber=(this.selectedPlotNumber+e).mod(this.allSankeys.length)}},{key:"mounted",value:function(){var e=[];if(this.modeSharePie.description&&(e.push({piechart:!0,title:this.modeSharePie.description}),Object(Gs["a"])("#pie-chart",this.modeSharePie,Oo)),this.myState.vizes){var t=this.myState.vizes.filter((function(e){return"sankey-diagram"===e.component}));e.push.apply(e,Object(li["a"])(t))}this.allSankeys=e,this.selectedPlotNumber=0}},{key:"activePlot",get:function(){return this.allSankeys[this.selectedPlotNumber]}}]),i}(_["c"]);Object(j["a"])([Object(_["b"])({required:!0})],xo.prototype,"modeSharePie",void 0),Object(j["a"])([Object(_["b"])({required:!0})],xo.prototype,"myState",void 0),xo=Object(j["a"])([Object(_["a"])({components:{SankeyDiagram:qs}})],xo);var jo=xo,_o=jo,To=(i("a696"),i("2876")),Ro=Object(L["a"])(_o,Co,wo,!1,null,"6b449efe",null);"function"===typeof To["default"]&&Object(To["default"])(Ro);var Do=Ro.exports,Eo={messages:{en:{Analysis:"Analysis",Files:"Files",Folders:"Folders"},de:{Analysis:"Ergebnisse",Files:"Dateien",Folders:"Ordner"}}},Ao=9,Fo=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.mdRenderer=new R.a,e.runLookup={},e.modeSharePie={},e.infoHover=!1,e.needsInitialRun=!0,e.runCosts={fixedCosts:1,variableCosts:1},e.runHeader={demand:1,fleetSize:1,mileage:1,carMileage:0,revenueDistance:1,incomePerDay:1,serviceQuality:1,tollIncome:0},e.myState={errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",information:"",svnProject:null,vizes:[],runFinder:{dimensions:[]},activeButtons:{},runLogFolderLookup:{},selectedRun:""},e.imageLookups={},e.numberOfOperators=1,e.totalMileage=0,e.operatorNumber=1,e}return Object(w["a"])(i,[{key:"getFileSystem",value:function(e){var t=v.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getUrlForServiceAreaImage",value:function(e){var t;return null===(t=this.myState.svnRoot)||void 0===t?void 0:t.cleanURL(e.image)}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.svnProject)return[];var e=[];return v.commit("setBreadCrumbs",e),e}},{key:"mounted",value:function(){v.commit("setFullScreen",!0),this.loadImageLookups(),this.updateRoute()}},{key:"beforeDestroy",value:function(){v.commit("setFullScreen",!1)}},{key:"loadImageLookups",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!Object.keys(this.imageLookups).length&&this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.myState.svnRoot.getFileText("../thumbnail_title_lookup.csv");case 5:t=e.sent,i=ke.a.parse(t,{header:!0,skipEmptyLines:!0}).data,a=Object(b["a"])(i);try{for(a.s();!(n=a.n()).done;)s=n.value,this.imageLookups[s.fileNameEnding]={en:s.title_english,de:s.title_german}}catch(r){a.e(r)}finally{a.f()}e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](2),console.warn(e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearState",value:function(){this.runLookup={},this.modeSharePie={},this.needsInitialRun=!0,this.myState={errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",information:"",svnProject:null,vizes:[],runFinder:{dimensions:[]},activeButtons:{},runLogFolderLookup:{},selectedRun:""}}},{key:"updateRoute",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.$route.name){e.next=2;break}return e.abrupt("return");case 2:if(t=this.getFileSystem(this.$route.name),t===this.myState.svnProject){e.next=9;break}return console.log("clearing"),this.clearState(),this.myState.svnRoot=new Zt(t),e.next=9,this.buildRunFinder();case 9:if(this.myState.svnProject=t,this.myState.svnProject){e.next=12;break}return e.abrupt("return");case 12:if(this.myState.svnRoot=new Zt(this.myState.svnProject),this.loadImageLookups(),this.$route.params.pathMatch?this.myState.selectedRun=this.$route.params.pathMatch:(this.myState.selectedRun="",this.setInitialRun()),console.log({selectedRun:this.myState.selectedRun}),this.generateBreadcrumbs(),this.needsInitialRun&&this.setInitialRun(),!this.myState.selectedRun){e.next=24;break}return e.next=21,this.fetchFolderContents();case 21:i=this.runLookup[this.myState.selectedRun],i&&i.calcDemand2?this.numberOfOperators=2:this.numberOfOperators=1,this.showRunHeader();case 24:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateOperator",value:function(e){var t=(this.operatorNumber+e+1)%this.numberOfOperators;this.operatorNumber=t+1,console.log(this.operatorNumber),this.showRunHeader()}},{key:"loadRunLog",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:return this.myState.vizes=[],t=[],e.prev=4,i="run-log.csv",e.next=8,this.myState.svnRoot.getFileText("/"+i);case 8:a=e.sent,this.runLookup={},n=ke.a.parse(a,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}),t=n.data,e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](4),console.log(e.t0),this.myState.errorStatus="NO RUN LOG! Add 'run-log.csv' to SVN ".concat(this.$route.path," !");case 18:t.forEach((function(e){var t="";Object.values(e).slice(3+2*Ao).forEach((function(e){e&&(t+="-".concat(e))})),s.myState.runLogFolderLookup[t.slice(1)]=e.folder,s.runLookup[e.folder]=e}));case 19:case"end":return e.stop()}}),e,this,[[4,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildRunFinder",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:return this.myState.isLoading=!0,e.next=5,this.loadRunLog();case 5:return t="run-lookup.".concat(this.globalState.locale,".yaml"),e.t0=Ce.a,e.next=9,this.myState.svnRoot.getFileText(t);case 9:e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),this.myState.runFinder=i,console.log({runYaml:i});case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setInitialRun",value:function(){this.needsInitialRun=!1;var e=this.runLookup[this.myState.selectedRun];console.log({initialRun:e});for(var t=0;t<this.myState.runFinder.dimensions.length;t++){var i=this.myState.runFinder.dimensions[t],a=i.options[0].value;e&&(a=e[i.csvColumn]),_["c"].set(this.myState.activeButtons,t,a)}this.buildRunIdFromButtonSelections()}},{key:"clickedOptionButton",value:function(e,t){t!==this.myState.activeButtons[e]&&(this.myState.activeButtons[e]=t,this.buildRunIdFromButtonSelections())}},{key:"buildRunIdFromButtonSelections",value:function(){var e=this;if(this.myState.svnProject){var t=this.myState.runFinder.dimensions.map((function(t,i){return e.myState.activeButtons[i]})).join("-"),i=this.myState.runLogFolderLookup[t];if(i){var a="/".concat(this.myState.svnProject.url,"/").concat(i);a!==this.$route.path&&this.$router.replace(a)}else this.myState.selectedRun="",this.myState.vizes=[]}}},{key:"expensesPerDay",value:function(){return Math.round(this.runHeader.fleetSize*this.runCosts.fixedCosts+this.runHeader.mileage*this.runCosts.variableCosts)}},{key:"revenuePerDay",value:function(){return this.runHeader.incomePerDay-this.expensesPerDay()}},{key:"annualIncome",value:function(){return 365*this.revenuePerDay()}},{key:"showRunHeader",value:function(){console.log("showRunHeader",this.myState.selectedRun);var e=this.runLookup[this.myState.selectedRun];if(e){var t=e["calcDemand".concat(this.operatorNumber)]*e["userCostFixed".concat(this.operatorNumber)]+e["calcRevenueDistance".concat(this.operatorNumber)]*e["userCostPerKm".concat(this.operatorNumber)];this.runHeader={demand:0+e["calcDemand".concat(this.operatorNumber)],fleetSize:0+e["calcFleetSize".concat(this.operatorNumber)],mileage:Math.round(0+e["calcMileage".concat(this.operatorNumber)]),carMileage:Math.round(0+e.calcCarKm),revenueDistance:Math.round(0+e["calcRevenueDistance".concat(this.operatorNumber)]),incomePerDay:Math.round(0+t),serviceQuality:0+e["calcServiceLevel".concat(this.operatorNumber)],tollIncome:e.calcTollIncome||0},this.totalMileage=Math.round(0+e.calcMileage1+(e.calcMileage2||0)+(this.runHeader.carMileage||0)),this.runCosts={fixedCosts:e["calcFixedCosts".concat(this.operatorNumber)],variableCosts:e["calcVariableCosts".concat(this.operatorNumber)]},this.buildModeSharePieChart()}}},{key:"buildModeSharePieChart",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:if(t=this.myState.files.filter((function(e){return"modeStats-berlin.txt"===e})),t.length){e.next=5;break}return e.abrupt("return");case 5:return i="".concat(this.myState.selectedRun,"/").concat(t[0]),e.next=8,this.myState.svnRoot.getFileText(i);case 8:for(a=e.sent,n=ke.a.parse(a,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}),s=n.data[n.data.length-1],delete s.Iteration,delete s.freight,r=[],o=0,l=Object.keys(s);o<l.length;o++)c=l[o],u=Math.floor(1e3*s[c])/10,r.push({category:c,value:s[c],label:"".concat(c,": ").concat(u)});this.modeSharePie={$schema:"https://vega.github.io/schema/vega-lite/v4.json",description:"Mode Trip Share Summary",data:{values:r},background:"white",encoding:{theta:{field:"value",type:"quantitative",stack:!0},color:{field:"category",type:"nominal",legend:null}},layer:[{mark:{type:"arc",innerRadius:25,outerRadius:80}},{mark:{type:"text",radius:108,fontWeight:"bold",fontSize:12},encoding:{text:{field:"label",type:"nominal"}}}],view:{stroke:null}};case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clickedVisualization",value:function(e){var t=this.myState.vizes[e];if("image-view"!==t.component&&this.myState.svnProject){var i="/v/".concat(t.component,"/").concat(this.myState.svnProject.url,"/").concat(this.myState.selectedRun,"/").concat(t.config);console.log({path:i}),this.$router.push({path:i})}}},{key:"updateTitle",value:function(e,t){this.myState.vizes[e].title=t;for(var i=0,a=Object.keys(this.imageLookups);i<a.length;i++){var n=a[i];if(t.endsWith(n)){this.myState.vizes[e].title=this.imageLookups[n][this.globalState.locale];break}}}},{key:"swapLocale",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("### SWITCHING TO",this.globalState.locale),e.next=3,this.buildRunFinder();case 3:return e.next=5,this.filesChanged();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapColors",value:function(){this.fetchFolderContents()}},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.updateRoute()}},{key:"filesChanged",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.vizes=[],0!==this.myState.files.length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.showReadme();case 5:return e.next=7,this.showInformation();case 7:return this.buildShowEverythingView(),e.next=10,this.$nextTick();case 10:Object(ve["a"])(".medium-zoom",{background:"#444450"});case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showReadme",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t="readme.".concat(this.globalState.locale,".md"),this.myState.svnRoot){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.myState.svnRoot.getFileText(t);case 6:i=e.sent,this.myState.readme=this.mdRenderer.render(i),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](3),console.warn("couldnt find readme");case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"showInformation",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t="../kpi-info-button.".concat(this.globalState.locale,".md"),console.log(t),this.myState.svnRoot){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,this.myState.svnRoot.getFileText(t);case 7:i=e.sent,this.myState.information=this.mdRenderer.render(i),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](4),console.warn("couldnt find information");case 14:case"end":return e.stop()}}),e,this,[[4,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildShowEverythingView",value:function(){var e,t=Object(b["a"])(this.globalState.visualizationTypes.values());try{for(t.s();!(e=t.n()).done;){var i,a=e.value,n=ge()(this.myState.files,a.filePatterns),s=Object(b["a"])(n);try{for(s.s();!(i=s.n()).done;){var r=i.value;this.myState.vizes.push({component:a.kebabName,config:r,title:"◆"})}}catch(o){s.e(o)}finally{s.f()}}}catch(o){t.e(o)}finally{t.f()}}},{key:"fetchFolderContents",value:function(){var e=Object(S["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return",[]);case 2:return this.myState.isLoading=!0,this.myState.errorStatus="",this.modeSharePie={},this.myState.files.length&&(this.myState.files=[]),e.prev=6,e.next=9,this.myState.svnRoot.getDirectory("/".concat(this.myState.selectedRun));case 9:t=e.sent,i=t.dirs.filter((function(e){return!e.startsWith(".")})).sort(),a=t.files.filter((function(e){return!e.startsWith(".")})).sort(),this.myState.errorStatus="",this.myState.folders=i,this.myState.files=a,e.next=35;break;case 17:if(e.prev=17,e.t0=e["catch"](6),!this.myState.selectedRun){e.next=21;break}return e.abrupt("return");case 21:console.log("BAD PAGE"),console.log({eeee:e.t0}),this.myState.folders=[],this.myState.files=[],this.myState.errorStatus="<h3>",e.t0.status&&(this.myState.errorStatus+="".concat(e.t0.status," ")),e.t0.statusText&&(this.myState.errorStatus+="".concat(e.t0.statusText)),"<h3>"===this.myState.errorStatus&&(this.myState.errorStatus+="Error"),this.myState.errorStatus+="</h3>",e.t0.url&&(this.myState.errorStatus+="<p>".concat(e.t0.url,"</p>")),e.t0.message&&(this.myState.errorStatus+="<p>".concat(e.t0.message,"</p>")),"<h3>Error</h3>"===this.myState.errorStatus&&(this.myState.errorStatus=""+e.t0),this.myState.svnProject&&(this.myState.errorStatus+="<p><i>".concat(this.myState.svnProject.svn,"</i></p>")),this.myState.svnProject&&this.myState.svnProject.need_password&&401===e.t0.status&&v.commit("requestLogin",this.myState.svnProject.url);case 35:return e.prev=35,this.myState.isLoading=!1,e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[6,17,35,38]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"projectName",get:function(){var e,t;return"de"===this.globalState.locale?null===(e=this.myState.svnProject)||void 0===e?void 0:e.name_de:null===(t=this.myState.svnProject)||void 0===t?void 0:t.name}},{key:"projectDescription",get:function(){var e,t;return"de"===this.globalState.locale?null===(e=this.myState.svnProject)||void 0===e?void 0:e.description_de:null===(t=this.myState.svnProject)||void 0===t?void 0:t.description}},{key:"operatorName",get:function(){var e="OPERATOR "+this.operatorNumber;return this.myState.runFinder.operators&&(e=this.myState.runFinder.operators[this.operatorNumber-1]||"OPERATOR "+this.operatorNumber),e}}]),i}(_["c"]);Object(j["a"])([Object(_["d"])("$route")],Fo.prototype,"updateRoute",null),Object(j["a"])([Object(_["d"])("globalState.locale")],Fo.prototype,"swapLocale",null),Object(j["a"])([Object(_["d"])("globalState.colorScheme")],Fo.prototype,"swapColors",null),Object(j["a"])([Object(_["d"])("globalState.authAttempts")],Fo.prototype,"authenticationChanged",null),Object(j["a"])([Object(_["d"])("myState.files")],Fo.prototype,"filesChanged",null),Fo=Object(j["a"])([Object(_["a"])({components:Object.assign({SankeyFlipper:Do,Colophon:z},So),props:{},i18n:Eo})],Fo);var Lo=Fo,Mo=Lo,Po=(i("3102"),i("bd2b")),zo=Object(L["a"])(Mo,me,fe,!1,null,"1695f19c",null);"function"===typeof Po["default"]&&Object(Po["default"])(zo);var No=zo.exports;r["default"].use(g["a"]);var Io=[{path:"/",name:"Home",component:ne},{path:"/imprint",name:"Imprint",component:pe},{path:"*",redirect:"/"}];function Bo(){var e,t=[],i=Object(b["a"])(v.state.svnProjects);try{for(i.s();!(e=i.n()).done;){var a=e.value;t.push({path:"/"+a.url,name:a.url,component:No}),t.push({path:"/"+a.url+"/*",name:a.url,component:No})}}catch(n){i.e(n)}finally{i.f()}return t}function Vo(){var e,t=[],i=Object(b["a"])(v.state.visualizationTypes.values());try{for(i.s();!(e=i.n()).done;){var a=e.value;t.push({path:"/v/"+a.kebabName+"/:project/*",name:a.kebabName,component:a.component,props:function(e){return{project:e.params.project}}})}}catch(n){i.e(n)}finally{i.f()}return t}var $o=new g["a"]({mode:"history",base:"/pave/",routes:Bo().concat(Vo()).concat(Io),scrollBehavior:function(e,t,i){return i||{x:0,y:0}}}),Ho=$o,qo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"full-page-app":e.state.isFullScreen,"dark-mode":e.isDarkMode},attrs:{id:"main-app"}},[i("div",{staticClass:"app-nav"},[i("div",{staticClass:"top-bar full-page-app"},[i("nav",{staticClass:"top-link"},[e._l(e.topNavLinks,(function(t){return i("router-link",{key:"/"+t.url,class:{selected:"/"===e.$route.path&&"/"===t.url||e.$route.path.indexOf(t.url)>0},attrs:{to:"/"+t.url}},[i("p",[e._v(e._s(t.name))])])})),i("div",{staticClass:"right-side"},[i("div",{staticClass:"locale",on:{click:e.toggleTheme}},[i("i",{staticClass:"fa fa-1x fa-adjust"}),i("br"),i("span",[e._v(e._s(e.$t(e.state.colorScheme)))])]),i("div",{staticClass:"locale",on:{click:e.toggleLocale}},[i("i",{staticClass:"fa fa-1x fa-globe"}),i("br"),i("span",[e._v(e._s(e.state.locale))])])])],2)]),e.state.breadcrumbs.length?i("div",{staticClass:"breadcrumb-container"},[i("div",{staticClass:"breadcrumb has-bullet-separator is-centered",attrs:{"aria-label":"breadcrumbs"}},[i("ul",e._l(e.state.breadcrumbs,(function(t,a){return i("li",[a<e.state.breadcrumbs.length-1?i("router-link",{attrs:{to:t.url}},[e._v(e._s(t.label))]):i("a",{staticClass:"no-breadcrumb-link"},[e._v(e._s(t.label))])],1)})),0)])]):e._e()]),i("div",{staticClass:"center-area nav-padding"},[i("login-panel",{staticClass:"login-panel"}),i("router-view",{staticClass:"main-content"})],1),e.state.statusErrors.length?i("div",{staticClass:"message-zone"},[e._l(e.state.statusErrors,(function(t,a){return i("div",{staticClass:"message-error"},[e._m(0,!0),i("p",{domProps:{innerHTML:e._s(t)}})])})),i("button",{staticClass:"button is-small",on:{click:function(t){return e.removeAllErrors()}}},[e._v("CLEAR")])],2):e._e()])},Uo=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",[i("i",{staticClass:"fa fa-icon fa-exclamation-triangle",staticStyle:{color:"orange"}})])}],Wo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sidebar-page"},[a("section",{staticClass:"sidebar-layout"},[a("b-sidebar",{attrs:{type:"is-light",fullheight:e.fullheight,fullwidth:e.fullwidth,overlay:e.overlay,right:e.right,open:e.open},on:{"update:open":function(t){e.open=t}}},[a("div",{staticClass:"all-stuff"},[a("div",{staticClass:"block"},[a("a",{attrs:{href:"/"}},[a("img",{staticClass:"vsp-logo",attrs:{src:i("a6e2"),alt:"TU Berlin VSP Department"}})])]),a("b-menu-list",{attrs:{label:"Login Required"}}),a("p",{staticClass:"my-label"},[e._v(e._s(e.whichLogin)+": access to this site requires a login.")]),a("b-menu-list",{attrs:{label:"Username"}}),a("b-input",{attrs:{placeholder:"VSP username",maxlength:"30"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("b-menu-list",{attrs:{label:"Password"}}),a("b-input",{attrs:{type:"password","password-reveal":""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("b-button",{staticClass:"my-space is-primary",attrs:{disabled:!e.username||!e.password},on:{click:e.clickedLogin}},[e._v("Login")])],1)])],1)])},Go=[],Xo=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.username="",e.password="",e.expandOnHover=!0,e.fullheight=!0,e.fullwidth=!1,e.mobile="reduce",e.reduce=!1,e.overlay=!0,e.right=!1,e.theme="is-light",e.projects=e.globalState.svnProjects,e.subfolders=[{name:"hello"}],e.open=!1,e}return Object(w["a"])(i,[{key:"showLoginPanel",value:function(){this.open=""!==this.globalState.needLoginForUrl}},{key:"panelMayBeClosing",value:function(){this.open||v.commit("requestLogin","")}},{key:"clickedLogin",value:function(){v.commit("setCredentials",{url:this.globalState.needLoginForUrl,username:this.username,pw:this.password}),this.globalState.needLoginForUrl=""}},{key:"whichLogin",get:function(){var e=this;try{var t=this.globalState.svnProjects.filter((function(t){return t.url===e.globalState.needLoginForUrl}))[0];return t.name}catch(i){}return"this site"}}]),i}(_["c"]);Object(j["a"])([Object(_["d"])("globalState.needLoginForUrl")],Xo.prototype,"showLoginPanel",null),Object(j["a"])([Object(_["d"])("open")],Xo.prototype,"panelMayBeClosing",null),Xo=Object(j["a"])([Object(_["a"])({components:{},props:{}})],Xo);var Yo=Xo,Ko=Yo,Jo=(i("920e"),Object(L["a"])(Ko,Wo,Go,!1,null,"381daa79",null)),Zo=Jo.exports,Qo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sidebar-page"},[a("section",{staticClass:"sidebar-layout"},[a("b-sidebar",{attrs:{position:"static",mobile:e.mobile,"expand-on-hover":e.expandOnHover,reduce:e.reduce,type:e.theme,open:""}},[a("div",{staticClass:"all-stuff"},[a("div",{staticClass:"block"},[a("a",{attrs:{href:"/"}},[a("img",{staticClass:"vsp-logo",attrs:{src:i("a6e2"),alt:"TU Berlin VSP Department"}})])]),a("b-menu",{staticClass:"is-custom-mobile"},[a("b-menu-list",{attrs:{label:"Run Browser"}},e._l(e.projects,(function(t){return a("b-menu-item",{key:t.url,attrs:{icon:"folder",label:t.name,active:e.isActive(t)},on:{click:function(i){return e.clickedProject(t)}}})})),1)],1)],1)])],1)])},el=[],tl=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.globalState=v.state,e.expandOnHover=!0,e.fullheight=!0,e.mobile="reduce",e.reduce=!1,e.overlay=!0,e.theme="is-light",e.projects=e.globalState.svnProjects,e.subfolders=[{name:"hello"}],e}return Object(w["a"])(i,[{key:"crumbsChanged",value:function(){}},{key:"isActive",value:function(e){var t=this.globalState.breadcrumbs;return!(t.length<2)&&(console.log(t[1]),console.log({item:e}),t[1].label===e.name)}},{key:"clickedProject",value:function(e){var t="/"+e.url;this.$router.push({path:t})}}]),i}(_["c"]);Object(j["a"])([Object(_["d"])("globalState.breadcrumbs")],tl.prototype,"crumbsChanged",null),tl=Object(j["a"])([Object(_["a"])({components:{},props:{}})],tl);var il=tl,al=il,nl=(i("3352"),Object(L["a"])(al,Qo,el,!1,null,"4baabc15",null)),sl=nl.exports,rl=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("nav",{staticClass:"navbar is-link",attrs:{role:"navigation","aria-label":"main navigation"}},[i("div",{staticClass:"navbar-brand"},[i("router-link",{staticClass:"home-link navbar-item",attrs:{to:"/"}},[e._v("Home")]),i("a",{staticClass:"navbar-burger burger",class:{"is-active":e.isBurgerActive},attrs:{role:"button","aria-label":"menu","aria-expanded":"false","data-target":"navbarBasicExample"},on:{click:e.clickedBurger}},[i("span",{attrs:{"aria-hidden":"true"}}),i("span",{attrs:{"aria-hidden":"true"}}),i("span",{attrs:{"aria-hidden":"true"}})])],1),i("div",{staticClass:"navbar-menu",class:{"is-active":e.isBurgerActive},attrs:{id:"navbarBasicExample"},on:{click:e.clickedBurger}},[i("div",{staticClass:"navbar-start"},[i("router-link",{staticClass:"navbar-item",attrs:{to:"/avoev/"}},[e._v("AVÖV Project Files")]),i("router-link",{staticClass:"navbar-item",attrs:{to:"/public-svn/"}},[e._v("Public SVN")]),i("router-link",{staticClass:"navbar-item",attrs:{to:"/serve/"}},[e._v("Localhost")]),i("router-link",{staticClass:"navbar-item",attrs:{to:"/serve/cluster/"}},[e._v("TU Cluster")]),i("div",{staticClass:"navbar-item has-dropdown is-hoverable",class:{"is-active":e.isDropdownActive}},[i("a",{staticClass:"navbar-link"},[e._v(" Etc")]),i("div",{staticClass:"navbar-dropdown"},[i("a",{staticClass:"navbar-item",attrs:{href:"/v9/masks/berlin"}},[e._v("Squirrels")]),i("a",{staticClass:"navbar-item",attrs:{href:"/v9/tracing2/berlin"}},[e._v("Pizza")]),i("a",{staticClass:"navbar-item",attrs:{href:"/v8/masks"}},[e._v("Chicken Wings")])])])],1)])])},ol=[],ll=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.isBurgerActive=!1,e.isDropdownActive=!1,e}return Object(w["a"])(i,[{key:"clickedBurger",value:function(){this.isBurgerActive=!this.isBurgerActive}},{key:"mounted",value:function(){}},{key:"routeChanged",value:function(e,t){this.isBurgerActive=!1,this.isDropdownActive=!1}}]),i}(_["c"]);Object(j["a"])([Object(_["d"])("$route")],ll.prototype,"routeChanged",null),ll=Object(j["a"])([Object(_["a"])({})],ll);var cl=ll,ul=cl,hl=(i("9668"),Object(L["a"])(ul,rl,ol,!1,null,"656dfc64",null)),dl=hl.exports,pl=Hn.a;pl.accessToken="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA";var ml=function(e){Object(O["a"])(i,e);var t=Object(x["a"])(i);function i(){var e;return Object(C["a"])(this,i),e=t.apply(this,arguments),e.state=v.state,e}return Object(w["a"])(i,[{key:"clickedLink",value:function(e){this.$router.push({path:e})}},{key:"mounted",value:function(){var e=localStorage.getItem("colorscheme")?localStorage.getItem("colorscheme"):(window.matchMedia&&window.matchMedia("(prefers-color-scheme:dark)")).matches?n.DarkMode:n.LightMode;e===n.LightMode&&this.$store.commit("rotateColors"),document.body.style.backgroundColor=e===n.LightMode?"#edebe4":"#2d3133"}},{key:"removeAllErrors",value:function(){this.$store.commit("clearAllErrors")}},{key:"toggleLocale",value:function(){var e="en"===this.state.locale?"de":"en";this.$store.commit("setLocale",e),this.$root.$i18n.locale=e}},{key:"toggleTheme",value:function(){this.$store.commit("rotateColors")}},{key:"toggleFullScreen",value:function(e){e?(document.body.classList.add("full-screen-page"),document.documentElement.style.overflowY="auto"):(document.body.classList.remove("full-screen-page"),document.documentElement.style.overflowY=null)}},{key:"topNavLinks",get:function(){var e=[{name:"PAVE",url:""}],t=e.concat(this.state.svnProjects);return t}},{key:"isDarkMode",get:function(){return this.state.colorScheme==n.DarkMode}}]),i}(_["c"]);Object(j["a"])([Object(_["d"])("state.isFullScreen")],ml.prototype,"toggleFullScreen",null),ml=Object(j["a"])([Object(_["a"])({components:{TopNavBar:dl,SideNavBar:sl,LoginPanel:Zo,Colophon:z}})],ml);var fl=ml,vl=fl,bl=(i("5c0b"),i("1a8b")),gl=Object(L["a"])(vl,qo,Uo,!1,null,null,null);"function"===typeof bl["default"]&&Object(bl["default"])(gl);var yl=gl.exports,kl=i("289d");r["default"].use(o["a"]),r["default"].use(kl["a"],{defaultIconPack:"mdi",defaultInputHasCounter:!1}),r["default"].config.productionTip=!1;var Sl=new o["a"]({locale:v.state.locale,fallbackLocale:"en"});new r["default"]({i18n:Sl,router:Ho,store:v,render:function(e){return e(yl)}}).$mount("#app")},cf49:function(e,t,i){},d1ef:function(e,t,i){"use strict";var a=i("5853"),n=i.n(a);t["default"]=n.a},d1f5:function(e,t,i){"use strict";i.r(t),i.d(t,"OrbitControls",(function(){return n})),i.d(t,"MapControls",(function(){return s}));i("d3b7"),i("4c53"),i("ddb0");var a=i("5a89"),n=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new a["x"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:a["k"].PAN,MIDDLE:a["k"].DOLLY,RIGHT:a["k"].PAN},this.touches={ONE:a["s"].PAN,TWO:a["s"].DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(n),i.update(),l=o.NONE},this.update=function(){var t=new a["x"],s=(new a["o"]).setFromUnitVectors(e.up,new a["x"](0,1,0)),r=s.clone().inverse(),f=new a["x"],v=new a["o"];return function(){var e=i.object.position;return t.copy(e).sub(i.target),t.applyQuaternion(s),u.setFromVector3(t),i.autoRotate&&l===o.NONE&&j(O()),i.enableDamping?(u.theta+=h.theta*i.dampingFactor,u.phi+=h.phi*i.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi),u.theta=Math.max(i.minAzimuthAngle,Math.min(i.maxAzimuthAngle,u.theta)),u.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=d,u.radius=Math.max(i.minDistance,Math.min(i.maxDistance,u.radius)),!0===i.enableDamping?i.target.addScaledVector(p,i.dampingFactor):i.target.add(p),t.setFromSpherical(u),t.applyQuaternion(r),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(h.theta*=1-i.dampingFactor,h.phi*=1-i.dampingFactor,p.multiplyScalar(1-i.dampingFactor)):(h.set(0,0,0),p.set(0,0,0)),d=1,!!(m||f.distanceToSquared(i.object.position)>c||8*(1-v.dot(i.object.quaternion))>c)&&(i.dispatchEvent(n),f.copy(i.object.position),v.copy(i.object.quaternion),m=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",oe,!1),i.domElement.removeEventListener("mousedown",Q,!1),i.domElement.removeEventListener("wheel",ie,!1),i.domElement.removeEventListener("touchstart",ne,!1),i.domElement.removeEventListener("touchend",re,!1),i.domElement.removeEventListener("touchmove",se,!1),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),i.domElement.removeEventListener("keydown",ae,!1)};var i=this,n={type:"change"},s={type:"start"},r={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=o.NONE,c=1e-6,u=new a["r"],h=new a["r"],d=1,p=new a["x"],m=!1,f=new a["w"],v=new a["w"],b=new a["w"],g=new a["w"],y=new a["w"],k=new a["w"],S=new a["w"],C=new a["w"],w=new a["w"];function O(){return 2*Math.PI/60/60*i.autoRotateSpeed}function x(){return Math.pow(.95,i.zoomSpeed)}function j(e){h.theta-=e}function _(e){h.phi-=e}var T=function(){var e=new a["x"];return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),p.add(e)}}(),R=function(){var e=new a["x"];return function(t,a){!0===i.screenSpacePanning?e.setFromMatrixColumn(a,1):(e.setFromMatrixColumn(a,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),p.add(e)}}(),D=function(){var e=new a["x"];return function(t,a){var n=i.domElement;if(i.object.isPerspectiveCamera){var s=i.object.position;e.copy(s).sub(i.target);var r=e.length();r*=Math.tan(i.object.fov/2*Math.PI/180),T(2*t*r/n.clientHeight,i.object.matrix),R(2*a*r/n.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(T(t*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),R(a*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function E(e){i.object.isPerspectiveCamera?d/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function A(e){i.object.isPerspectiveCamera?d*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function F(e){f.set(e.clientX,e.clientY)}function L(e){S.set(e.clientX,e.clientY)}function M(e){g.set(e.clientX,e.clientY)}function P(e){v.set(e.clientX,e.clientY),b.subVectors(v,f).multiplyScalar(i.rotateSpeed);var t=i.domElement;j(2*Math.PI*b.x/t.clientHeight),_(2*Math.PI*b.y/t.clientHeight),f.copy(v),i.update()}function z(e){C.set(e.clientX,e.clientY),w.subVectors(C,S),w.y>0?E(x()):w.y<0&&A(x()),S.copy(C),i.update()}function N(e){y.set(e.clientX,e.clientY),k.subVectors(y,g).multiplyScalar(i.panSpeed),D(k.x,k.y),g.copy(y),i.update()}function I(){}function B(e){e.deltaY<0?A(x()):e.deltaY>0&&E(x()),i.update()}function V(e){var t=!1;switch(e.keyCode){case i.keys.UP:D(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:D(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:D(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:D(-i.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),i.update())}function $(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,i)}}function H(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,i)}}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+i*i);S.set(0,a)}function U(e){i.enableZoom&&q(e),i.enablePan&&H(e)}function W(e){i.enableZoom&&q(e),i.enableRotate&&$(e)}function G(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,a)}b.subVectors(v,f).multiplyScalar(i.rotateSpeed);var n=i.domElement;j(2*Math.PI*b.x/n.clientHeight),_(2*Math.PI*b.y/n.clientHeight),f.copy(v)}function X(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,a)}k.subVectors(y,g).multiplyScalar(i.panSpeed),D(k.x,k.y),g.copy(y)}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+a*a);C.set(0,n),w.set(0,Math.pow(C.y/S.y,i.zoomSpeed)),E(w.y),S.copy(C)}function K(e){i.enableZoom&&Y(e),i.enablePan&&X(e)}function J(e){i.enableZoom&&Y(e),i.enableRotate&&G(e)}function Z(){}function Q(e){if(!1!==i.enabled){var t;switch(e.preventDefault(),i.domElement.focus?i.domElement.focus():window.focus(),e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case a["k"].DOLLY:if(!1===i.enableZoom)return;L(e),l=o.DOLLY;break;case a["k"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;M(e),l=o.PAN}else{if(!1===i.enableRotate)return;F(e),l=o.ROTATE}break;case a["k"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;F(e),l=o.ROTATE}else{if(!1===i.enablePan)return;M(e),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&(document.addEventListener("mousemove",ee,!1),document.addEventListener("mouseup",te,!1),i.dispatchEvent(s))}}function ee(e){if(!1!==i.enabled)switch(e.preventDefault(),l){case o.ROTATE:if(!1===i.enableRotate)return;P(e);break;case o.DOLLY:if(!1===i.enableZoom)return;z(e);break;case o.PAN:if(!1===i.enablePan)return;N(e);break}}function te(e){!1!==i.enabled&&(I(),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),i.dispatchEvent(r),l=o.NONE)}function ie(e){!1===i.enabled||!1===i.enableZoom||l!==o.NONE&&l!==o.ROTATE||(e.preventDefault(),e.stopPropagation(),i.dispatchEvent(s),B(e),i.dispatchEvent(r))}function ae(e){!1!==i.enabled&&!1!==i.enableKeys&&!1!==i.enablePan&&V(e)}function ne(e){if(!1!==i.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(i.touches.ONE){case a["s"].ROTATE:if(!1===i.enableRotate)return;$(e),l=o.TOUCH_ROTATE;break;case a["s"].PAN:if(!1===i.enablePan)return;H(e),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(i.touches.TWO){case a["s"].DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;U(e),l=o.TOUCH_DOLLY_PAN;break;case a["s"].DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;W(e),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&i.dispatchEvent(s)}}function se(e){if(!1!==i.enabled)switch(e.preventDefault(),e.stopPropagation(),l){case o.TOUCH_ROTATE:if(!1===i.enableRotate)return;G(e),i.update();break;case o.TOUCH_PAN:if(!1===i.enablePan)return;X(e),i.update();break;case o.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;K(e),i.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;J(e),i.update();break;default:l=o.NONE}}function re(e){!1!==i.enabled&&(Z(),i.dispatchEvent(r),l=o.NONE)}function oe(e){!1!==i.enabled&&e.preventDefault()}i.domElement.addEventListener("contextmenu",oe,!1),i.domElement.addEventListener("mousedown",Q,!1),i.domElement.addEventListener("wheel",ie,!1),i.domElement.addEventListener("touchstart",ne,!1),i.domElement.addEventListener("touchend",re,!1),i.domElement.addEventListener("touchmove",se,!1),i.domElement.addEventListener("keydown",ae,!1),-1===i.domElement.tabIndex&&(i.domElement.tabIndex=0),this.update()};n.prototype=Object.create(a["e"].prototype),n.prototype.constructor=n;var s=function(e,t){n.call(this,e,t),this.mouseButtons.LEFT=a["k"].PAN,this.mouseButtons.RIGHT=a["k"].ROTATE,this.touches.ONE=a["s"].PAN,this.touches.TWO=a["s"].DOLLY_ROTATE};s.prototype=Object.create(a["e"].prototype),s.prototype.constructor=s},d352:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"carriers":"Carriers","vehicles":"VEHICLES","services":"SERVICES","shipments":"SHIPMENTS","tours":"TOURS"},"de":{"carriers":"Unternehmen","vehicles":"FAHRZEUGE","services":"BETRIEBE","shipments":"LIEFERUNGEN","tours":"TOUREN"}}'),delete e.options._Ctor}},d388:function(e,t,i){"use strict";var a=i("e008"),n=i.n(a);t["default"]=n.a},d3b3:function(e,t,i){"use strict";var a=i("7d8e"),n=i.n(a);t["default"]=n.a},d429:function(e,t,i){},d43b:function(e,t,i){},d469:function(e,t,i){"use strict";var a=i("d6f3"),n=i.n(a);n.a},d6f3:function(e,t,i){},d8a1:function(e,t,i){"use strict";var a=i("6c98"),n=i.n(a);n.a},d977:function(e,t,i){e.exports=function(){return new Worker(i.p+"0881e75fe8637e733ad1.worker.js")}},dba0:function(e,t,i){},dbca:function(e,t,i){"use strict";var a=i("20c0"),n=i.n(a);n.a},de3b:function(e,t,i){e.exports=i.p+"img/3-iav.6e067abd.png"},dee5:function(e,t,i){},e008:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"carriers":"Carriers","vehicles":"VEHICLES","services":"SERVICES","shipments":"SHIPMENTS","tours":"TOURS","pickup":"Pickup","delivery":"Delivery"},"de":{"carriers":"Unternehmen","vehicles":"FAHRZEUGE","services":"BETRIEBE","shipments":"LIEFERUNGEN","tours":"TOUREN","pickup":"Abholung","delivery":"Lieferung"}}'),delete e.options._Ctor}},e91c:function(e,t,i){},e9b2:function(e,t,i){"use strict";i.r(t),t["default"]="// vertex shader: agent positions\n\nuniform float simulationTime;\nuniform float showSusceptible;\n\nattribute vec3 position2;  // x,y,t\n\n// this gets passed from vertex to fragment shader\nvarying float skip;\nvarying float atRest;\n\nfloat calculateSize() {\n\n    float small = 2.0;\n    float med = 5.0;\n    float big = 8.0;\n\n    // if (myInfectionStatus == 0.0) return small;\n    // else if (myInfectionStatus == 1.0) return big;\n    // else if (myInfectionStatus < 6.0) return med;\n\n    return med;\n}\n\nfloat calculateTimestep(in vec3 point1, in vec3 point2) {\n\n    atRest = 0.0;\n\n    if (point1 == point2) {\n        atRest = 1.0;\n        return 0.0;\n    }\n\n    // position vars have time in the .z to save some space\n    if (simulationTime < position.z) return 0.0;\n    if (simulationTime > position2.z) return 1.0;\n\n    float progress = simulationTime - position.z;\n    float duration = position2.z - position.z;\n\n    return progress / duration;\n}\n\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n\n    if (timestepFraction == 0.0) {\n\n        return point1;\n\n    } else if (timestepFraction >= 1.0 ) {\n\n        return point2;\n\n    } else {\n\n        vec3 direction = point2 - point1;\n\n        return (direction * timestepFraction) + point1;\n    }\n}\n\n\nvoid main() {\n\n    // don't do anything if this trip is currently out of time bounds\n    if (simulationTime < position.z || simulationTime > position2.z) {\n        gl_PointSize = 0.0;\n        gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n        skip = 1.0;\n        return;\n\n    } else {\n\n        // figure out z-index based on whether it is moving\n        float zIndex = atRest == 1.0 ? 0.2 : 0.3;\n\n        // unpack coords from position buffers - x,y,time. Deal w/ z later\n        vec3 point1 = vec3(position.xy, zIndex);\n        vec3 point2 = vec3(position2.xy, zIndex);\n\n        float timestepFraction = calculateTimestep(point1, point2);\n\n        vec3 newPosition = interpolate(point1, point2, timestepFraction);\n\n        gl_PointSize = calculateSize();\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n\n        skip = 0.0;\n   }\n}\n"},ef1a:function(e,t,i){},f0aa:function(e,t,i){"use strict";var a=i("55ea"),n=i.n(a);n.a},f2cf:function(e,t,i){"use strict";var a=i("0a22"),n=i.n(a);t["default"]=n.a},f30e:function(e,t,i){"use strict";var a=i("c454"),n=i.n(a);n.a},f863:function(e,t,i){"use strict";i.r(t),t["default"]='#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceSizes;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\n// attribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nuniform float currentTime;\n\nuniform vec2 iconStillOffsets;\n// uniform float iconStillColorModes;\nuniform vec4 iconStillFrames;\n\nattribute float instanceTimestamps;\nattribute float instanceTimestampsNext;\nattribute vec2 instanceStartPositions;\nattribute vec2 instanceEndPositions;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\nvarying float vPercentComplete;\n\nvec2 rotate_by_angle(vec2 vertex, float angle_radian) {\n  // float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n    if (timestepFraction <= 0.0) {\n        return point1;\n    } else if (timestepFraction >= 1.0 ) {\n        return point2;\n    } else {\n        vec3 direction = point2 - point1;\n        return point1 + (direction * timestepFraction);\n    }\n}\n\nvoid main(void) {\n\n  // Calculate progress\n  // (skip everything else if this vertex is outside the time window)\n\n  if (currentTime < instanceTimestamps) {\n    vPercentComplete = -1.0;\n    return;\n\n  } else if (currentTime > instanceTimestampsNext) {\n    vPercentComplete = -1.0;\n    return;\n\n  } else {\n    vPercentComplete = (currentTime - instanceTimestamps) /\n                       (instanceTimestampsNext - instanceTimestamps);\n  }\n\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 startPosition = vec3(instanceStartPositions, 5.0);\n  vec3 endPosition = vec3(instanceEndPositions, 5.0);\n\n  // are we stationary/still\n  bool still = (instanceStartPositions == instanceEndPositions);\n\n  vec2 iconSize = still ? iconStillFrames.zw : instanceIconFrames.zw;\n  // convert size in meters to pixels, then scaled and clamp\n  // project meters to pixels and clamp to limits\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n\n  // figure out angle\n  float angle = 0.0;\n  if (!still) {\n    vec3 point1 = project_position_to_clipspace(startPosition, vec3(0.0), vec3(0.0)).xyz;\n    vec3 point2 = project_position_to_clipspace(endPosition, vec3(0.0), vec3(0.0)).xyz;\n    vec3 direction = normalize(point2 - point1);\n    angle = atan( direction.y / direction.x);\n    if (direction.x < 0.0) angle = angle - PI;\n  }\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + (still ? iconStillOffsets : instanceOffsets);\n  pixelOffset = rotate_by_angle(pixelOffset, angle) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  vec3 newPosition = interpolate(\n    startPosition,\n    endPosition,\n    vPercentComplete);\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(newPosition, vec3(0.0), vec3(0.0));\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(newPosition, offset_common, vec3(0.0));\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec2 upperleft = (still ? iconStillFrames.xy : instanceIconFrames.xy);\n\n  vTextureCoords = mix(\n    upperleft,\n    upperleft + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = still ?  0.0 : 1.0;\n}\n'},fc60:function(e,t,i){"use strict";var a=i("1bf3"),n=i.n(a);n.a},fe7c:function(e,t,i){"use strict";var a=i("4ac0"),n=i.n(a);n.a}});